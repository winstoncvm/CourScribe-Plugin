{"version":3,"file":"markerjs3.js","sources":["../src/core/SvgHelper.ts","../src/core/Activator.ts","../src/core/MarkerBase.ts","../src/core/TransformMatrix.ts","../src/core/RectangularBoxMarkerBase.ts","../src/core/ShapeOutlineMarkerBase.ts","../src/core/ShapeMarkerBase.ts","../src/core/FrameMarker.ts","../src/core/LinearMarkerBase.ts","../src/core/LineMarker.ts","../src/core/ArrowMarker.ts","../src/core/MeasurementMarker.ts","../src/core/PolygonMarker.ts","../src/core/FreehandMarker.ts","../node_modules/tslib/tslib.es6.js","../src/core/TextBlock.ts","../src/core/TextMarker.ts","../src/core/CoverMarker.ts","../src/core/HighlightMarker.ts","../src/core/CalloutMarker.ts","../src/core/EllipseFrameMarker.ts","../src/core/EllipseMarker.ts","../src/core/ImageMarkerBase.ts","../src/core/CustomImageMarker.ts","../src/core/CheckImageMarker.ts","../src/core/XImageMarker.ts","../src/core/CaptionFrameMarker.ts","../src/core/CurveMarker.ts","../src/core/HighlighterMarker.ts","../src/core/SvgFilters.ts","../src/editor/MarkerBaseEditor.ts","../src/editor/Grip.ts","../src/editor/ResizeGrip.ts","../src/editor/PolygonMarkerEditor.ts","../src/editor/LinearMarkerEditor.ts","../src/editor/RectangularBoxMarkerGrips.ts","../src/editor/RotateGrip.ts","../src/editor/RectangularBoxMarkerBaseEditor.ts","../src/editor/ShapeOutlineMarkerEditor.ts","../src/editor/UndoRedoManager.ts","../src/editor/FreehandMarkerEditor.ts","../src/editor/TextBlockEditor.ts","../src/editor/TextMarkerEditor.ts","../src/editor/ShapeMarkerEditor.ts","../src/editor/ArrowMarkerEditor.ts","../src/editor/CalloutMarkerEditor.ts","../src/editor/ImageMarkerEditor.ts","../src/editor/CaptionFrameMarkerEditor.ts","../src/editor/CurveMarkerEditor.ts","../src/MarkerArea.ts","../src/editor.ts","../src/MarkerView.ts","../src/viewer.ts","../src/Renderer.ts"],"sourcesContent":["import { IPoint } from './IPoint';\n\n/**\n * Utility class to simplify SVG operations.\n */\nexport class SvgHelper {\n  /**\n   * Creates SVG \"defs\".\n   */\n  public static createDefs(): SVGDefsElement {\n    const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');\n\n    return defs;\n  }\n\n  /**\n   * Sets attributes on an arbitrary SVG element\n   * @param el - target SVG element.\n   * @param attributes - set of name-value attribute pairs.\n   */\n  public static setAttributes(\n    el: SVGElement,\n    attributes: Array<[string, string]>,\n  ): void {\n    for (const [attr, value] of attributes) {\n      el.setAttribute(attr, value);\n    }\n  }\n\n  /**\n   * Creates an SVG rectangle with the specified width and height.\n   * @param width\n   * @param height\n   * @param attributes - additional attributes.\n   */\n  public static createRect(\n    width: number | string,\n    height: number | string,\n    attributes?: Array<[string, string]>,\n  ): SVGRectElement {\n    const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n\n    rect.setAttribute('width', width.toString());\n    rect.setAttribute('height', height.toString());\n    if (attributes) {\n      SvgHelper.setAttributes(rect, attributes);\n    }\n\n    return rect;\n  }\n\n  /**\n   * Creates an SVG line with specified end-point coordinates.\n   * @param x1\n   * @param y1\n   * @param x2\n   * @param y2\n   * @param attributes - additional attributes.\n   */\n  public static createLine(\n    x1: number | string,\n    y1: number | string,\n    x2: number | string,\n    y2: number | string,\n    attributes?: Array<[string, string]>,\n  ): SVGLineElement {\n    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');\n\n    line.setAttribute('x1', x1.toString());\n    line.setAttribute('y1', y1.toString());\n    line.setAttribute('x2', x2.toString());\n    line.setAttribute('y2', y2.toString());\n    if (attributes) {\n      SvgHelper.setAttributes(line, attributes);\n    }\n\n    return line;\n  }\n\n  /**\n   * Creates an SVG polygon with specified points.\n   * @param points - points as string.\n   * @param attributes - additional attributes.\n   */\n  public static createPolygon(\n    points: string,\n    attributes?: Array<[string, string]>,\n  ): SVGPolygonElement {\n    const polygon = document.createElementNS(\n      'http://www.w3.org/2000/svg',\n      'polygon',\n    );\n\n    polygon.setAttribute('points', points);\n    if (attributes) {\n      SvgHelper.setAttributes(polygon, attributes);\n    }\n\n    return polygon;\n  }\n\n  /**\n   * Creates an SVG circle with the specified radius.\n   * @param radius\n   * @param attributes - additional attributes.\n   */\n  public static createCircle(\n    radius: number,\n    attributes?: Array<[string, string]>,\n  ): SVGCircleElement {\n    const circle = document.createElementNS(\n      'http://www.w3.org/2000/svg',\n      'circle',\n    );\n\n    circle.setAttribute('cx', (radius / 2).toString());\n    circle.setAttribute('cy', (radius / 2).toString());\n    circle.setAttribute('r', radius.toString());\n    if (attributes) {\n      SvgHelper.setAttributes(circle, attributes);\n    }\n\n    return circle;\n  }\n\n  /**\n   * Creates an SVG ellipse with the specified horizontal and vertical radii.\n   * @param rx\n   * @param ry\n   * @param attributes - additional attributes.\n   */\n  public static createEllipse(\n    rx: number,\n    ry: number,\n    attributes?: Array<[string, string]>,\n  ): SVGEllipseElement {\n    const ellipse = document.createElementNS(\n      'http://www.w3.org/2000/svg',\n      'ellipse',\n    );\n\n    ellipse.setAttribute('cx', (rx / 2).toString());\n    ellipse.setAttribute('cy', (ry / 2).toString());\n    ellipse.setAttribute('rx', (rx / 2).toString());\n    ellipse.setAttribute('ry', (ry / 2).toString());\n    if (attributes) {\n      SvgHelper.setAttributes(ellipse, attributes);\n    }\n\n    return ellipse;\n  }\n\n  /**\n   * Creates an SVG group.\n   * @param attributes - additional attributes.\n   */\n  public static createGroup(attributes?: Array<[string, string]>): SVGGElement {\n    const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n    if (attributes) {\n      SvgHelper.setAttributes(g, attributes);\n    }\n    return g;\n  }\n\n  /**\n   * Creates an SVG transform.\n   */\n  public static createTransform(): SVGTransform {\n    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n\n    return svg.createSVGTransform();\n  }\n\n  /**\n   * Creates an SVG marker.\n   * @param id\n   * @param orient\n   * @param markerWidth\n   * @param markerHeight\n   * @param refX\n   * @param refY\n   * @param markerElement\n   */\n  public static createMarker(\n    id: string,\n    orient: string,\n    markerWidth: number | string,\n    markerHeight: number | string,\n    refX: number | string,\n    refY: number | string,\n    markerElement: SVGGraphicsElement,\n  ): SVGMarkerElement {\n    const marker = document.createElementNS(\n      'http://www.w3.org/2000/svg',\n      'marker',\n    );\n    SvgHelper.setAttributes(marker, [\n      ['id', id],\n      ['orient', orient],\n      ['markerWidth', markerWidth.toString()],\n      ['markerHeight', markerHeight.toString()],\n      ['refX', refX.toString()],\n      ['refY', refY.toString()],\n    ]);\n\n    marker.appendChild(markerElement);\n\n    return marker;\n  }\n\n  /**\n   * Creates an SVG text element.\n   * @param attributes - additional attributes.\n   */\n  public static createText(\n    attributes?: Array<[string, string]>,\n  ): SVGTextElement {\n    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');\n    text.setAttribute('x', '0');\n    text.setAttribute('y', '0');\n\n    if (attributes) {\n      SvgHelper.setAttributes(text, attributes);\n    }\n\n    return text;\n  }\n\n  /**\n   * Creates an SVG TSpan.\n   * @param text - inner text.\n   * @param attributes - additional attributes.\n   */\n  public static createTSpan(\n    text: string,\n    attributes?: Array<[string, string]>,\n  ): SVGTSpanElement {\n    const tspan = document.createElementNS(\n      'http://www.w3.org/2000/svg',\n      'tspan',\n    );\n    tspan.textContent = text;\n\n    if (attributes) {\n      SvgHelper.setAttributes(tspan, attributes);\n    }\n\n    return tspan;\n  }\n\n  /**\n   * Creates an SVG image element.\n   * @param attributes - additional attributes.\n   */\n  public static createImage(\n    attributes?: Array<[string, string]>,\n  ): SVGImageElement {\n    const image = document.createElementNS(\n      'http://www.w3.org/2000/svg',\n      'image',\n    );\n\n    if (attributes) {\n      SvgHelper.setAttributes(image, attributes);\n    }\n\n    return image;\n  }\n\n  /**\n   * Creates an SVG point with the specified coordinates.\n   * @param x\n   * @param y\n   */\n  public static createPoint(x: number, y: number): SVGPoint {\n    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    const svgPoint = svg.createSVGPoint();\n    svgPoint.x = x;\n    svgPoint.y = y;\n\n    return svgPoint;\n  }\n\n  /**\n   * Creates an SVG path with the specified shape (d).\n   * @param d - path shape\n   * @param attributes - additional attributes.\n   */\n  public static createPath(\n    d: string,\n    attributes?: Array<[string, string]>,\n  ): SVGPathElement {\n    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n\n    path.setAttribute('d', d);\n    if (attributes) {\n      SvgHelper.setAttributes(path, attributes);\n    }\n\n    return path;\n  }\n\n  /**\n   * Creates an SVG text element.\n   * @param attributes - additional attributes.\n   */\n  public static createForeignObject(\n    attributes?: Array<[string, string]>,\n  ): SVGForeignObjectElement {\n    const obj = document.createElementNS(\n      'http://www.w3.org/2000/svg',\n      'foreignObject',\n    );\n    obj.setAttribute('x', '0');\n    obj.setAttribute('y', '0');\n\n    if (attributes) {\n      SvgHelper.setAttributes(obj, attributes);\n    }\n\n    return obj;\n  }\n\n  /**\n   * Returns local coordinates relative to the provided `localRoot` of a client (screen) point.\n   * @param localRoot relative coordinate root\n   * @param x horizontal client coordinate\n   * @param y vertical client coordinate\n   * @param zoomLevel zoom level\n   * @returns local coordinates relative to `localRoot`\n   */\n  public static clientToLocalCoordinates(\n    localRoot: SVGElement | undefined,\n    x: number,\n    y: number,\n    zoomLevel = 1,\n  ): IPoint {\n    if (localRoot) {\n      const clientRect = localRoot.getBoundingClientRect();\n      return {\n        x: (x - clientRect.left) / zoomLevel,\n        y: (y - clientRect.top) / zoomLevel,\n      };\n    } else {\n      return { x: x, y: y };\n    }\n  }\n\n  /**\n   * Creates an SVG image element from a supplied inner SVG markup string.\n   * @param stringSvg SVG markup (without the root svg tags)\n   * @returns SVG image element\n   */\n  public static createSvgFromString(stringSvg: string): SVGSVGElement {\n    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    svg.innerHTML = stringSvg;\n\n    return svg;\n  }\n\n  /**\n   * Creates an SVG filter element.\n   * @param id filter id\n   * @param attributes other filter element attributes\n   * @param innerHTML filter definition as string\n   * @returns filter element\n   */\n  public static createFilter(\n    id: string,\n    attributes?: Array<[string, string]>,\n    innerHTML?: string,\n  ): SVGFilterElement {\n    const filter = document.createElementNS(\n      'http://www.w3.org/2000/svg',\n      'filter',\n    );\n    filter.id = id;\n    if (attributes) {\n      SvgHelper.setAttributes(filter, attributes);\n    }\n    if (innerHTML) {\n      filter.innerHTML = innerHTML;\n    }\n    return filter;\n  }\n}\n","/**\n * Manages commercial licenses.\n * @ignore\n */\nexport class Activator {\n  private static keys: Map<string, string> = new Map<string, string>();\n  private static keyAddListeners: Array<() => void> = new Array<() => void>();\n\n  /**\n   * Add a license key\n   * @param product product identifier.\n   * @param key license key sent to you after purchase.\n   */\n  public static addKey(product: string, key: string): void {\n    Activator.keys.set(product, key);\n    Activator.keyAddListeners.forEach((listener) => {\n      listener();\n    });\n  }\n\n  /**\n   * Add a function to be called when license key is added.\n   * @param listener\n   */\n  public static addKeyAddListener(listener: () => void) {\n    Activator.keyAddListeners.push(listener);\n  }\n\n  /**\n   * Remove a function called when key is added.\n   * @param listener\n   */\n  public static removeKeyAddListener(listener: () => void) {\n    const li = Activator.keyAddListeners.indexOf(listener);\n    if (li > -1) {\n      Activator.keyAddListeners.splice(li, 1);\n    }\n  }\n\n  /**\n   * Returns true if the product is commercially licensed.\n   * @param product product identifier.\n   */\n  public static isLicensed(product: string): boolean {\n    // NOTE:\n    // before removing or modifying this please consider supporting marker.js development\n    // by visiting https://markerjs.com/ for details\n    // thank you!\n    if (Activator.keys.has(product)) {\n      const keyRegex = new RegExp(\n        `${product}-[A-Z][0-9]{3}-[A-Z][0-9]{3}-[0-9]{4}`,\n        'i',\n      );\n      const key = Activator.keys.get(product);\n      return key === undefined ? false : keyRegex.test(key);\n    } else {\n      return false;\n    }\n  }\n}\n","import { ISize } from './ISize';\nimport { MarkerBaseState } from './MarkerBaseState';\n\n/**\n * Represents a stage in a marker's lifecycle.\n *\n * Most markers are created immediately after the user clicks on the canvas.\n * However, some markers are only finished creating after additional interactions.\n */\nexport type MarkerStage = 'creating' | 'normal';\n\n/**\n * Base class for all markers.\n *\n * When creating custom marker types usually you will want to extend one of the derived classes.\n * However, if you cannot find a suitable base class, you can and you should extend this class.\n *\n * @summary Base class for all markers.\n * @group Markers\n */\nexport class MarkerBase {\n  /**\n   * Marker type name.\n   *\n   * It's important to set this in each derived class. This value is used to identify marker types\n   * when restoring marker state and other scenarios.\n   */\n  public static typeName = 'MarkerBase';\n\n  /**\n   * Returns marker type name for the object instance.\n   */\n  public get typeName(): string {\n    return Object.getPrototypeOf(this).constructor.typeName;\n  }\n\n  /**\n   * Marker type title (display name) used for accessibility and other attributes.\n   */\n  public static title: string;\n\n  /**\n   * When true, the default filter is applied to the marker's visual.\n   *\n   * @since 3.2.0\n   */\n  public static applyDefaultFilter: boolean = true;\n\n  /**\n   * SVG container object holding the marker's visual.\n   *\n   * It is created and passed to the constructor by marker editor or viewer when creating the marker.\n   */\n  protected _container: SVGGElement;\n  /**\n   * SVG container object holding the marker's visual.\n   */\n  /**\n   * SVG container object holding the marker's visual.\n   */\n  public get container(): SVGGElement {\n    return this._container;\n  }\n\n  /**\n   * Additional information about the marker.\n   *\n   * Generally, this isn't used for anything functional.\n   * However, in a derived type it could be used for storing arbitrary data with no need to create extra properties and state types.\n   */\n  public notes?: string;\n\n  /**\n   * The default marker size when the marker is created with a click (without dragging).\n   */\n  public defaultSize: ISize = { width: 50, height: 20 };\n\n  /**\n   * Marker lifecycle stage.\n   *\n   * Most markers are created immediately after the user clicks on the canvas (`normal`).\n   * However, some markers are only finished creating after additional interactions (`creating`).\n   */\n  public stage: MarkerStage = 'normal';\n\n  /**\n   * Stroke (outline) color of the marker.\n   */\n  protected _strokeColor = 'transparent';\n  /**\n   * Stroke (outline) color of the marker.\n   *\n   * In a derived class override {@link applyStrokeColor} to apply the color to the marker's visual.\n   */\n  public get strokeColor() {\n    return this._strokeColor;\n  }\n  public set strokeColor(color: string) {\n    this._strokeColor = color;\n    this.applyStrokeColor();\n  }\n  /**\n   * Applies the stroke color to the marker's visual.\n   *\n   * Override this method in a derived class to apply the color to the marker's visual.\n   */\n  protected applyStrokeColor() {}\n\n  /**\n   * Fill color of the marker.\n   */\n  protected _fillColor = 'transparent';\n  /**\n   * Fill color of the marker.\n   *\n   * In a derived class override {@link applyFillColor} to apply the color to the marker's visual.\n   */\n  public get fillColor() {\n    return this._fillColor;\n  }\n  public set fillColor(color: string) {\n    this._fillColor = color;\n    this.applyFillColor();\n  }\n  /**\n   * Applies the fill color to the marker's visual.\n   *\n   * Override this method in a derived class to apply the color to the marker's visual.\n   */\n  protected applyFillColor() {}\n\n  /**\n   * Stroke (outline) width of the marker.\n   */\n  protected _strokeWidth = 0;\n  /**\n   * Stroke (outline) width of the marker.\n   *\n   * In a derived class override {@link applyStrokeWidth} to apply the width to the marker's visual.\n   */\n  public get strokeWidth() {\n    return this._strokeWidth;\n  }\n  public set strokeWidth(value) {\n    this._strokeWidth = value;\n    this.applyStrokeWidth();\n  }\n  /**\n   * Applies the stroke width to the marker's visual.\n   *\n   * Override this method in a derived class to apply the width to the marker's visual.\n   */\n  protected applyStrokeWidth() {}\n\n  /**\n   * Stroke (outline) dash array of the marker.\n   */\n  protected _strokeDasharray = '';\n  /**\n   * Stroke (outline) dash array of the marker.\n   *\n   * In a derived class override {@link applyStrokeDasharray} to apply the dash array to the marker's visual.\n   */\n  public get strokeDasharray() {\n    return this._strokeDasharray;\n  }\n  public set strokeDasharray(value) {\n    this._strokeDasharray = value;\n    this.applyStrokeDasharray();\n  }\n  /**\n   * Applies the stroke dash array to the marker's visual.\n   *\n   * Override this method in a derived class to apply the dash array to the marker's visual.\n   */\n  protected applyStrokeDasharray() {}\n\n  /**\n   * Opacity of the marker.\n   */\n  protected _opacity = 1;\n  /**\n   * Opacity of the marker.\n   *\n   * In a derived class override {@link applyOpacity} to apply the opacity to the marker's visual.\n   */\n  public get opacity() {\n    return this._opacity;\n  }\n  public set opacity(value) {\n    this._opacity = value;\n    this.applyOpacity();\n  }\n  /**\n   * Applies the opacity to the marker's visual.\n   *\n   * Override this method in a derived class to apply the opacity to the marker's visual\n   */\n  protected applyOpacity() {}\n\n  /**\n   * Creates a new marker object.\n   *\n   * @param container - SVG container object holding the marker's visual.\n   */\n  constructor(container: SVGGElement) {\n    this._container = container;\n\n    this.applyFillColor = this.applyFillColor.bind(this);\n    this.applyStrokeColor = this.applyStrokeColor.bind(this);\n    this.applyStrokeWidth = this.applyStrokeWidth.bind(this);\n    this.applyStrokeDasharray = this.applyStrokeDasharray.bind(this);\n    this.applyOpacity = this.applyOpacity.bind(this);\n    this.getBBox = this.getBBox.bind(this);\n  }\n\n  /**\n   * Returns true if passed SVG element belongs to the marker. False otherwise.\n   *\n   * @param el - target element.\n   * @returns true if the element belongs to the marker.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  public ownsTarget(el: EventTarget): boolean {\n    return false;\n  }\n\n  /**\n   * Disposes the marker and cleans up.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\n  public dispose(): void {}\n\n  protected addMarkerVisualToContainer(element: SVGElement): void {\n    if (this.container.childNodes.length > 0) {\n      this.container.insertBefore(element, this.container.childNodes[0]);\n    } else {\n      this.container.appendChild(element);\n    }\n  }\n\n  /**\n   * When overridden in a derived class, represents a preliminary outline for markers that can be displayed before the marker is actually created.\n   * @returns SVG path string.\n   */\n  public getOutline(): string {\n    return '';\n  }\n\n  /**\n   * Returns current marker state that can be restored in the future.\n   */\n  public getState(): MarkerBaseState {\n    return {\n      typeName: Object.getPrototypeOf(this).constructor.typeName,\n      notes: this.notes,\n      strokeColor: this._strokeColor,\n      strokeWidth: this._strokeWidth,\n      strokeDasharray: this._strokeDasharray,\n      opacity: this._opacity,\n    };\n  }\n\n  /**\n   * Restores previously saved marker state.\n   *\n   * @param state - previously saved state.\n   */\n  public restoreState(state: MarkerBaseState): void {\n    this.notes = state.notes;\n    this._strokeColor = state.strokeColor ?? this._strokeColor;\n    this._strokeWidth = state.strokeWidth ?? this._strokeWidth;\n    this._strokeDasharray = state.strokeDasharray ?? this._strokeDasharray;\n    this._opacity = state.opacity ?? this._opacity;\n  }\n\n  /**\n   * Scales marker. Used after resize.\n   *\n   * @param scaleX - horizontal scale\n   * @param scaleY - vertical scale\n   */\n  // eslint-disable-next-line @typescript-eslint/no-empty-function, @typescript-eslint/no-unused-vars\n  public scale(scaleX: number, scaleY: number): void {}\n\n  /**\n   * Returns markers bounding box.\n   *\n   * Override to return a custom bounding box.\n   *\n   * @returns rectangle fitting the marker.\n   */\n  public getBBox(): DOMRect {\n    return this.container.getBBox();\n  }\n}\n","/**\n * Represents a simplified version of the SVGMatrix.\n */\nexport interface ITransformMatrix {\n  a: number;\n  b: number;\n  c: number;\n  d: number;\n  e: number;\n  f: number;\n}\n\n/**\n * A utility class to transform between SVGMatrix and its simplified representation.\n */\nexport class TransformMatrix {\n  public static toITransformMatrix(matrix: SVGMatrix): ITransformMatrix {\n    return {\n      a: matrix.a,\n      b: matrix.b,\n      c: matrix.c,\n      d: matrix.d,\n      e: matrix.e,\n      f: matrix.f,\n    };\n  }\n  public static toSVGMatrix(\n    currentMatrix: SVGMatrix,\n    newMatrix: ITransformMatrix,\n  ): SVGMatrix {\n    currentMatrix.a = newMatrix.a;\n    currentMatrix.b = newMatrix.b;\n    currentMatrix.c = newMatrix.c;\n    currentMatrix.d = newMatrix.d;\n    currentMatrix.e = newMatrix.e;\n    currentMatrix.f = newMatrix.f;\n    return currentMatrix;\n  }\n}\n","import { IPoint } from './IPoint';\nimport { MarkerBase } from './MarkerBase';\nimport { MarkerBaseState } from './MarkerBaseState';\nimport { RectangularBoxMarkerBaseState } from './RectangularBoxMarkerBaseState';\nimport { SvgHelper } from './SvgHelper';\nimport { TransformMatrix } from './TransformMatrix';\n\n/**\n * RectangularBoxMarkerBase is a base class for all marker's that conceptually fit into a rectangle\n * such as all rectangle markers, ellipse, text and callout markers.\n *\n * @summary Base class for all markers that conceptually fit into a rectangle.\n * @group Markers\n */\nexport class RectangularBoxMarkerBase extends MarkerBase {\n  /**\n   * x coordinate of the top-left corner.\n   */\n  public left = 0;\n  /**\n   * y coordinate of the top-left corner.\n   */\n  public top = 0;\n  /**\n   * Marker width.\n   */\n  public width = 0;\n  /**\n   * Marker height.\n   */\n  public height = 0;\n\n  /**\n   * Marker's rotation angle.\n   */\n  public rotationAngle = 0;\n\n  /**\n   * x coordinate of the marker's center.\n   */\n  public get centerX(): number {\n    return this.left + this.width / 2;\n  }\n  /**\n   * y coordinate of the marker's center.\n   */\n  public get centerY(): number {\n    return this.top + this.height / 2;\n  }\n\n  private _visual?: SVGGraphicsElement;\n  /**\n   * Container for the marker's visual.\n   */\n  protected get visual(): SVGGraphicsElement | undefined {\n    return this._visual;\n  }\n  protected set visual(value: SVGGraphicsElement) {\n    this._visual = value;\n    const translate = SvgHelper.createTransform();\n    this._visual.transform.baseVal.appendItem(translate);\n  }\n\n  constructor(container: SVGGElement) {\n    super(container);\n\n    this.rotatePoint = this.rotatePoint.bind(this);\n    this.unrotatePoint = this.unrotatePoint.bind(this);\n\n    // add rotation transform\n    this.container.transform.baseVal.appendItem(SvgHelper.createTransform());\n  }\n\n  /**\n   * Moves visual to the specified coordinates.\n   * @param point - coordinates of the new top-left corner of the visual.\n   */\n  public moveVisual(point: IPoint): void {\n    if (this.visual) {\n      this.visual.style.transform = `translate(${point.x}px, ${point.y}px)`;\n    }\n  }\n\n  /**\n   * Adjusts marker's size.\n   */\n  public setSize(): void {\n    this.moveVisual({ x: this.left, y: this.top });\n  }\n\n  /**\n   * Rotates marker around the center.\n   * @param point - coordinates of the rotation point.\n   */\n  public rotate(point: IPoint) {\n    // avoid glitch when crossing the 0 rotation point\n    if (Math.abs(point.x - this.centerX) > 0.1) {\n      const sign = Math.sign(point.x - this.centerX);\n      this.rotationAngle =\n        (Math.atan((point.y - this.centerY) / (point.x - this.centerX)) * 180) /\n          Math.PI +\n        90 * sign;\n      this.applyRotation();\n    }\n  }\n\n  private applyRotation() {\n    const rotate = this.container.transform.baseVal.getItem(0);\n    rotate.setRotate(this.rotationAngle, this.centerX, this.centerY);\n    this.container.transform.baseVal.replaceItem(rotate, 0);\n  }\n\n  /**\n   * Returns point coordinates based on the actual screen coordinates and marker's rotation.\n   * @param point - original pointer coordinates\n   */\n  public rotatePoint(point: IPoint): IPoint {\n    if (this.rotationAngle === 0) {\n      return point;\n    }\n\n    const matrix = this.container.getCTM();\n    if (matrix === null) {\n      return point;\n    }\n    let svgPoint = SvgHelper.createPoint(point.x, point.y);\n    svgPoint = svgPoint.matrixTransform(matrix);\n\n    const result = { x: svgPoint.x, y: svgPoint.y };\n\n    return result;\n  }\n\n  /**\n   * Returns original point coordinates based on coordinates with rotation applied.\n   * @param point - rotated point coordinates.\n   */\n  public unrotatePoint(point: IPoint): IPoint {\n    if (this.rotationAngle === 0) {\n      return point;\n    }\n\n    let matrix = this.container.getCTM();\n    if (matrix === null) {\n      return point;\n    }\n    matrix = matrix.inverse();\n    let svgPoint = SvgHelper.createPoint(point.x, point.y);\n    svgPoint = svgPoint.matrixTransform(matrix);\n\n    const result = { x: svgPoint.x, y: svgPoint.y };\n\n    return result;\n  }\n\n  public getOutline(): string {\n    const result = `M 0 0 \n    H ${this.defaultSize} \n    V ${this.defaultSize} \n    H 0 \n    V 0 Z`;\n\n    return result;\n  }\n\n  public getState(): RectangularBoxMarkerBaseState {\n    const result: RectangularBoxMarkerBaseState = Object.assign(\n      {\n        left: this.left,\n        top: this.top,\n        width: this.width,\n        height: this.height,\n        rotationAngle: this.rotationAngle,\n        visualTransformMatrix: TransformMatrix.toITransformMatrix(\n          this.visual!.transform.baseVal.getItem(0).matrix,\n        ),\n        containerTransformMatrix: TransformMatrix.toITransformMatrix(\n          this.container.transform.baseVal.getItem(0).matrix,\n        ),\n      },\n      super.getState(),\n    );\n\n    return result;\n  }\n\n  public restoreState(state: MarkerBaseState): void {\n    super.restoreState(state);\n    const rbmState = state as RectangularBoxMarkerBaseState;\n    this.left = rbmState.left;\n    this.top = rbmState.top;\n    this.width = rbmState.width;\n    this.height = rbmState.height;\n    this.rotationAngle = rbmState.rotationAngle;\n\n    this.moveVisual({ x: this.left, y: this.top });\n\n    if (rbmState.visualTransformMatrix && rbmState.containerTransformMatrix) {\n      this.visual!.transform.baseVal.getItem(0).setMatrix(\n        TransformMatrix.toSVGMatrix(\n          this.visual!.transform.baseVal.getItem(0).matrix,\n          rbmState.visualTransformMatrix,\n        ),\n      );\n      this.container.transform.baseVal\n        .getItem(0)\n        .setMatrix(\n          TransformMatrix.toSVGMatrix(\n            this.container.transform.baseVal.getItem(0).matrix,\n            rbmState.containerTransformMatrix,\n          ),\n        );\n    } else {\n      this.applyRotation();\n    }\n  }\n\n  public scale(scaleX: number, scaleY: number): void {\n    super.scale(scaleX, scaleY);\n\n    const rPoint = this.rotatePoint({ x: this.left, y: this.top });\n    const point = this.unrotatePoint({\n      x: rPoint.x * scaleX,\n      y: rPoint.y * scaleY,\n    });\n\n    this.left = point.x;\n    this.top = point.y;\n    this.width = this.width * scaleX;\n    this.height = this.height * scaleY;\n  }\n\n  public getBBox(): DOMRect {\n    const rotatedTL = this.rotatePoint({ x: this.left, y: this.top });\n    const rotatedTR = this.rotatePoint({\n      x: this.left + this.width,\n      y: this.top,\n    });\n    const rotatedBL = this.rotatePoint({\n      x: this.left,\n      y: this.top + this.height,\n    });\n    const rotatedBR = this.rotatePoint({\n      x: this.left + this.width,\n      y: this.top + this.height,\n    });\n    const absTL = {\n      x: Math.min(rotatedTL.x, rotatedTR.x, rotatedBL.x, rotatedBR.x),\n      y: Math.min(rotatedTL.y, rotatedTR.y, rotatedBL.y, rotatedBR.y),\n    };\n    const absBR = {\n      x: Math.max(rotatedTL.x, rotatedTR.x, rotatedBL.x, rotatedBR.x),\n      y: Math.max(rotatedTL.y, rotatedTR.y, rotatedBL.y, rotatedBR.y),\n    };\n    return new DOMRect(absTL.x, absTL.y, absBR.x - absTL.x, absBR.y - absTL.y);\n  }\n}\n","import { MarkerBaseState } from './MarkerBaseState';\nimport { RectangularBoxMarkerBase } from './RectangularBoxMarkerBase';\nimport { SvgHelper } from './SvgHelper';\n\n/**\n * Shape outline marker is a base class for all markers that represent a shape outline.\n *\n * @summary Base class for shape outline (unfilled shape) markers.\n * @group Markers\n */\nexport class ShapeOutlineMarkerBase extends RectangularBoxMarkerBase {\n  public static title = 'Shape outline marker';\n\n  protected applyStrokeColor() {\n    if (this.visual) {\n      SvgHelper.setAttributes(this.visual, [['stroke', this._strokeColor]]);\n    }\n  }\n\n  protected applyStrokeWidth() {\n    if (this.visual) {\n      SvgHelper.setAttributes(this.visual, [\n        ['stroke-width', this._strokeWidth.toString()],\n      ]);\n    }\n  }\n\n  protected applyStrokeDasharray() {\n    if (this.visual) {\n      SvgHelper.setAttributes(this.visual, [\n        ['stroke-dasharray', this._strokeDasharray],\n      ]);\n    }\n  }\n\n  protected applyOpacity() {\n    if (this.visual) {\n      SvgHelper.setAttributes(this.visual, [\n        ['opacity', this._opacity.toString()],\n      ]);\n    }\n  }\n\n  constructor(container: SVGGElement) {\n    super(container);\n\n    this.createVisual = this.createVisual.bind(this);\n  }\n\n  public ownsTarget(el: EventTarget): boolean {\n    if (super.ownsTarget(el) || el === this.visual) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  protected getPath(\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    width: number = this.width,\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    height: number = this.height,\n  ): string {\n    return 'M0,0';\n  }\n\n  public getOutline(): string {\n    return this.getPath(this.defaultSize.width, this.defaultSize.height);\n  }\n\n  /**\n   * Creates marker's visual.\n   */\n  public createVisual(): void {\n    this.visual = SvgHelper.createPath(this.getPath(), [\n      ['fill', 'transparent'],\n      ['stroke', this._strokeColor],\n      ['stroke-width', this._strokeWidth.toString()],\n      ['stroke-dasharray', this._strokeDasharray],\n      ['opacity', this._opacity.toString()],\n    ]);\n    this.addMarkerVisualToContainer(this.visual);\n  }\n\n  /**\n   * Adjusts marker's visual according to the current state\n   * (color, width, etc.).\n   */\n  public adjustVisual(): void {\n    if (this.visual) {\n      SvgHelper.setAttributes(this.visual, [\n        ['d', this.getPath()],\n        ['fill', 'transparent'],\n        ['stroke', this._strokeColor],\n        ['stroke-width', this._strokeWidth.toString()],\n        ['stroke-dasharray', this._strokeDasharray],\n        ['opacity', this._opacity.toString()],\n      ]);\n    }\n  }\n\n  public setSize(): void {\n    super.setSize();\n    if (this.visual) {\n      SvgHelper.setAttributes(this.visual, [['d', this.getPath()]]);\n    }\n  }\n\n  public restoreState(state: MarkerBaseState): void {\n    this.createVisual();\n    super.restoreState(state);\n    this.adjustVisual();\n  }\n\n  public scale(scaleX: number, scaleY: number): void {\n    super.scale(scaleX, scaleY);\n\n    this.strokeWidth *= (scaleX + scaleY) / 2;\n\n    this.setSize();\n  }\n}\n","import { MarkerBaseState } from './MarkerBaseState';\nimport { ShapeOutlineMarkerBase } from './ShapeOutlineMarkerBase';\nimport { ShapeMarkerBaseState } from './ShapeMarkerBaseState';\nimport { SvgHelper } from './SvgHelper';\n\n/**\n * Base class for filled shape markers.\n *\n * @summary Base class for filled shape markers.\n * @group Markers\n */\nexport abstract class ShapeMarkerBase extends ShapeOutlineMarkerBase {\n  public static title = 'Shape marker';\n\n  /**\n   * Marker's fill color.\n   */\n  protected _fillColor = 'transparent';\n  /**\n   * Applies the fill color to the marker's visual.\n   *\n   * If needed, override this method in a derived class to apply the color to the marker's visual.\n   */\n  protected applyFillColor() {\n    if (this.visual) {\n      SvgHelper.setAttributes(this.visual, [['fill', this._fillColor]]);\n    }\n  }\n\n  constructor(container: SVGGElement) {\n    super(container);\n\n    this.createVisual = this.createVisual.bind(this);\n  }\n\n  public createVisual(): void {\n    super.createVisual();\n    if (this.visual) {\n      SvgHelper.setAttributes(this.visual, [['fill', this._fillColor]]);\n    }\n  }\n\n  public getState(): ShapeMarkerBaseState {\n    const result: ShapeMarkerBaseState = Object.assign(\n      {\n        fillColor: this._fillColor,\n      },\n      super.getState(),\n    );\n\n    return result;\n  }\n\n  public restoreState(state: MarkerBaseState): void {\n    const rectState = state as ShapeMarkerBaseState;\n    super.restoreState(state);\n\n    this.fillColor = rectState.fillColor;\n\n    this.setSize();\n  }\n}\n","import { ShapeOutlineMarkerBase } from './ShapeOutlineMarkerBase';\n\n/**\n * Frame marker represents unfilled rectangle shape.\n *\n * @summary Unfilled rectangle marker.\n * @group Markers\n */\nexport class FrameMarker extends ShapeOutlineMarkerBase {\n  public static typeName = 'FrameMarker';\n  public static title = 'Frame marker';\n\n  constructor(container: SVGGElement) {\n    super(container);\n\n    this.strokeColor = '#ff0000';\n    this.strokeWidth = 3;\n  }\n\n  protected getPath(\n    width: number = this.width,\n    height: number = this.height,\n  ): string {\n    const result = `M 0 0 \n      H ${width} \n      V ${height} \n      H 0 \n      V 0 Z`;\n\n    return result;\n  }\n}\n","import { LinearMarkerBaseState } from './LinearMarkerBaseState';\nimport { MarkerBase } from './MarkerBase';\nimport { MarkerBaseState } from './MarkerBaseState';\nimport { SvgHelper } from './SvgHelper';\n\n/**\n * Base class for line-like markers.\n *\n * Use one of the derived classes.\n *\n * @summary Base class for line-like markers.\n * @group Markers\n */\nexport class LinearMarkerBase extends MarkerBase {\n  /**\n   * x coordinate of the first end-point\n   */\n  public x1 = 0;\n  /**\n   * y coordinate of the first end-point\n   */\n  public y1 = 0;\n  /**\n   * x coordinate of the second end-point\n   */\n  public x2 = 0;\n  /**\n   * y coordinate of the second end-point\n   */\n  public y2 = 0;\n\n  /**\n   * Marker's main visual.\n   */\n  protected visual: SVGGraphicsElement | undefined;\n\n  /**\n   * Wider invisible visual to make it easier to select and manipulate the marker.\n   */\n  protected selectorVisual: SVGGraphicsElement | undefined;\n  /**\n   * Visible visual of the marker.\n   */\n  protected visibleVisual: SVGGraphicsElement | undefined;\n  /**\n   * Line visual of the marker.\n   */\n  protected lineVisual: SVGGraphicsElement | undefined;\n  /**\n   * Start terminator (ending) visual of the marker.\n   */\n  protected startTerminatorVisual: SVGGraphicsElement | undefined;\n  /**\n   * End terminator (ending) visual of the marker.\n   */\n  protected endTerminatorVisual: SVGGraphicsElement | undefined;\n\n  protected applyStrokeColor() {\n    if (this.lineVisual) {\n      SvgHelper.setAttributes(this.lineVisual, [['stroke', this._strokeColor]]);\n    }\n    if (this.startTerminatorVisual && this.endTerminatorVisual) {\n      SvgHelper.setAttributes(this.startTerminatorVisual, [\n        ['stroke', this._strokeColor],\n        ['fill', this._strokeColor],\n      ]);\n      SvgHelper.setAttributes(this.endTerminatorVisual, [\n        ['stroke', this._strokeColor],\n        ['fill', this._strokeColor],\n      ]);\n    }\n  }\n\n  protected applyStrokeWidth() {\n    if (this.lineVisual) {\n      SvgHelper.setAttributes(this.lineVisual, [\n        ['stroke-width', this._strokeWidth.toString()],\n      ]);\n    }\n    if (this.selectorVisual) {\n      SvgHelper.setAttributes(this.selectorVisual, [\n        ['stroke-width', Math.max(this._strokeWidth, 8).toString()],\n      ]);\n    }\n  }\n\n  protected applyStrokeDasharray() {\n    if (this.lineVisual) {\n      SvgHelper.setAttributes(this.lineVisual, [\n        ['stroke-dasharray', this._strokeDasharray],\n      ]);\n    }\n  }\n\n  protected applyOpacity() {\n    if (this.visibleVisual) {\n      SvgHelper.setAttributes(this.visibleVisual, [\n        ['opacity', this._opacity.toString()],\n      ]);\n    }\n  }\n\n  constructor(container: SVGGElement) {\n    super(container);\n\n    this.adjustVisual = this.adjustVisual.bind(this);\n    this.getState = this.getState.bind(this);\n    this.restoreState = this.restoreState.bind(this);\n    this.scale = this.scale.bind(this);\n  }\n\n  public ownsTarget(el: EventTarget): boolean {\n    if (\n      super.ownsTarget(el) ||\n      el === this.visual ||\n      el === this.selectorVisual ||\n      el === this.visibleVisual ||\n      el === this.lineVisual ||\n      el === this.startTerminatorVisual ||\n      el === this.endTerminatorVisual\n    ) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * The path representing the line part of the marker visual.\n   *\n   * When implemented in derived class should return SVG path for the marker.\n   *\n   * @returns SVG path for the marker.\n   */\n  protected getPath(): string {\n    return 'M0,0';\n  }\n\n  /**\n   * The path representing the start terminator (ending) part of the marker visual.\n   * @returns SVG path\n   */\n  protected getStartTerminatorPath(): string {\n    return '';\n  }\n\n  /**\n   * The path representing the end terminator (ending) part of the marker visual.\n   * @returns SVG path\n   */\n  protected getEndTerminatorPath(): string {\n    return '';\n  }\n\n  /**\n   * Creates marker's visual.\n   */\n  public createVisual(): void {\n    this.visual = SvgHelper.createGroup();\n    this.selectorVisual = SvgHelper.createPath(this.getPath(), [\n      ['stroke', 'transparent'],\n      ['fill', 'transparent'],\n      ['stroke-width', Math.max(this.strokeWidth, 8).toString()],\n    ]);\n\n    this.visibleVisual = SvgHelper.createGroup([\n      ['opacity', this.opacity.toString()],\n    ]);\n    this.lineVisual = SvgHelper.createPath(this.getPath(), [\n      ['stroke', this.strokeColor],\n      ['fill', this.strokeColor],\n      ['stroke-width', this.strokeWidth.toString()],\n      ['stroke-linejoin', 'round'],\n      ['stroke-dasharray', this.strokeDasharray.toString()],\n    ]);\n    this.startTerminatorVisual = SvgHelper.createPath(\n      this.getStartTerminatorPath(),\n      [\n        ['stroke', this.strokeColor],\n        ['fill', this.strokeColor],\n        ['stroke-width', this.strokeWidth.toString()],\n        ['stroke-linejoin', 'round'],\n      ],\n    );\n    this.endTerminatorVisual = SvgHelper.createPath(\n      this.getEndTerminatorPath(),\n      [\n        ['stroke', this.strokeColor],\n        ['fill', this.strokeColor],\n        ['stroke-width', this.strokeWidth.toString()],\n        ['stroke-linejoin', 'round'],\n      ],\n    );\n\n    this.visibleVisual.appendChild(this.lineVisual);\n    this.visibleVisual.appendChild(this.startTerminatorVisual);\n    this.visibleVisual.appendChild(this.endTerminatorVisual);\n\n    this.visual.appendChild(this.selectorVisual);\n    this.visual.appendChild(this.visibleVisual);\n\n    this.addMarkerVisualToContainer(this.visual);\n  }\n\n  /**\n   * Adjusts marker visual after manipulation when needed.\n   */\n  public adjustVisual(): void {\n    if (\n      this.selectorVisual &&\n      this.visibleVisual &&\n      this.lineVisual &&\n      this.startTerminatorVisual &&\n      this.endTerminatorVisual\n    ) {\n      SvgHelper.setAttributes(this.selectorVisual, [['d', this.getPath()]]);\n      SvgHelper.setAttributes(this.visibleVisual, [\n        ['opacity', this.opacity.toString()],\n      ]);\n      SvgHelper.setAttributes(this.lineVisual, [\n        ['d', this.getPath()],\n        ['stroke', this.strokeColor],\n        ['fill', this.fillColor],\n        ['stroke-width', this.strokeWidth.toString()],\n        ['stroke-dasharray', this.strokeDasharray.toString()],\n      ]);\n      SvgHelper.setAttributes(this.startTerminatorVisual, [\n        ['d', this.getStartTerminatorPath()],\n        ['stroke', this.strokeColor],\n        ['fill', this.strokeColor],\n        ['stroke-width', this.strokeWidth.toString()],\n      ]);\n      SvgHelper.setAttributes(this.endTerminatorVisual, [\n        ['d', this.getEndTerminatorPath()],\n        ['stroke', this.strokeColor],\n        ['fill', this.strokeColor],\n        ['stroke-width', this.strokeWidth.toString()],\n      ]);\n    }\n  }\n\n  public getState(): LinearMarkerBaseState {\n    const result: LinearMarkerBaseState = Object.assign(\n      {\n        x1: this.x1,\n        y1: this.y1,\n        x2: this.x2,\n        y2: this.y2,\n      },\n      super.getState(),\n    );\n\n    return result;\n  }\n\n  public restoreState(state: MarkerBaseState): void {\n    super.restoreState(state);\n\n    const lmbState = state as LinearMarkerBaseState;\n    this.x1 = lmbState.x1;\n    this.y1 = lmbState.y1;\n    this.x2 = lmbState.x2;\n    this.y2 = lmbState.y2;\n\n    this.createVisual();\n    this.adjustVisual();\n  }\n\n  public scale(scaleX: number, scaleY: number): void {\n    super.scale(scaleX, scaleY);\n\n    this.x1 = this.x1 * scaleX;\n    this.y1 = this.y1 * scaleY;\n    this.x2 = this.x2 * scaleX;\n    this.y2 = this.y2 * scaleY;\n\n    this.strokeWidth *= (scaleX + scaleY) / 2;\n\n    this.adjustVisual();\n  }\n}\n","import { LinearMarkerBase } from './LinearMarkerBase';\n\n/**\n * Line marker represents a simple straight line.\n *\n * @summary Line marker.\n * @group Markers\n */\nexport class LineMarker extends LinearMarkerBase {\n  public static typeName = 'LineMarker';\n  public static title = 'Line marker';\n\n  constructor(container: SVGGElement) {\n    super(container);\n\n    this.strokeColor = '#ff0000';\n    this.strokeWidth = 3;\n\n    this.createVisual = this.createVisual.bind(this);\n  }\n\n  protected getPath(): string {\n    // svg path for line\n    const result = `M ${this.x1} ${this.y1} L ${this.x2} ${this.y2}`;\n\n    return result;\n  }\n}\n","import { ArrowMarkerState, ArrowType } from './ArrowMarkerState';\nimport { IPoint } from './IPoint';\nimport { LineMarker } from './LineMarker';\nimport { MarkerBaseState } from './MarkerBaseState';\n\n/**\n * Arrow marker represents a line with arrow heads at the ends.\n *\n * @summary A line with arrow heads at the ends.\n *\n * @group Markers\n */\nexport class ArrowMarker extends LineMarker {\n  public static typeName = 'ArrowMarker';\n  public static title = 'Arrow marker';\n\n  private _arrowType: ArrowType = 'end';\n  /**\n   * Type of the arrow.\n   *\n   * Specify whether the arrow should be drawn at the start, end, both ends or none.\n   */\n  public get arrowType(): ArrowType {\n    return this._arrowType;\n  }\n  public set arrowType(value: ArrowType) {\n    this._arrowType = value;\n    this.adjustVisual();\n  }\n\n  constructor(container: SVGGElement) {\n    super(container);\n\n    this.getArrowProperties = this.getArrowProperties.bind(this);\n    this.getStartTerminatorPath = this.getStartTerminatorPath.bind(this);\n    this.getEndTerminatorPath = this.getEndTerminatorPath.bind(this);\n  }\n\n  private getArrowProperties() {\n    const arrowHeight = 10 + this.strokeWidth * 2;\n    const arrowWidth = Math.min(\n      Math.max(5, this.strokeWidth * 2),\n      this.strokeWidth + 5,\n    );\n    const arrowDipFactor = 0.7; // arrow base \"bend factor\"\n\n    const dx = this.x2 - this.x1;\n    const dy = this.y2 - this.y1;\n    const angle = Math.atan2(dy, dx);\n    return { arrowHeight, arrowDipFactor, angle, arrowWidth };\n  }\n\n  protected getStartTerminatorPath(): string {\n    const { arrowHeight, arrowDipFactor, angle, arrowWidth } =\n      this.getArrowProperties();\n\n    // Start arrow\n    const startArrowBasePoint: IPoint = {\n      x: this.x1 + arrowHeight * arrowDipFactor * Math.cos(angle),\n      y: this.y1 + arrowHeight * arrowDipFactor * Math.sin(angle),\n    };\n\n    const startArrowTipBasePoint: IPoint = {\n      x: this.x1 + arrowHeight * Math.cos(angle),\n      y: this.y1 + arrowHeight * Math.sin(angle),\n    };\n\n    const startArrowSide1: IPoint = {\n      x: startArrowTipBasePoint.x + arrowWidth * Math.sin(angle),\n      y: startArrowTipBasePoint.y - arrowWidth * Math.cos(angle),\n    };\n\n    const startArrowSide2: IPoint = {\n      x: startArrowTipBasePoint.x - arrowWidth * Math.sin(angle),\n      y: startArrowTipBasePoint.y + arrowWidth * Math.cos(angle),\n    };\n\n    const startSegment =\n      this.arrowType === 'start' || this.arrowType === 'both'\n        ? `M ${startArrowBasePoint.x} ${startArrowBasePoint.y}\n    L ${startArrowSide1.x} ${startArrowSide1.y} L ${this.x1} ${this.y1} L ${startArrowSide2.x} ${startArrowSide2.y} L ${startArrowBasePoint.x} ${startArrowBasePoint.y}\n    L ${startArrowBasePoint.x} ${startArrowBasePoint.y}`\n        : ``;\n\n    return startSegment;\n  }\n\n  protected getEndTerminatorPath(): string {\n    const { arrowHeight, arrowDipFactor, angle, arrowWidth } =\n      this.getArrowProperties();\n\n    // End arrow\n    const endArrowBasePoint: IPoint = {\n      x: this.x2 - arrowHeight * arrowDipFactor * Math.cos(angle),\n      y: this.y2 - arrowHeight * arrowDipFactor * Math.sin(angle),\n    };\n\n    const endArrowTipBasePoint: IPoint = {\n      x: this.x2 - arrowHeight * Math.cos(angle),\n      y: this.y2 - arrowHeight * Math.sin(angle),\n    };\n\n    const endArrowSide1: IPoint = {\n      x: endArrowTipBasePoint.x + arrowWidth * Math.sin(angle),\n      y: endArrowTipBasePoint.y - arrowWidth * Math.cos(angle),\n    };\n\n    const endArrowSide2: IPoint = {\n      x: endArrowTipBasePoint.x - arrowWidth * Math.sin(angle),\n      y: endArrowTipBasePoint.y + arrowWidth * Math.cos(angle),\n    };\n\n    const endSegment =\n      this.arrowType === 'end' || this.arrowType === 'both'\n        ? `M ${endArrowBasePoint.x} ${endArrowBasePoint.y} \n    L ${endArrowSide1.x} ${endArrowSide1.y} L ${this.x2} ${this.y2} L ${endArrowSide2.x} ${endArrowSide2.y} L ${endArrowBasePoint.x} ${endArrowBasePoint.y} Z`\n        : ``;\n\n    return endSegment;\n  }\n\n  protected applyStrokeWidth() {\n    super.applyStrokeWidth();\n    this.adjustVisual();\n  }\n\n  public getState(): ArrowMarkerState {\n    const result: ArrowMarkerState = Object.assign(\n      {\n        arrowType: this.arrowType,\n      },\n      super.getState(),\n    );\n    result.typeName = ArrowMarker.typeName;\n\n    return result;\n  }\n\n  public restoreState(state: MarkerBaseState): void {\n    const arrowState = state as ArrowMarkerState;\n    this.arrowType = arrowState.arrowType;\n\n    super.restoreState(state);\n  }\n}\n","import { IPoint } from './IPoint';\nimport { LineMarker } from './LineMarker';\n\n/**\n * Represents a measurement marker.\n *\n * Measurement marker is a line with two vertical bars at the ends.\n *\n * @summary A line with two vertical bars at the ends.\n * @group Markers\n */\nexport class MeasurementMarker extends LineMarker {\n  public static typeName = 'MeasurementMarker';\n  public static title = 'Measurement marker';\n\n  constructor(container: SVGGElement) {\n    super(container);\n  }\n\n  protected getStartTerminatorPath(): string {\n    const { tipLength, angle } = this.getTerminatorProperties();\n\n    const startArrowSide1: IPoint = {\n      x: this.x1 + tipLength * Math.sin(angle),\n      y: this.y1 - tipLength * Math.cos(angle),\n    };\n\n    const startArrowSide2: IPoint = {\n      x: this.x1 - tipLength * Math.sin(angle),\n      y: this.y1 + tipLength * Math.cos(angle),\n    };\n\n    const result = `M ${startArrowSide1.x} ${startArrowSide1.y}\n      L ${startArrowSide2.x} ${startArrowSide2.y}`;\n\n    return result;\n  }\n\n  protected getEndTerminatorPath(): string {\n    const { tipLength, angle } = this.getTerminatorProperties();\n\n    const endArrowSide1: IPoint = {\n      x: this.x2 + tipLength * Math.sin(angle),\n      y: this.y2 - tipLength * Math.cos(angle),\n    };\n\n    const endArrowSide2: IPoint = {\n      x: this.x2 - tipLength * Math.sin(angle),\n      y: this.y2 + tipLength * Math.cos(angle),\n    };\n\n    // svg path for the arrow\n    const result = `M ${endArrowSide1.x} ${endArrowSide1.y} L ${endArrowSide2.x} ${endArrowSide2.y}`;\n\n    return result;\n  }\n\n  private getTerminatorProperties() {\n    const tipLength = 5 + this.strokeWidth * 3;\n\n    const dx = this.x2 - this.x1;\n    const dy = this.y2 - this.y1;\n    const angle = Math.atan2(dy, dx);\n    return { tipLength, angle };\n  }\n\n  protected applyStrokeWidth() {\n    super.applyStrokeWidth();\n    this.adjustVisual();\n  }\n}\n","import { IPoint } from './IPoint';\nimport { MarkerBase } from './MarkerBase';\nimport { MarkerBaseState } from './MarkerBaseState';\nimport { PolygonMarkerState } from './PolygonMarkerState';\nimport { SvgHelper } from './SvgHelper';\n\n/**\n * Polygon marker is a multi-point marker that represents a polygon.\n *\n * @summary Polygon marker.\n * @group Markers\n */\nexport class PolygonMarker extends MarkerBase {\n  public static typeName = 'PolygonMarker';\n  public static title = 'Polygon marker';\n\n  /**\n   * Marker's points.\n   */\n  public points: IPoint[] = [];\n\n  /**\n   * Marker's main visual.\n   */\n  public visual: SVGGraphicsElement | undefined;\n\n  public selectorVisual: SVGGElement | undefined;\n  public selectorVisualLines: SVGLineElement[] = [];\n  public visibleVisual: SVGGraphicsElement | undefined;\n\n  protected applyStrokeColor() {\n    if (this.visibleVisual) {\n      SvgHelper.setAttributes(this.visibleVisual, [\n        ['stroke', this._strokeColor],\n      ]);\n    }\n  }\n\n  protected applyFillColor() {\n    if (this.visibleVisual) {\n      SvgHelper.setAttributes(this.visibleVisual, [['fill', this._fillColor]]);\n    }\n  }\n\n  protected applyStrokeWidth() {\n    if (this.visibleVisual) {\n      SvgHelper.setAttributes(this.visibleVisual, [\n        ['stroke-width', this._strokeWidth.toString()],\n      ]);\n    }\n    if (this.selectorVisual) {\n      SvgHelper.setAttributes(this.selectorVisual, [\n        ['stroke-width', Math.max(this._strokeWidth, 8).toString()],\n      ]);\n    }\n  }\n\n  protected applyStrokeDasharray() {\n    if (this.visibleVisual) {\n      SvgHelper.setAttributes(this.visibleVisual, [\n        ['stroke-dasharray', this._strokeDasharray],\n      ]);\n    }\n  }\n\n  protected applyOpacity() {\n    if (this.visibleVisual) {\n      SvgHelper.setAttributes(this.visibleVisual, [\n        ['opacity', this._opacity.toString()],\n      ]);\n    }\n  }\n\n  constructor(container: SVGGElement) {\n    super(container);\n\n    this.strokeColor = '#ff0000';\n    this.strokeWidth = 3;\n\n    this.createVisual = this.createVisual.bind(this);\n    this.adjustVisual = this.adjustVisual.bind(this);\n    this.getState = this.getState.bind(this);\n    this.restoreState = this.restoreState.bind(this);\n    this.scale = this.scale.bind(this);\n  }\n\n  public ownsTarget(el: EventTarget): boolean {\n    if (\n      super.ownsTarget(el) ||\n      el === this.visual ||\n      el === this.selectorVisual ||\n      el === this.visibleVisual ||\n      this.selectorVisualLines.some((l) => l === el)\n    ) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Returns SVG path string for the polygon.\n   *\n   * @returns Path string for the polygon.\n   */\n  protected getPath(): string {\n    if (this.points.length > 1) {\n      return (\n        this.points\n          .map((p, i) => `${i === 0 ? 'M' : 'L'}${p.x},${p.y}`)\n          .join(' ') + (this.stage !== 'creating' ? ' Z' : '')\n      );\n    }\n    return 'M0,0';\n  }\n\n  /**\n   * Creates marker's main visual.\n   */\n  public createVisual(): void {\n    this.visual = SvgHelper.createGroup();\n    this.visibleVisual = SvgHelper.createPath(this.getPath(), [\n      ['stroke', this.strokeColor],\n      ['fill', this.fillColor],\n      ['stroke-width', this.strokeWidth.toString()],\n      ['opacity', this.opacity.toString()],\n    ]);\n    this.visual.appendChild(this.visibleVisual);\n\n    this.createSelectorVisual();\n\n    this.addMarkerVisualToContainer(this.visual);\n  }\n\n  /**\n   * Creates selector visual.\n   *\n   * Selector visual is a transparent wider visual that allows easier selection of the marker.\n   */\n  private createSelectorVisual() {\n    if (this.visual) {\n      this.selectorVisual = SvgHelper.createGroup();\n      this.visual.appendChild(this.selectorVisual);\n\n      this.points.forEach(() => {\n        this.addSelectorLine();\n      });\n    }\n  }\n\n  /**\n   * Adjusts marker visual after manipulation when needed.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\n  public adjustVisual(): void {\n    if (this.selectorVisual && this.visibleVisual) {\n      SvgHelper.setAttributes(this.visibleVisual, [\n        ['d', this.getPath()],\n        ['stroke', this.strokeColor],\n        ['stroke-width', this.strokeWidth.toString()],\n        ['stroke-dasharray', this.strokeDasharray.toString()],\n        ['fill', this.fillColor],\n        ['opacity', this.opacity.toString()],\n      ]);\n\n      this.adjustSelectorVisual();\n    }\n  }\n\n  private adjustSelectorVisual() {\n    if (this.selectorVisual) {\n      // adjust number of lines\n      const missingLines = this.points.length - this.selectorVisualLines.length;\n      if (missingLines > 0) {\n        for (let i = 0; i < missingLines; i++) {\n          this.addSelectorLine();\n        }\n      } else if (missingLines < 0) {\n        for (let i = 0; i < -missingLines; i++) {\n          this.selectorVisual!.removeChild(this.selectorVisualLines.pop()!);\n        }\n      }\n\n      // adjust line coordinates\n      this.selectorVisualLines.forEach((line, i) => {\n        SvgHelper.setAttributes(line, [\n          ['x1', this.points[i].x.toString()],\n          ['y1', this.points[i].y.toString()],\n          ['x2', this.points[(i + 1) % this.points.length].x.toString()],\n          ['y2', this.points[(i + 1) % this.points.length].y.toString()],\n        ]);\n      });\n    }\n  }\n\n  private addSelectorLine() {\n    const line = SvgHelper.createLine(0, 0, 0, 0, [\n      ['stroke', 'transparent'],\n      ['stroke-width', Math.max(this.strokeWidth, 8).toString()],\n    ]);\n    this.selectorVisual!.appendChild(line);\n    this.selectorVisualLines.push(line);\n  }\n\n  public getState(): PolygonMarkerState {\n    const result: PolygonMarkerState = Object.assign(\n      {\n        points: this.points,\n      },\n      super.getState(),\n    );\n    result.typeName = PolygonMarker.typeName;\n\n    return result;\n  }\n\n  public restoreState(state: MarkerBaseState): void {\n    super.restoreState(state);\n\n    const pmState = state as PolygonMarkerState;\n    this.points = pmState.points;\n\n    this.createVisual();\n    this.adjustVisual();\n  }\n\n  public scale(scaleX: number, scaleY: number): void {\n    super.scale(scaleX, scaleY);\n\n    this.points.forEach((p) => {\n      p.x = p.x * scaleX;\n      p.y = p.y * scaleY;\n    });\n\n    this.adjustVisual();\n  }\n}\n","import { FreehandMarkerState } from './FreehandMarkerState';\nimport { IPoint } from './IPoint';\nimport { MarkerBase } from './MarkerBase';\nimport { MarkerBaseState } from './MarkerBaseState';\nimport { SvgHelper } from './SvgHelper';\n\n/**\n * Freehand marker represents a hand drawing.\n *\n * Unlike v2 in v3 freehand marker is represented by an SVG path element.\n * This means that the line properties like stroke color, width, dasharray, etc.\n * can be modified after drawing.\n *\n * @summary Freehand drawing marker.\n * @group Markers\n */\nexport class FreehandMarker extends MarkerBase {\n  public static typeName = 'FreehandMarker';\n  public static title = 'Freehand marker';\n  public static applyDefaultFilter = false;\n\n  /**\n   * Points of the freehand line.\n   */\n  public points: IPoint[] = [];\n\n  /**\n   * Marker's main visual.\n   */\n  public visual: SVGGraphicsElement | undefined;\n\n  /**\n   * Wider invisible visual to make it easier to select and manipulate the marker.\n   */\n  protected selectorVisual: SVGGraphicsElement | undefined;\n  /**\n   * Visible visual of the marker.\n   */\n  public visibleVisual: SVGGraphicsElement | undefined;\n\n  protected applyStrokeColor() {\n    if (this.visibleVisual) {\n      SvgHelper.setAttributes(this.visibleVisual, [\n        ['stroke', this._strokeColor],\n      ]);\n    }\n  }\n\n  protected applyStrokeWidth() {\n    if (this.visibleVisual) {\n      SvgHelper.setAttributes(this.visibleVisual, [\n        ['stroke-width', this._strokeWidth.toString()],\n      ]);\n    }\n    if (this.selectorVisual) {\n      SvgHelper.setAttributes(this.selectorVisual, [\n        ['stroke-width', Math.max(this._strokeWidth, 8).toString()],\n      ]);\n    }\n  }\n\n  protected applyStrokeDasharray() {\n    if (this.visibleVisual) {\n      SvgHelper.setAttributes(this.visibleVisual, [\n        ['stroke-dasharray', this._strokeDasharray],\n      ]);\n    }\n  }\n\n  protected applyOpacity() {\n    if (this.visibleVisual) {\n      SvgHelper.setAttributes(this.visibleVisual, [\n        ['opacity', this._opacity.toString()],\n      ]);\n    }\n  }\n\n  constructor(container: SVGGElement) {\n    super(container);\n\n    this.strokeColor = '#ff0000';\n    this.strokeWidth = 3;\n\n    this.createVisual = this.createVisual.bind(this);\n    this.adjustVisual = this.adjustVisual.bind(this);\n    this.getState = this.getState.bind(this);\n    this.restoreState = this.restoreState.bind(this);\n    this.scale = this.scale.bind(this);\n  }\n\n  public ownsTarget(el: EventTarget): boolean {\n    if (\n      super.ownsTarget(el) ||\n      el === this.visual ||\n      el === this.selectorVisual ||\n      el === this.visibleVisual\n    ) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Returns SVG path string representing the freehand line.\n   *\n   * @returns SVG path string representing the freehand line.\n   */\n  protected getPath(): string {\n    if (this.points.length > 1) {\n      return this.points\n        .map((p, i) => `${i === 0 ? 'M' : 'L'}${p.x},${p.y}`)\n        .join(' ');\n    }\n    return 'M0,0';\n  }\n\n  /**\n   * Creates the visual elements comprising the marker's visual.\n   */\n  public createVisual(): void {\n    this.visual = SvgHelper.createGroup();\n    this.selectorVisual = SvgHelper.createPath(this.getPath(), [\n      ['stroke', 'transparent'],\n      ['fill', 'transparent'],\n      ['stroke-width', Math.max(this.strokeWidth, 8).toString()],\n    ]);\n    this.visibleVisual = SvgHelper.createPath(this.getPath(), [\n      ['stroke', this.strokeColor],\n      ['fill', 'transparent'],\n      ['stroke-width', this.strokeWidth.toString()],\n      ['opacity', this.opacity.toString()],\n    ]);\n    this.visual.appendChild(this.selectorVisual);\n    this.visual.appendChild(this.visibleVisual);\n\n    this.addMarkerVisualToContainer(this.visual);\n  }\n\n  /**\n   * Adjusts marker visual after manipulation or with new points.\n   */\n  public adjustVisual(): void {\n    if (this.selectorVisual && this.visibleVisual) {\n      const path = this.getPath();\n      SvgHelper.setAttributes(this.selectorVisual, [['d', path]]);\n      SvgHelper.setAttributes(this.visibleVisual, [['d', path]]);\n\n      SvgHelper.setAttributes(this.visibleVisual, [\n        ['stroke', this.strokeColor],\n        ['stroke-width', this.strokeWidth.toString()],\n        ['stroke-dasharray', this.strokeDasharray.toString()],\n        ['stroke-dasharray', this.strokeDasharray.toString()],\n        ['opacity', this.opacity.toString()],\n      ]);\n    }\n  }\n\n  public getState(): FreehandMarkerState {\n    const result: FreehandMarkerState = Object.assign(\n      {\n        points: this.points,\n      },\n      super.getState(),\n    );\n    result.typeName = FreehandMarker.typeName;\n\n    return result;\n  }\n\n  public restoreState(state: MarkerBaseState): void {\n    super.restoreState(state);\n\n    const pmState = state as FreehandMarkerState;\n    this.points = pmState.points;\n\n    this.createVisual();\n    this.adjustVisual();\n  }\n\n  public scale(scaleX: number, scaleY: number): void {\n    super.scale(scaleX, scaleY);\n\n    this.points.forEach((p) => {\n      p.x = p.x * scaleX;\n      p.y = p.y * scaleY;\n    });\n\n    this.adjustVisual();\n  }\n}\n","/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\r\n    function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\r\n    var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\r\n    var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\r\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\r\n    var _, done = false;\r\n    for (var i = decorators.length - 1; i >= 0; i--) {\r\n        var context = {};\r\n        for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\r\n        for (var p in contextIn.access) context.access[p] = contextIn.access[p];\r\n        context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\r\n        var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\r\n        if (kind === \"accessor\") {\r\n            if (result === void 0) continue;\r\n            if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\r\n            if (_ = accept(result.get)) descriptor.get = _;\r\n            if (_ = accept(result.set)) descriptor.set = _;\r\n            if (_ = accept(result.init)) initializers.unshift(_);\r\n        }\r\n        else if (_ = accept(result)) {\r\n            if (kind === \"field\") initializers.unshift(_);\r\n            else descriptor[key] = _;\r\n        }\r\n    }\r\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\r\n    done = true;\r\n};\r\n\r\nexport function __runInitializers(thisArg, initializers, value) {\r\n    var useValue = arguments.length > 2;\r\n    for (var i = 0; i < initializers.length; i++) {\r\n        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\r\n    }\r\n    return useValue ? value : void 0;\r\n};\r\n\r\nexport function __propKey(x) {\r\n    return typeof x === \"symbol\" ? x : \"\".concat(x);\r\n};\r\n\r\nexport function __setFunctionName(f, name, prefix) {\r\n    if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\r\n    return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\r\n};\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n\r\nexport function __addDisposableResource(env, value, async) {\r\n    if (value !== null && value !== void 0) {\r\n        if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\r\n        var dispose;\r\n        if (async) {\r\n            if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\r\n            dispose = value[Symbol.asyncDispose];\r\n        }\r\n        if (dispose === void 0) {\r\n            if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\r\n            dispose = value[Symbol.dispose];\r\n        }\r\n        if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\r\n        env.stack.push({ value: value, dispose: dispose, async: async });\r\n    }\r\n    else if (async) {\r\n        env.stack.push({ async: true });\r\n    }\r\n    return value;\r\n}\r\n\r\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\r\n\r\nexport function __disposeResources(env) {\r\n    function fail(e) {\r\n        env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\r\n        env.hasError = true;\r\n    }\r\n    function next() {\r\n        while (env.stack.length) {\r\n            var rec = env.stack.pop();\r\n            try {\r\n                var result = rec.dispose && rec.dispose.call(rec.value);\r\n                if (rec.async) return Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\r\n            }\r\n            catch (e) {\r\n                fail(e);\r\n            }\r\n        }\r\n        if (env.hasError) throw env.error;\r\n    }\r\n    return next();\r\n}\r\n\r\nexport default {\r\n    __extends: __extends,\r\n    __assign: __assign,\r\n    __rest: __rest,\r\n    __decorate: __decorate,\r\n    __param: __param,\r\n    __metadata: __metadata,\r\n    __awaiter: __awaiter,\r\n    __generator: __generator,\r\n    __createBinding: __createBinding,\r\n    __exportStar: __exportStar,\r\n    __values: __values,\r\n    __read: __read,\r\n    __spread: __spread,\r\n    __spreadArrays: __spreadArrays,\r\n    __spreadArray: __spreadArray,\r\n    __await: __await,\r\n    __asyncGenerator: __asyncGenerator,\r\n    __asyncDelegator: __asyncDelegator,\r\n    __asyncValues: __asyncValues,\r\n    __makeTemplateObject: __makeTemplateObject,\r\n    __importStar: __importStar,\r\n    __importDefault: __importDefault,\r\n    __classPrivateFieldGet: __classPrivateFieldGet,\r\n    __classPrivateFieldSet: __classPrivateFieldSet,\r\n    __classPrivateFieldIn: __classPrivateFieldIn,\r\n    __addDisposableResource: __addDisposableResource,\r\n    __disposeResources: __disposeResources,\r\n};\r\n","import { FontSize } from './FontSize';\nimport { SvgHelper } from './SvgHelper';\n\n/**\n * TextBlock represents a block of text used across all text-based markers.\n */\nexport class TextBlock {\n  /**\n   * Fired when text size changes.\n   *\n   * @group Events\n   */\n  public onTextSizeChanged?: (textBlock: TextBlock) => void;\n\n  private _text = '';\n  /**\n   * Returns the text block's text.\n   */\n  public get text() {\n    return this._text;\n  }\n  /**\n   * Sets the text block's text.\n   */\n  public set text(value) {\n    this._text = value;\n    this.renderText();\n  }\n\n  /**\n   * Text block's horizontal offset from the automatically calculated position.\n   */\n  public offsetX = 0;\n  /**\n   * Text block's vertical offset from the automatically calculated position.\n   */\n  public offsetY = 0;\n\n  private _boundingBox: DOMRect = new DOMRect();\n  /**\n   * Returns the bounding box where text should fit and/or be anchored.\n   */\n  public get boundingBox(): DOMRect {\n    return this._boundingBox;\n  }\n  /**\n   * Sets the bounding box where text should fit and/or be anchored.\n   */\n  public set boundingBox(value: DOMRect) {\n    this._boundingBox = value;\n    this.renderText();\n    //this.positionText();\n  }\n\n  private _labelBackground: SVGRectElement = SvgHelper.createRect(10, 10, [\n    ['fill', 'white'],\n  ]);\n  /**\n   * Returns the background rectangle (behind the text).\n   */\n  public get labelBackground(): SVGRectElement {\n    return this._labelBackground;\n  }\n\n  private _textElement: SVGTextElement = SvgHelper.createText();\n  /**\n   * Returns the text block's text element.\n   */\n  public get textElement(): SVGTextElement {\n    return this._textElement;\n  }\n\n  private _color = 'transparent';\n  /**\n   * Sets the text color.\n   */\n  public set color(value: string) {\n    if (this.textElement) {\n      SvgHelper.setAttributes(this._textElement, [['fill', value]]);\n    }\n    this._color = value;\n  }\n  /**\n   * Returns the text color.\n   */\n  public get color(): string {\n    return this._color;\n  }\n\n  private _fontFamily = '';\n  /**\n   * Returns the text's font family.\n   */\n  public get fontFamily() {\n    return this._fontFamily;\n  }\n  /**\n   * Sets the text's font family.\n   */\n  public set fontFamily(value) {\n    if (this._textElement) {\n      this._textElement.style.fontFamily = value;\n    }\n    this._fontFamily = value;\n    this.positionText();\n  }\n\n  private _fontSize: FontSize = {\n    value: 1,\n    units: 'rem',\n    step: 0.1,\n  };\n  /**\n   * Returns the text's font size.\n   */\n  public get fontSize() {\n    return this._fontSize;\n  }\n  /**\n   * Sets the text's font size.\n   */\n  public set fontSize(value: FontSize) {\n    if (this._textElement) {\n      this._textElement.style.fontSize = `${value.value}${value.units}`;\n    }\n    this._fontSize = value;\n    this.positionText();\n  }\n\n  /**\n   * Creates a text block\n   * @param text initial text\n   */\n  constructor(text?: string) {\n    this.setupTextElement();\n\n    if (text !== undefined) {\n      this.text = text;\n    }\n\n    this.setupTextElement = this.setupTextElement.bind(this);\n    this.renderText = this.renderText.bind(this);\n    this.positionText = this.positionText.bind(this);\n    this.ownsTarget = this.ownsTarget.bind(this);\n    this.show = this.show.bind(this);\n    this.hide = this.hide.bind(this);\n    this.showControlBox = this.showControlBox.bind(this);\n    this.hideControlBox = this.hideControlBox.bind(this);\n    this.applyFontStyles = this.applyFontStyles.bind(this);\n    this.wrapText = this.wrapText.bind(this);\n  }\n\n  /**\n   * Returns true if the text block contains the supplied element.\n   * @param el element to test.\n   * @returns true if the element belongs to the text block, false otherwise.\n   */\n  public ownsTarget(el: EventTarget) {\n    if (el === this._textElement) {\n      return true;\n    } else {\n      let found = false;\n      this._textElement.childNodes.forEach((span) => {\n        if (span === el) {\n          found = true;\n        }\n      });\n      return found;\n    }\n  }\n\n  private setupTextElement() {\n    this._textElement.style.fontSize = `${this.fontSize.value}${this.fontSize.units}`;\n    this._textElement.style.textAnchor = 'middle';\n    this._textElement.style.userSelect = 'none';\n\n    this._labelBackground.style.stroke = '#aaa';\n    this._labelBackground.style.strokeDasharray = '2 2';\n    this._labelBackground.style.strokeWidth = '1';\n    this._labelBackground.style.strokeOpacity = '0';\n  }\n\n  private wrapText(): string {\n    function getTextAspectRatio(textLines: string[]): number {\n      const charsLinesAspectRatio = 0.35;\n\n      let longestLineChars = textLines[0].length;\n      textLines.forEach((line) => {\n        if (line.length > longestLineChars) {\n          longestLineChars = line.length;\n        }\n      });\n\n      return (longestLineChars * charsLinesAspectRatio) / textLines.length;\n    }\n\n    if (this.text !== '') {\n      const lines = this.text.split(/\\r\\n|[\\n\\v\\f\\r\\x85\\u2028\\u2029]/);\n      const boxAspectRatio =\n        (this.boundingBox.width * 1.0) / this.boundingBox.height;\n      let processedLines = new Array<string>(...lines);\n\n      let textAspectRatio = getTextAspectRatio(processedLines);\n\n      let maxLineLength = Number.MAX_VALUE;\n      while (textAspectRatio > boxAspectRatio) {\n        let longestLine = processedLines[0];\n        processedLines.forEach((line) => {\n          if (line.length > longestLine.length) {\n            longestLine = line;\n          }\n        });\n        maxLineLength = longestLine.lastIndexOf(' ', maxLineLength - 1);\n\n        if (maxLineLength > 0) {\n          processedLines = [];\n          lines.forEach((line) => {\n            let reminderLine = line;\n            while (reminderLine.length > maxLineLength) {\n              let maxEnd = reminderLine.lastIndexOf(' ', maxLineLength);\n              if (maxEnd < 0) {\n                // if the first word is longer than max, at least wrap after it\n                maxEnd = reminderLine.indexOf(' ');\n              }\n              if (maxEnd > 0) {\n                processedLines.push(reminderLine.substring(0, maxEnd));\n                reminderLine = reminderLine.substring(maxEnd).trim();\n              } else {\n                processedLines.push(reminderLine);\n                reminderLine = '';\n              }\n            }\n            processedLines.push(reminderLine);\n          });\n          textAspectRatio = getTextAspectRatio(processedLines);\n        } else {\n          // can't wrap no more\n          textAspectRatio = -1;\n        }\n      }\n\n      return processedLines.join(`\\r\\n`);\n    } else {\n      return this.text;\n    }\n  }\n\n  public wordWrap = false;\n  private prevWrappedText = '';\n  /**\n   * Renders text within the text block according to its settings.\n   */\n  public async renderText() {\n    const LINE_SIZE = '1em'; // `${this.fontSize.value}${this.fontSize.units}`;\n\n    if (this._textElement) {\n      const processedText = this.wordWrap ? this.wrapText() : this.text;\n      if (this.prevWrappedText === processedText) {\n        this.positionText();\n        return;\n      }\n      this.prevWrappedText = processedText;\n\n      while (this._textElement.lastChild) {\n        this._textElement.removeChild(this._textElement.lastChild);\n      }\n\n      const lines = processedText.split(/\\r\\n|[\\n\\v\\f\\r\\x85\\u2028\\u2029]/);\n      lines.forEach((line, lineno) => {\n        this._textElement.appendChild(\n          SvgHelper.createTSpan(\n            // workaround for swallowed empty lines\n            line.trim() === '' ? ' ' : line.trim(),\n            [\n              // ['x', '0'],\n              ['dy', lineno > 0 ? LINE_SIZE : '0'],\n            ],\n          ),\n        );\n      });\n\n      // hide to prevent jerky movements during layout\n      this.textElement.style.opacity = '0';\n\n      // Wait for next frame to ensure DOM is updated\n      await new Promise((resolve) => requestAnimationFrame(resolve));\n      this.positionText(this);\n    }\n  }\n\n  private applyFontStyles() {\n    this._textElement.childNodes.forEach((ts) => {\n      const tspan = <SVGTSpanElement>ts;\n      tspan.style.fontFamily = this._textElement.style.fontFamily;\n      tspan.style.fontSize = this._textElement.style.fontSize;\n    });\n  }\n\n  private _textSize?: DOMRect;\n  /**\n   * Returns the size of the rectangle containing the text block's text.\n   */\n  public get textSize(): DOMRect | undefined {\n    return this._textSize;\n  }\n\n  /**\n   * Positions the text within the text block.\n   * @param textBlock\n   */\n  public positionText(textBlock?: TextBlock) {\n    const self = textBlock === undefined ? this : textBlock;\n    const LINE_SIZE = '1em'; //`${this.fontSize.value}${this.fontSize.units}`;\n\n    self.applyFontStyles();\n\n    self._textSize = self._textElement.getBBox();\n    const centerX =\n      self.boundingBox.x + self._textSize.width / 2 + self.offsetX;\n\n    const noOfLines = self._textElement.childNodes.length;\n    const lineHeight = self._textSize.height / noOfLines;\n    // arbitrary approximation for correct vertical alignment\n    const autoOffset =\n      noOfLines > 1 ? -(lineHeight * (noOfLines - 2)) / 2 : lineHeight / 3;\n\n    const centerY =\n      self.boundingBox.y +\n      self._textSize.height / 2 +\n      // - self._textSize.height / 2\n      autoOffset +\n      self.offsetY;\n\n    self._textElement.childNodes.forEach((ts, lineno) => {\n      const tspan = <SVGTSpanElement>ts;\n      SvgHelper.setAttributes(tspan, [\n        ['x', `${centerX}`],\n        ['dy', lineno > 0 ? LINE_SIZE : '0'],\n      ]);\n    });\n    SvgHelper.setAttributes(self._textElement, [['x', `${centerX}`]]);\n    SvgHelper.setAttributes(self._textElement, [['y', `${centerY}`]]);\n\n    self._textSize = self._textElement.getBBox();\n    const bgPadding = 1.2;\n    SvgHelper.setAttributes(self.labelBackground, [\n      ['width', (self._textSize.width * bgPadding).toString()],\n      ['height', (self._textSize.height * bgPadding).toString()],\n      ['x', (centerX - (self._textSize.width * bgPadding) / 2).toString()],\n      [\n        'y',\n        (self._textSize.y - bgPadding)\n          // centerY -\n          // (self._textSize.height / 2) * (bgPadding - 1) * 2\n          // - lineHeight / 2\n          .toString(),\n      ],\n    ]);\n\n    if (self.onTextSizeChanged) {\n      self.onTextSizeChanged(self);\n    }\n\n    // restore visibility\n    this.textElement.style.opacity = '1';\n  }\n\n  /**\n   * Makes the text block content visible.\n   */\n  public show() {\n    this._textElement.style.display = '';\n    this._labelBackground.style.display = '';\n  }\n  /**\n   * Hides the text block content.\n   */\n  public hide() {\n    this._textElement.style.display = 'none';\n    this._labelBackground.style.display = 'none';\n  }\n\n  /**\n   * Shows the text block's dashed outline.\n   */\n  public showControlBox() {\n    this.labelBackground.style.strokeOpacity = '1';\n  }\n  /**\n   * Hides the text block's dashed outline.\n   */\n  public hideControlBox() {\n    this.labelBackground.style.strokeOpacity = '0';\n  }\n}\n","import { FontSize } from './FontSize';\nimport { MarkerBaseState } from './MarkerBaseState';\nimport { RectangularBoxMarkerBase } from './RectangularBoxMarkerBase';\nimport { SvgHelper } from './SvgHelper';\nimport { TextBlock } from './TextBlock';\nimport { TextMarkerState } from './TextMarkerState';\n\n/**\n * Text marker.\n *\n * Used to represent a text block as well a base class for other text-based markers.\n *\n * @summary Text marker.\n * @group Markers\n */\nexport class TextMarker extends RectangularBoxMarkerBase {\n  public static typeName = 'TextMarker';\n\n  public static title = 'Text marker';\n\n  /**\n   * Default text for the marker type.\n   */\n  protected static DEFAULT_TEXT = 'Text';\n  // protected static DEFAULT_TEXT =\n  //   'Longer text to see what happens when it is too long to fit the bounding box.';\n\n  /**\n   * Callback to be called when the text size changes.\n   */\n  public onSizeChanged?: (textMarker: TextMarker) => void;\n\n  private _color = 'black';\n  /**\n   * Returns markers's text color.\n   */\n  public get color() {\n    return this._color;\n  }\n  /**\n   * Sets the markers's text color.\n   */\n  public set color(value) {\n    this._color = value;\n    this.textBlock.color = value;\n  }\n\n  private _fontFamily = 'Helvetica, Arial, sans-serif';\n  /**\n   * Returns the markers's font family.\n   */\n  public get fontFamily() {\n    return this._fontFamily;\n  }\n  /**\n   * Sets the markers's font family.\n   */\n  public set fontFamily(value) {\n    this._fontFamily = value;\n    this.textBlock.fontFamily = value;\n  }\n\n  private _fontSize: FontSize = {\n    value: 1,\n    units: 'rem',\n    step: 0.1,\n  };\n  /**\n   * Returns the marker's font size.\n   */\n  public get fontSize(): FontSize {\n    return this._fontSize;\n  }\n  /**\n   * Sets the marker's font size.\n   */\n  public set fontSize(value: FontSize) {\n    this._fontSize = value;\n    this.textBlock.fontSize = value;\n  }\n\n  /**\n   * Returns the default text for the marker type.\n   * @returns marker type's default text.\n   */\n  protected getDefaultText(): string {\n    return Object.getPrototypeOf(this).constructor.DEFAULT_TEXT;\n  }\n  private _text: string = this.getDefaultText();\n  /**\n   * Returns the marker's text.\n   */\n  public get text(): string {\n    return this.textBlock.text;\n  }\n  /**\n   * Sets the marker's text.\n   */\n  public set text(value: string) {\n    this._text = value;\n    this.textBlock.text = this._text;\n  }\n\n  /**\n   * Text padding from the bounding box.\n   */\n  public padding = 2;\n\n  /**\n   * Text's bounding box where text should fit and/or be anchored to.\n   */\n  public textBoundingBox: DOMRect;\n\n  /**\n   * Text block handling the text rendering.\n   */\n  public textBlock: TextBlock = new TextBlock(this.getDefaultText());\n\n  constructor(container: SVGGElement) {\n    super(container);\n\n    this.setColor = this.setColor.bind(this);\n    this.setFont = this.setFont.bind(this);\n    this.setFontSize = this.setFontSize.bind(this);\n    this.setSize = this.setSize.bind(this);\n    this.textSizeChanged = this.textSizeChanged.bind(this);\n    this.setSizeFromTextSize = this.setSizeFromTextSize.bind(this);\n\n    this.createVisual = this.createVisual.bind(this);\n    this.adjustVisual = this.adjustVisual.bind(this);\n\n    this.textBoundingBox = new DOMRect();\n  }\n\n  protected applyOpacity() {\n    if (this.visual) {\n      SvgHelper.setAttributes(this.visual, [\n        ['opacity', this.opacity.toString()],\n      ]);\n    }\n  }\n\n  /**\n   * Creates marker's visual.\n   */\n  public createVisual(): void {\n    this.textBlock.fontFamily = this.fontFamily;\n    this.textBlock.fontSize = this.fontSize;\n    this.textBlock.color = this.color;\n    this.textBlock.offsetX = this.padding;\n    this.textBlock.offsetY = this.padding;\n\n    this.textBlock.onTextSizeChanged = this.textSizeChanged;\n\n    this.visual = SvgHelper.createGroup();\n    SvgHelper.setAttributes(this.visual, [\n      ['opacity', this._opacity.toString()],\n    ]);\n    this.visual.appendChild(this.textBlock.textElement);\n    this.addMarkerVisualToContainer(this.visual);\n\n    this.textBlock.text = this._text;\n  }\n\n  /**\n   * Adjusts marker's visual according to the current state.\n   */\n  public adjustVisual(): void {\n    if (this.visual) {\n      SvgHelper.setAttributes(this.visual, [\n        ['opacity', this._opacity.toString()],\n      ]);\n    }\n    this.setSize();\n  }\n\n  public ownsTarget(el: EventTarget): boolean {\n    if (\n      super.ownsTarget(el) ||\n      el === this.visual ||\n      this.textBlock.ownsTarget(el)\n    ) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Sets the text bounding box.\n   */\n  protected setTextBoundingBox() {\n    this.textBoundingBox.x = this.padding;\n    this.textBoundingBox.y = this.padding;\n    this.textBoundingBox.width = Number.MAX_VALUE; // this.width - this.padding * 2;\n    this.textBoundingBox.height = Number.MAX_VALUE; // this.height - this.padding * 2;\n    //this.textBlock.boundingBox = this.textBoundingBox;\n  }\n\n  /**\n   * Sets (adjusts) the marker's size.\n   */\n  public setSize(): void {\n    const [prevWidth, prevHeight] = [this.width, this.height];\n\n    super.setSize();\n    this.setSizeFromTextSize();\n\n    if (\n      (prevWidth !== this.width || prevHeight !== this.height) &&\n      this.onSizeChanged\n    ) {\n      this.onSizeChanged(this);\n    }\n\n    this.setTextBoundingBox();\n  }\n\n  /**\n   * Sets the marker's size based on the text size.\n   */\n  protected setSizeFromTextSize(): void {\n    if (this.textBlock.textSize) {\n      this.width = this.textBlock.textSize.width + this.padding * 2;\n      this.height = this.textBlock.textSize.height + this.padding * 2;\n    }\n\n    this.textBlock.offsetX = this.padding;\n    this.textBlock.offsetY = this.padding;\n  }\n\n  private textSizeChanged(): void {\n    this.adjustVisual();\n  }\n\n  /**\n   * Sets the text color.\n   * @param color text color\n   */\n  public setColor(color: string): void {\n    this.color = color;\n  }\n\n  /**\n   * Sets the font family.\n   * @param font font family string\n   */\n  public setFont(font: string): void {\n    this.fontFamily = font;\n  }\n\n  /**\n   * Sets the font size.\n   * @param fontSize font size\n   */\n  public setFontSize(fontSize: FontSize): void {\n    this.fontSize = fontSize;\n  }\n\n  /**\n   * Hides the marker's visual.\n   *\n   * Used when editing the text.\n   */\n  public hideVisual(): void {\n    if (this.visual) {\n      this.visual.style.visibility = 'hidden';\n    }\n  }\n  /**\n   * Shows the marker's visual.\n   *\n   * Eg. when done editing the text.\n   */\n  public showVisual() {\n    if (this.visual) {\n      this.visual.style.visibility = 'visible';\n      this.textBlock.renderText();\n    }\n  }\n\n  public getState(): TextMarkerState {\n    const result: TextMarkerState = Object.assign(\n      {\n        color: this.color,\n        fontFamily: this.fontFamily,\n        fontSize: this.fontSize,\n        text: this.text,\n        padding: this.padding,\n      },\n      super.getState(),\n    );\n    return result;\n  }\n\n  public restoreState(state: MarkerBaseState): void {\n    const textState = state as TextMarkerState;\n    this.color = textState.color;\n    this.fontFamily = textState.fontFamily;\n    this.fontSize = textState.fontSize;\n    this.text = textState.text;\n    if (textState.padding !== undefined) {\n      this.padding = textState.padding;\n    }\n\n    this.createVisual();\n\n    super.restoreState(state);\n    this.adjustVisual();\n  }\n\n  public scale(scaleX: number, scaleY: number): void {\n    super.scale(scaleX, scaleY);\n\n    const newFontSize = {\n      ...this.fontSize,\n      value: this.fontSize.value * Math.min(scaleX, scaleY),\n    };\n    this.fontSize = newFontSize;\n\n    this.padding = this.padding * Math.min(scaleX, scaleY);\n\n    this.adjustVisual();\n  }\n}\n","import { ShapeMarkerBase } from './ShapeMarkerBase';\n\n/**\n * Cover marker is a filled rectangle marker.\n *\n * A typical use case is to cover some area of the image with a colored rectangle as a \"redaction\".\n *\n * @summary Filled rectangle marker.\n * @group Markers\n */\nexport class CoverMarker extends ShapeMarkerBase {\n  public static typeName = 'CoverMarker';\n  public static title = 'Cover marker';\n  public static applyDefaultFilter = false;\n\n  constructor(container: SVGGElement) {\n    super(container);\n\n    this.fillColor = '#000000';\n    this.strokeColor = 'transparent';\n    this.strokeWidth = 0;\n  }\n\n  protected getPath(\n    width: number = this.width,\n    height: number = this.height,\n  ): string {\n    const result = `M 0 0 \n      H ${width} \n      V ${height} \n      H 0 \n      V 0 Z`;\n\n    return result;\n  }\n}\n","import { ShapeMarkerBase } from './ShapeMarkerBase';\n\n/**\n * Highlight marker is a semi-transparent rectangular marker.\n *\n * @summary Semi-transparent rectangular marker.\n * @group Markers\n */\nexport class HighlightMarker extends ShapeMarkerBase {\n  public static typeName = 'HighlightMarker';\n  public static title = 'Highlight marker';\n  public static applyDefaultFilter = false;\n\n  constructor(container: SVGGElement) {\n    super(container);\n\n    this.fillColor = '#ffff00';\n    this.opacity = 0.5;\n    this.strokeColor = 'transparent';\n    this.strokeWidth = 0;\n  }\n\n  protected getPath(\n    width: number = this.width,\n    height: number = this.height,\n  ): string {\n    const result = `M 0 0 \n      H ${width} \n      V ${height} \n      H 0 \n      V 0 Z`;\n\n    return result;\n  }\n}\n","import { CalloutMarkerState } from './CalloutMarkerState';\nimport { IPoint } from './IPoint';\nimport { MarkerBaseState } from './MarkerBaseState';\nimport { SvgHelper } from './SvgHelper';\nimport { TextMarker } from './TextMarker';\n\n/**\n * Callout marker is a text-based marker with a callout outline with a tip that can point to specific place\n * on the underlying image or annotation.\n *\n * @summary Text-based marker with a callout outline with a tip that can point to specific place\n * on the underlying image or annotation.\n *\n * @group Markers\n */\nexport class CalloutMarker extends TextMarker {\n  public static typeName = 'CalloutMarker';\n\n  public static title = 'Callout marker';\n\n  private _tipPosition: IPoint = { x: 0, y: 0 };\n  /**\n   * Coordinates of the position of the tip of the callout.\n   */\n  public get tipPosition(): IPoint {\n    return this._tipPosition;\n  }\n  public set tipPosition(value: IPoint) {\n    this._tipPosition = value;\n    this.adjustVisual();\n  }\n\n  private tipBase1Position: IPoint = { x: 0, y: 0 };\n  private tipBase2Position: IPoint = { x: 0, y: 0 };\n\n  private _calloutVisual: SVGPathElement = SvgHelper.createPath('M0,0');\n\n  constructor(container: SVGGElement) {\n    super(container);\n\n    this.color = '#ffffff';\n    this.fillColor = '#ff0000';\n    this.strokeColor = '#ffffff';\n    this.strokeWidth = 3;\n    this.padding = 20;\n\n    this.createVisual = this.createVisual.bind(this);\n    this.adjustVisual = this.adjustVisual.bind(this);\n    this.getPath = this.getPath.bind(this);\n    this.setTipPoints = this.setTipPoints.bind(this);\n  }\n\n  protected applyStrokeColor() {\n    SvgHelper.setAttributes(this._calloutVisual, [\n      ['stroke', this._strokeColor],\n    ]);\n  }\n\n  protected applyStrokeWidth() {\n    SvgHelper.setAttributes(this._calloutVisual, [\n      ['stroke-width', this._strokeWidth.toString()],\n    ]);\n  }\n\n  protected applyStrokeDasharray() {\n    SvgHelper.setAttributes(this._calloutVisual, [\n      ['stroke-dasharray', this._strokeDasharray],\n    ]);\n  }\n\n  protected applyOpacity() {\n    if (this.visual) {\n      SvgHelper.setAttributes(this.visual, [\n        ['opacity', this._opacity.toString()],\n      ]);\n    }\n  }\n\n  protected applyFillColor() {\n    SvgHelper.setAttributes(this._calloutVisual, [['fill', this._fillColor]]);\n  }\n\n  /**\n   * Returns the SVG path string for the callout outline.\n   *\n   * @returns Path string for the callout outline.\n   */\n  protected getPath(): string {\n    const r = 5;\n    this.setTipPoints();\n\n    const result = `M ${r} 0 \n      ${\n        this.tipBase1Position.y === 0\n          ? `H ${this.tipBase1Position.x} L ${this.tipPosition.x} ${this.tipPosition.y} L ${this.tipBase2Position.x} 0`\n          : ''\n      }\n      H ${this.width - r} \n      A ${r} ${r} 0 0 1 ${this.width} ${r} \n      ${\n        this.tipBase1Position.x === this.width\n          ? `V ${this.tipBase1Position.y} L ${this.tipPosition.x} ${this.tipPosition.y} L  ${this.tipBase2Position.x} ${this.tipBase2Position.y}`\n          : ''\n      }\n      V ${this.height - r} \n      A ${r} ${r} 0 0 1 ${this.width - r} ${this.height} \n      ${\n        this.tipBase1Position.y === this.height\n          ? `H ${this.tipBase2Position.x} L ${this.tipPosition.x} ${this.tipPosition.y} L ${this.tipBase1Position.x} ${this.height}`\n          : ''\n      }\n      H ${r}\n      A ${r} ${r} 0 0 1 0 ${this.height - r} \n      ${\n        this.tipBase1Position.x === 0\n          ? `V ${this.tipBase2Position.y} L ${this.tipPosition.x} ${this.tipPosition.y} L  ${this.tipBase1Position.x} ${this.tipBase1Position.y}`\n          : ''\n      }\n      V ${r} \n      A ${r} ${r} 0 0 1 ${r} 0 \n      Z`;\n\n    return result;\n  }\n\n  private setTipPoints() {\n    let offset = Math.min(this.height / 2, 15);\n    let baseWidth = this.height / 5;\n\n    const cornerAngle = Math.atan(this.height / 2 / (this.width / 2));\n    if (\n      this.tipPosition.x < this.width / 2 &&\n      this.tipPosition.y < this.height / 2\n    ) {\n      // top left\n      const tipAngle = Math.atan(\n        (this.height / 2 - this.tipPosition.y) /\n          (this.width / 2 - this.tipPosition.x),\n      );\n      if (cornerAngle < tipAngle) {\n        baseWidth = this.width / 5;\n        offset = Math.min(this.width / 2, 15);\n        this.tipBase1Position = { x: offset, y: 0 };\n        this.tipBase2Position = { x: offset + baseWidth, y: 0 };\n      } else {\n        this.tipBase1Position = { x: 0, y: offset };\n        this.tipBase2Position = { x: 0, y: offset + baseWidth };\n      }\n    } else if (\n      this.tipPosition.x >= this.width / 2 &&\n      this.tipPosition.y < this.height / 2\n    ) {\n      // top right\n      const tipAngle = Math.atan(\n        (this.height / 2 - this.tipPosition.y) /\n          (this.tipPosition.x - this.width / 2),\n      );\n      if (cornerAngle < tipAngle) {\n        baseWidth = this.width / 5;\n        offset = Math.min(this.width / 2, 15);\n        this.tipBase1Position = { x: this.width - offset - baseWidth, y: 0 };\n        this.tipBase2Position = { x: this.width - offset, y: 0 };\n      } else {\n        this.tipBase1Position = { x: this.width, y: offset };\n        this.tipBase2Position = { x: this.width, y: offset + baseWidth };\n      }\n    } else if (\n      this.tipPosition.x >= this.width / 2 &&\n      this.tipPosition.y >= this.height / 2\n    ) {\n      // bottom right\n      const tipAngle = Math.atan(\n        (this.tipPosition.y - this.height / 2) /\n          (this.tipPosition.x - this.width / 2),\n      );\n      if (cornerAngle < tipAngle) {\n        baseWidth = this.width / 5;\n        offset = Math.min(this.width / 2, 15);\n        this.tipBase1Position = {\n          x: this.width - offset - baseWidth,\n          y: this.height,\n        };\n        this.tipBase2Position = { x: this.width - offset, y: this.height };\n      } else {\n        this.tipBase1Position = {\n          x: this.width,\n          y: this.height - offset - baseWidth,\n        };\n        this.tipBase2Position = { x: this.width, y: this.height - offset };\n      }\n    } else {\n      // bottom left\n      const tipAngle = Math.atan(\n        (this.tipPosition.y - this.height / 2) /\n          (this.width / 2 - this.tipPosition.x),\n      );\n      if (cornerAngle < tipAngle) {\n        baseWidth = this.width / 5;\n        offset = Math.min(this.width / 2, 15);\n        this.tipBase1Position = { x: offset, y: this.height };\n        this.tipBase2Position = { x: offset + baseWidth, y: this.height };\n      } else {\n        this.tipBase1Position = { x: 0, y: this.height - offset - baseWidth };\n        this.tipBase2Position = { x: 0, y: this.height - offset };\n      }\n    }\n  }\n\n  public createVisual(): void {\n    super.createVisual();\n\n    this._tipPosition = {\n      // x: -50,\n      // x: this.width + 50,\n      x: this.width / 4,\n      // y: this.height / 4,\n      // y: -50,\n      y: this.height + 20,\n    };\n\n    this._calloutVisual = SvgHelper.createPath(this.getPath(), [\n      ['fill', this._fillColor],\n      ['stroke', this._strokeColor],\n      ['stroke-width', this._strokeWidth.toString()],\n      ['stroke-dasharray', this._strokeDasharray],\n    ]);\n    this.visual?.insertBefore(this._calloutVisual, this.textBlock.textElement);\n  }\n\n  public adjustVisual(): void {\n    super.adjustVisual();\n    if (this._calloutVisual) {\n      SvgHelper.setAttributes(this._calloutVisual, [\n        ['d', this.getPath()],\n        ['fill', this._fillColor],\n        ['stroke', this._strokeColor],\n        ['stroke-width', this._strokeWidth.toString()],\n        ['stroke-dasharray', this._strokeDasharray],\n      ]);\n    }\n  }\n\n  public ownsTarget(el: EventTarget): boolean {\n    if (super.ownsTarget(el) || this._calloutVisual === el) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  public getState(): CalloutMarkerState {\n    const result: CalloutMarkerState = Object.assign(\n      {\n        fillColor: this.fillColor,\n        tipPosition: this.tipPosition,\n      },\n      super.getState(),\n    );\n\n    return result;\n  }\n\n  public restoreState(state: MarkerBaseState): void {\n    const calloutState = state as CalloutMarkerState;\n    super.restoreState(state);\n    this.fillColor = calloutState.fillColor;\n    this.tipPosition = calloutState.tipPosition;\n\n    this.adjustVisual();\n  }\n\n  public scale(scaleX: number, scaleY: number): void {\n    super.scale(scaleX, scaleY);\n\n    // this.width = this.width * scaleX;\n    // this.height = this.height * scaleY;\n\n    this.strokeWidth *= (scaleX + scaleY) / 2;\n\n    this._tipPosition = {\n      x: this._tipPosition.x * scaleX,\n      y: this._tipPosition.y * scaleY,\n    };\n\n    this.adjustVisual();\n  }\n}\n","import { ShapeOutlineMarkerBase } from './ShapeOutlineMarkerBase';\n\n/**\n * Ellipse frame marker represents unfilled circle/ellipse shape.\n *\n * @summary Unfilled ellipse marker.\n * @group Markers\n */\nexport class EllipseFrameMarker extends ShapeOutlineMarkerBase {\n  public static typeName = 'EllipseFrameMarker';\n  public static title = 'Ellipse frame marker';\n\n  constructor(container: SVGGElement) {\n    super(container);\n\n    this.strokeColor = '#ff0000';\n    this.strokeWidth = 3;\n  }\n\n  protected getPath(\n    width: number = this.width,\n    height: number = this.height,\n  ): string {\n    const result = `M ${width / 2} 0 \n       a ${width / 2} ${height / 2} 0 1 0 0 ${height} \n       a ${width / 2} ${height / 2} 0 1 0 0 -${height} z`;\n\n    return result;\n  }\n}\n","import { ShapeMarkerBase } from './ShapeMarkerBase';\n\n/**\n * Ellipse marker is a filled ellipse marker.\n *\n * @summary Filled ellipse marker.\n * @group Markers\n */\nexport class EllipseMarker extends ShapeMarkerBase {\n  public static typeName = 'EllipseMarker';\n  public static title = 'Ellipse marker';\n\n  constructor(container: SVGGElement) {\n    super(container);\n\n    this.fillColor = '#ff0000';\n    this.strokeColor = '#ff0000';\n  }\n\n  protected getPath(\n    width: number = this.width,\n    height: number = this.height,\n  ): string {\n    const result = `M ${width / 2} 0 \n    a ${width / 2} ${height / 2} 0 1 0 0 ${height} \n    a ${width / 2} ${height / 2} 0 1 0 0 -${height} z`;\n\n    return result;\n  }\n}\n","import { ImageMarkerBaseState, ImageType } from './ImageMarkerBaseState';\nimport { RectangularBoxMarkerBase } from './RectangularBoxMarkerBase';\nimport { SvgHelper } from './SvgHelper';\n\n/**\n * Base class for image markers.\n *\n * This class isn't meant to be used directly. Use one of the derived classes instead.\n *\n * @summary Image marker base class.\n * @group Markers\n */\nexport class ImageMarkerBase extends RectangularBoxMarkerBase {\n  public static title = 'Image marker';\n\n  /**\n   * Main SVG or image element of the marker.\n   */\n  protected SVGImage?: SVGSVGElement | SVGImageElement;\n  /**\n   * Type of the image: SVG or bitmap.\n   */\n  protected imageType: ImageType = 'svg';\n\n  /**\n   * For SVG images this holds the SVG markup of the image.\n   */\n  protected _svgString?: string;\n  /**\n   * For SVG images this holds the SVG markup of the image.\n   */\n  public get svgString() {\n    return this._svgString;\n  }\n  public set svgString(value) {\n    this._svgString = value;\n    if (this.SVGImage && this.imageType === 'svg') {\n      if (value !== undefined) {\n        this.SVGImage.outerHTML = value;\n      } else {\n        this.SVGImage.outerHTML = '';\n      }\n    }\n  }\n\n  /**\n   * For bitmap images this holds the base64 encoded image.\n   */\n  protected _imageSrc?: string; // = 'data:image/png;base64,...';\n  /**\n   * For bitmap images this holds the base64 encoded image.\n   *\n   * @remarks\n   * Technically this could be any URL but due to browser security constraints\n   * an external image will almost certainly cause bitmap rendering of the image to fail.\n   *\n   * In cases you know you will never render the annotation as a static image,\n   * it should be safe to use external URLs. Otherwise, use base64 encoded images\n   * like 'data:image/png;base64,...'.\n   */\n  public get imageSrc() {\n    return this._imageSrc;\n  }\n  public set imageSrc(value) {\n    this._imageSrc = value;\n    if (this.SVGImage && this.imageType === 'bitmap') {\n      if (value !== undefined) {\n        SvgHelper.setAttributes(this.SVGImage, [['href', value]]);\n      } else {\n        SvgHelper.setAttributes(this.SVGImage, [['href', '']]);\n      }\n    }\n  }\n\n  /**\n   * Natural (real) width of the image.\n   */\n  protected naturalWidth = 24;\n  /**\n   * Natural (real) height of the image.\n   */\n  protected naturalHeight = 24;\n\n  constructor(container: SVGGElement) {\n    super(container);\n\n    this.defaultSize = { width: this.naturalWidth, height: this.naturalHeight };\n\n    this.createImage = this.createImage.bind(this);\n    this.createVisual = this.createVisual.bind(this);\n    this.adjustVisual = this.adjustVisual.bind(this);\n    this.adjustImage = this.adjustImage.bind(this);\n  }\n\n  protected applyOpacity() {\n    if (this.visual) {\n      SvgHelper.setAttributes(this.visual, [\n        ['opacity', this.opacity.toString()],\n      ]);\n    }\n  }\n\n  /**\n   * Creates the image element based on the image type and source.\n   */\n  protected createImage(): void {\n    if (this._svgString !== undefined) {\n      this.imageType = 'svg';\n      // Import into current document to avoid cross-document issues\n      const parser = new DOMParser();\n      const doc = parser.parseFromString(this._svgString, 'image/svg+xml');\n      const element = doc.documentElement;\n      if (!(element instanceof SVGSVGElement)) {\n        throw new Error('Invalid SVG string');\n      }\n      const svgElement = element;\n      this.SVGImage = this.container.ownerDocument.importNode(svgElement, true);\n    } else {\n      this.imageType = 'bitmap';\n      this.SVGImage = SvgHelper.createImage([['href', this._imageSrc ?? '']]);\n    }\n  }\n\n  /**\n   * Creates marker's visual, including its image element.\n   */\n  public createVisual(): void {\n    this.createImage();\n    if (this.SVGImage !== undefined) {\n      this.visual = SvgHelper.createGroup();\n\n      if (this.imageType === 'svg') {\n        SvgHelper.setAttributes(this.visual, [\n          ['viewBox', `0 0 ${this.naturalWidth} ${this.naturalHeight}`],\n          ['fill', this._fillColor],\n          ['stroke', this._strokeColor],\n          ['color', this._strokeColor],\n          ['stroke-width', this.strokeWidth.toString()],\n          ['stroke-dasharray', this.strokeDasharray],\n          ['opacity', this.opacity.toString()],\n          ['pointer-events', 'bounding-box'],\n        ]);\n        // } else if (this.imageType === 'bitmap') {\n      }\n      this.adjustImage();\n      this.visual.appendChild(this.SVGImage);\n      this.addMarkerVisualToContainer(this.visual);\n    }\n  }\n\n  /**\n   * Adjusts marker's visual according to the current state\n   * (color, width, etc.).\n   */\n  public adjustVisual(): void {\n    if (this.visual) {\n      SvgHelper.setAttributes(this.visual, [\n        ['opacity', this._opacity.toString()],\n      ]);\n    }\n  }\n\n  /**\n   * Adjusts the image size and position.\n   */\n  public adjustImage(): void {\n    if (this.SVGImage !== undefined) {\n      this.SVGImage.setAttribute('x', `0px`);\n      this.SVGImage.setAttribute('y', `0px`);\n      this.SVGImage.setAttribute('width', `${this.width}px`);\n      this.SVGImage.setAttribute('height', `${this.height}px`);\n    }\n  }\n\n  private isDescendant(parent: Element, target: EventTarget): boolean {\n    if (parent === target) {\n      return true;\n    }\n\n    for (let i = 0; i < parent.children.length; i++) {\n      if (this.isDescendant(parent.children[i], target)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  public ownsTarget(el: EventTarget): boolean {\n    return (\n      super.ownsTarget(el) ||\n      (this.SVGImage !== undefined && this.isDescendant(this.SVGImage, el))\n    );\n  }\n\n  public setSize(): void {\n    super.setSize();\n    if (this.visual) {\n      SvgHelper.setAttributes(this.visual, [\n        ['width', `${this.width}px`],\n        ['height', `${this.height}px`],\n      ]);\n      this.adjustImage();\n    }\n  }\n\n  public getState(): ImageMarkerBaseState {\n    const result: ImageMarkerBaseState = Object.assign(\n      {\n        imageType: this.imageType,\n        svgString: this.svgString,\n        imageSrc: this.imageSrc,\n      },\n      super.getState(),\n    );\n\n    return result;\n  }\n\n  protected applyStrokeColor() {\n    if (this.visual) {\n      SvgHelper.setAttributes(this.visual, [['color', this._strokeColor]]);\n    }\n  }\n\n  public restoreState(state: ImageMarkerBaseState): void {\n    const imgState = state as ImageMarkerBaseState;\n    if (imgState.imageType !== undefined) {\n      this.imageType = imgState.imageType;\n    }\n    if (imgState.svgString !== undefined) {\n      this._svgString = imgState.svgString;\n    }\n    if (imgState.imageSrc !== undefined) {\n      this._imageSrc = imgState.imageSrc;\n    }\n    this.createVisual();\n    super.restoreState(state);\n    this.setSize();\n    this.adjustVisual();\n  }\n\n  public scale(scaleX: number, scaleY: number): void {\n    super.scale(scaleX, scaleY);\n\n    this.setSize();\n  }\n}\n","import { ImageMarkerBase } from './ImageMarkerBase';\n\n/**\n * Used to represent user-set images.\n *\n * Use this marker to display custom images at runtime.\n * For example, you can use this type to represent emojis selected in an emoji picker.\n *\n * @summary Custom image marker.\n * @group Markers\n */\nexport class CustomImageMarker extends ImageMarkerBase {\n  public static typeName = 'CustomImageMarker';\n  public static title = 'Custom image marker';\n}\n","import { ImageMarkerBase } from './ImageMarkerBase';\n\n/**\n * Check mark marker.\n *\n * Represents a check mark image marker. Can be used to quickly mark something as correct, or\n * similar use cases.\n *\n * @summary Check mark image marker.\n * @group Markers\n */\nexport class CheckImageMarker extends ImageMarkerBase {\n  public static typeName = 'CheckImageMarker';\n  public static title = 'Check image marker';\n\n  constructor(container: SVGGElement) {\n    super(container);\n\n    this._svgString = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><g fill=\"none\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"><path d=\"M21.801 10A10 10 0 1 1 17 3.335\"/><path d=\"m9 11l3 3L22 4\"/></g></svg>`;\n    this.strokeColor = '#008000';\n  }\n}\n","import { ImageMarkerBase } from './ImageMarkerBase';\n\n/**\n * X mark image marker.\n *\n * @summary X (crossed) image marker.\n * @group Markers\n */\nexport class XImageMarker extends ImageMarkerBase {\n  public static typeName = 'XImageMarker';\n  public static title = 'X image marker';\n\n  constructor(container: SVGGElement) {\n    super(container);\n\n    this._svgString = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><g fill=\"none\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"><circle cx=\"12\" cy=\"12\" r=\"10\"/><path d=\"m15 9l-6 6m0-6l6 6\"/></g></svg>`;\n    this.strokeColor = '#d00000';\n  }\n}\n","import { CaptionFrameMarkerState } from './CaptionFrameMarkerState';\nimport { MarkerBaseState } from './MarkerBaseState';\nimport { SvgHelper } from './SvgHelper';\nimport { TextMarker } from './TextMarker';\n\n/**\n * Caption frame marker is a combination of a frame (rectangle) and a text caption that goes with it.\n *\n * @summary A combination of a frame (rectangle) and a text caption that goes with it.\n *\n * @group Markers\n */\nexport class CaptionFrameMarker extends TextMarker {\n  public static typeName = 'CaptionFrameMarker';\n\n  public static title = 'Caption frame marker';\n\n  private _outerFrameVisual: SVGPathElement = SvgHelper.createPath('M0,0');\n  private _captionFrameVisual: SVGPathElement = SvgHelper.createPath('M0,0');\n  private _frameVisual: SVGGElement = SvgHelper.createGroup();\n\n  constructor(container: SVGGElement) {\n    super(container);\n\n    this.color = '#ffffff';\n    this.fillColor = '#ff0000';\n    this.strokeColor = '#ff0000';\n    this.strokeWidth = 3;\n    this.padding = 5;\n\n    this.createVisual = this.createVisual.bind(this);\n    this.adjustVisual = this.adjustVisual.bind(this);\n    this.adjustFrameVisual = this.adjustFrameVisual.bind(this);\n    this.getPaths = this.getPaths.bind(this);\n  }\n\n  protected applyStrokeColor() {\n    SvgHelper.setAttributes(this._outerFrameVisual, [\n      ['stroke', this._strokeColor],\n    ]);\n    SvgHelper.setAttributes(this._captionFrameVisual, [\n      ['stroke', this._strokeColor],\n    ]);\n  }\n\n  protected applyStrokeWidth() {\n    SvgHelper.setAttributes(this._outerFrameVisual, [\n      ['stroke-width', this._strokeWidth.toString()],\n    ]);\n    SvgHelper.setAttributes(this._captionFrameVisual, [\n      ['stroke-width', this._strokeWidth.toString()],\n    ]);\n    this.adjustTextPosition();\n    this.adjustFrameVisual();\n  }\n\n  protected applyStrokeDasharray() {\n    SvgHelper.setAttributes(this._outerFrameVisual, [\n      ['stroke-dasharray', this._strokeDasharray],\n    ]);\n    SvgHelper.setAttributes(this._captionFrameVisual, [\n      ['stroke-dasharray', this._strokeDasharray],\n    ]);\n  }\n\n  protected applyOpacity() {\n    if (this.visual) {\n      SvgHelper.setAttributes(this.visual, [\n        ['opacity', this._opacity.toString()],\n      ]);\n    }\n  }\n\n  protected applyFillColor() {\n    SvgHelper.setAttributes(this._captionFrameVisual, [\n      ['fill', this._fillColor],\n    ]);\n  }\n\n  /**\n   * Returns the SVG path strings for the frame and the caption background.\n   *\n   * @param width\n   * @param height\n   * @returns SVG path strings for the frame and the caption background.\n   */\n  protected getPaths(\n    width: number = this.width,\n    height: number = this.height,\n  ): { frame: string; caption: string } {\n    const titleHeight =\n      (this.textBlock.textSize?.height ?? 40) +\n      this.padding * 2 +\n      this.strokeWidth;\n    return {\n      frame: `M 0 0\n      V ${height}\n      H ${width}\n      V 0\n      Z`,\n      caption: `M 0 0\n      H ${width}\n      V ${titleHeight}\n      H 0\n      Z`,\n    };\n  }\n\n  public createVisual(): void {\n    super.createVisual();\n\n    const paths = this.getPaths();\n\n    if (this.visual) {\n      SvgHelper.setAttributes(this.visual, [\n        ['opacity', this._opacity.toString()],\n      ]);\n    }\n    this._outerFrameVisual = SvgHelper.createPath(paths.frame, [\n      ['fill', 'transparent'],\n      ['stroke', this._strokeColor],\n      ['stroke-width', this._strokeWidth.toString()],\n      ['stroke-dasharray', this._strokeDasharray],\n    ]);\n    this._captionFrameVisual = SvgHelper.createPath(paths.caption, [\n      ['fill', 'this._fillColor'],\n      ['fill-rule', 'evenodd'],\n      ['stroke', this._strokeColor],\n      ['stroke-width', this._strokeWidth.toString()],\n      ['stroke-dasharray', this._strokeDasharray],\n    ]);\n    this._frameVisual.appendChild(this._outerFrameVisual);\n    this._frameVisual.appendChild(this._captionFrameVisual);\n    this.visual?.insertBefore(this._frameVisual, this.textBlock.textElement);\n  }\n\n  public adjustVisual(): void {\n    super.adjustVisual();\n\n    this.adjustTextPosition();\n    this.adjustFrameVisual();\n  }\n\n  /**\n   * Adjusts text position inside the caption frame.\n   */\n  protected adjustTextPosition(): void {\n    if (this.textBlock.textSize) {\n      this.textBlock.textElement.style.transform = `translate(${\n        this.width / 2 - this.textBlock.textSize?.width / 2 - this.padding\n      }px, ${this.strokeWidth / 2}px)`;\n    }\n  }\n\n  /**\n   * Adjusts frame visual according to the current marker properties.\n   */\n  protected adjustFrameVisual(): void {\n    const paths = this.getPaths();\n    if (this.visual) {\n      SvgHelper.setAttributes(this.visual, [\n        ['opacity', this._opacity.toString()],\n      ]);\n    }\n\n    if (this._outerFrameVisual) {\n      SvgHelper.setAttributes(this._outerFrameVisual, [\n        ['d', paths.frame],\n        ['stroke', this._strokeColor],\n        ['stroke-width', this._strokeWidth.toString()],\n        ['stroke-dasharray', this._strokeDasharray],\n      ]);\n    }\n    if (this._captionFrameVisual) {\n      SvgHelper.setAttributes(this._captionFrameVisual, [\n        ['d', paths.caption],\n        ['fill', this._fillColor],\n        ['stroke', this._strokeColor],\n        ['stroke-width', this._strokeWidth.toString()],\n        ['stroke-dasharray', this._strokeDasharray],\n      ]);\n    }\n  }\n\n  public ownsTarget(el: EventTarget): boolean {\n    if (\n      super.ownsTarget(el) ||\n      this._outerFrameVisual === el ||\n      this._captionFrameVisual === el\n    ) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  public setSize(): void {\n    super.setSize();\n    this.adjustTextPosition();\n    this.adjustFrameVisual();\n  }\n  protected setSizeFromTextSize(): void {}\n\n  /**\n   * Hides the marker visual.\n   *\n   * Used by the editor to hide rendered marker while editing the text.\n   */\n  public hideVisual(): void {\n    this.textBlock.hide();\n  }\n  /**\n   * Shows the marker visual.\n   *\n   * Used by the editor to show rendered marker after editing the text.\n   */\n  public showVisual() {\n    this.textBlock.show();\n    this.textBlock.renderText();\n  }\n\n  public getState(): CaptionFrameMarkerState {\n    const result: CaptionFrameMarkerState = Object.assign(\n      {\n        fillColor: this.fillColor,\n      },\n      super.getState(),\n    );\n\n    return result;\n  }\n\n  public restoreState(state: MarkerBaseState): void {\n    const captionState = state as CaptionFrameMarkerState;\n    super.restoreState(state);\n    this.fillColor = captionState.fillColor;\n\n    this.adjustVisual();\n  }\n\n  public scale(scaleX: number, scaleY: number): void {\n    super.scale(scaleX, scaleY);\n\n    this.strokeWidth *= (scaleX + scaleY) / 2;\n\n    this.setSize();\n  }\n}\n","import { CurveMarkerState } from './CurveMarkerState';\nimport { LineMarker } from './LineMarker';\n\n/**\n * Curve marker represents a curved line.\n *\n * @summary Curve marker.\n * @group Markers\n */\nexport class CurveMarker extends LineMarker {\n  public static typeName = 'CurveMarker';\n  public static title = 'Curve marker';\n\n  /**\n   * x coordinate for the curve control point.\n   */\n  public curveX = 0;\n  /**\n   * y coordinate for the curve control point.\n   */\n  public curveY = 0;\n\n  constructor(container: SVGGElement) {\n    super(container);\n\n    this.fillColor = 'transparent';\n  }\n\n  protected getPath(): string {\n    const result = `M ${this.x1} ${this.y1} Q ${this.curveX} ${this.curveY}, ${this.x2} ${this.y2}`;\n    return result;\n  }\n\n  public getState(): CurveMarkerState {\n    const result: CurveMarkerState = Object.assign(\n      {\n        curveX: this.curveX,\n        curveY: this.curveY,\n      },\n      super.getState(),\n    );\n\n    return result;\n  }\n\n  public restoreState(state: CurveMarkerState): void {\n    this.curveX = state.curveX;\n    this.curveY = state.curveY;\n\n    super.restoreState(state);\n  }\n\n  public override scale(scaleX: number, scaleY: number): void {\n    super.scale(scaleX, scaleY);\n\n    this.curveX = this.curveX * scaleX;\n    this.curveY = this.curveY * scaleY;\n\n    this.adjustVisual();\n  }\n}\n","import { FreehandMarker } from './FreehandMarker';\n\n/**\n * Highlighter marker imitates a freeform highlighter pen.\n *\n * @summary Semi-transparent freeform marker.\n * @group Markers\n * @since 3.2.0\n */\nexport class HighlighterMarker extends FreehandMarker {\n  public static typeName = 'HighlighterMarker';\n  public static title = 'Highlighter marker';\n  public static applyDefaultFilter = false;\n\n  constructor(container: SVGGElement) {\n    super(container);\n\n    this.opacity = 0.5;\n    this.strokeColor = '#ffff00';\n    this.strokeWidth = 20;\n  }\n}\n","import { SvgHelper } from './SvgHelper';\n\n/**\n * A set of common SVG filters that can be used to make markers more legible\n * or just for visual effect.\n */\nexport class SvgFilters {\n  /**\n   * Returns a set of default filters that can be used to make markers more legible.\n   * @returns array of SVG filters.\n   */\n  public static getDefaultFilterSet(): SVGFilterElement[] {\n    const dsFilter = SvgHelper.createFilter(\n      'dropShadow',\n      [\n        ['x', '-20%'],\n        ['y', '-20%'],\n        ['width', '140%'],\n        ['height', '140%'],\n      ],\n      `<feDropShadow dx=\"2\" dy=\"2\" stdDeviation=\"2\" flood-color=\"rgba(0,0,0,0.8)\"/>`,\n    );\n\n    const outlineFilter = SvgHelper.createFilter(\n      'outline',\n      [\n        ['x', '-5%'],\n        ['y', '-5%'],\n        ['width', '110%'],\n        ['height', '110%'],\n      ],\n      `<feMorphology operator=\"dilate\" radius=\"2\" in=\"SourceAlpha\" result=\"expanded\"/>\n      <feFlood flood-color=\"white\" flood-opacity=\"1\"/>\n      <feComposite in2=\"expanded\" operator=\"in\"/>\n      <feComposite in=\"SourceGraphic\" operator=\"over\"/>`,\n    );\n\n    const glowFilter = SvgHelper.createFilter(\n      'glow',\n      [\n        ['x', '-50%'],\n        ['y', '-50%'],\n        ['width', '200%'],\n        ['height', '200%'],\n      ],\n      `<feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"3\" result=\"blur\"/>\n      <feFlood flood-color=\"#ffffff\" flood-opacity=\"1\"/>\n      <feComposite in2=\"blur\" operator=\"in\"/>\n      <feMerge>\n        <feMergeNode/>\n        <feMergeNode in=\"SourceGraphic\"/>\n      </feMerge>`,\n    );\n\n    return [dsFilter, outlineFilter, glowFilter];\n  }\n}\n","import { IPoint, MarkerBase, MarkerBaseState, SvgHelper } from '../core';\nimport { MarkerEditorProperties } from './MarkerEditorProperties';\n\n/**\n * Represents marker's state (status) in time.\n */\nexport type MarkerEditorState =\n  | 'new'\n  | 'creating'\n  | 'select'\n  | 'move'\n  | 'resize'\n  | 'rotate'\n  | 'edit';\n\n/**\n * Marker creation style defines whether markers are created by drawing them or just dropping them on the canvas.\n */\nexport type MarkerCreationStyle = 'draw' | 'drop';\n\n/**\n * Base class for all marker editors.\n *\n * @typeParam TMarkerType - marker type the instance of the editor is for.\n *\n * @summary Base class for all marker editors.\n * @group Editors\n */\nexport class MarkerBaseEditor<TMarkerType extends MarkerBase = MarkerBase> {\n  /**\n   * Marker type constructor.\n   */\n  protected _markerType: new (container: SVGGElement) => TMarkerType;\n\n  /**\n   * Marker creation style.\n   *\n   * Markers can either be created by drawing them or just dropping them on the canvas.\n   */\n  protected _creationStyle: MarkerCreationStyle = 'draw';\n  /**\n   * Marker creation style.\n   *\n   * Markers can either be created by drawing them or just dropping them on the canvas.\n   */\n  public get creationStyle(): MarkerCreationStyle {\n    return this._creationStyle;\n  }\n\n  /**\n   * Type guard for specific marker editor types.\n   *\n   * This allows to check if the editor is of a specific type which is useful for displaying type-specific UI.\n   *\n   * @typeParam T - specific marker editor type.\n   * @param cls\n   * @returns\n   */\n  public is<T>(\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    cls: new (...args: any[]) => T,\n  ): this is T {\n    return this instanceof cls;\n  }\n\n  /**\n   * Marker instance.\n   */\n  protected _marker: TMarkerType;\n\n  /**\n   * Returns the marker instance.\n   */\n  public get marker(): TMarkerType {\n    return this._marker;\n  }\n\n  /**\n   * SVG container for the marker's and editor's visual elements.\n   */\n  protected _container: SVGGElement;\n  /**\n   * Returns the SVG container for the marker's and editor's visual elements.\n   */\n  public get container(): SVGGElement {\n    return this._container;\n  }\n\n  /**\n   * Overlay container for HTML elements like text editors, etc.\n   */\n  protected _overlayContainer: HTMLDivElement;\n  /**\n   * Overlay container for HTML elements like text editors, etc.\n   */\n  public get overlayContainer(): HTMLDivElement {\n    return this._overlayContainer;\n  }\n\n  /**\n   * Editor's state.\n   */\n  protected _state: MarkerEditorState = 'new';\n  /**\n   * Gets editor's state.\n   */\n  public get state(): MarkerEditorState {\n    return this._state;\n  }\n  /**\n   * Sets editor's state.\n   */\n  public set state(value: MarkerEditorState) {\n    this._state = value;\n  }\n\n  /**\n   * SVG group holding editor's control box.\n   */\n  protected _controlBox = SvgHelper.createGroup();\n\n  /**\n   * Method called when marker creation is finished.\n   */\n  public onMarkerCreated?: <T extends MarkerBaseEditor<MarkerBase>>(\n    editor: T,\n  ) => void;\n\n  /**\n   * Method to call when marker state changes.\n   */\n  public onStateChanged?: <T extends MarkerBaseEditor<MarkerBase>>(\n    editor: T,\n  ) => void;\n\n  /**\n   * Marker's state when it is selected\n   */\n  protected manipulationStartState?: string;\n\n  /**\n   * Is this marker selected?\n   */\n  protected _isSelected = false;\n\n  /**\n   * Returns true if the marker is currently selected\n   */\n  public get isSelected(): boolean {\n    return this._isSelected;\n  }\n\n  /**\n   * When set to true, a new marker of the same type is created immediately after the current one is finished.\n   */\n  protected _continuousCreation = false;\n  /**\n   * When set to true, a new marker of the same type is created immediately after the current one is finished.\n   */\n  public get continuousCreation() {\n    return this._continuousCreation;\n  }\n\n  /**\n   * Sets marker's stroke (outline) color.\n   * @param color - color as string\n   */\n  public set strokeColor(color: string) {\n    this.marker.strokeColor = color;\n  }\n\n  /**\n   * Gets marker's stroke (outline) color.\n   */\n  public get strokeColor(): string {\n    return this.marker.strokeColor;\n  }\n\n  /**\n   * Sets marker's stroke (outline) width.\n   * @param width - stroke width in pixels.\n   */\n  public set strokeWidth(width: number) {\n    this.marker.strokeWidth = width;\n    this.adjustControlBox();\n    this.stateChanged();\n  }\n\n  /**\n   * Gets marker's stroke (outline) width.\n   */\n  public get strokeWidth(): number {\n    return this.marker.strokeWidth;\n  }\n\n  /**\n   * Sets marker's stroke (outline) dash array.\n   * @param dashes - dash array as string\n   */\n  public set strokeDasharray(dashes: string) {\n    this.marker.strokeDasharray = dashes;\n    this.stateChanged();\n  }\n\n  /**\n   * Gets marker's stroke (outline) dash array.\n   */\n  public get strokeDasharray(): string {\n    return this.marker.strokeDasharray;\n  }\n\n  /**\n   * Sets marker's fill color.\n   */\n  public set fillColor(color: string) {\n    this.marker.fillColor = color;\n  }\n\n  /**\n   * Gets marker's fill color.\n   */\n  public get fillColor(): string {\n    return this.marker.fillColor;\n  }\n\n  /**\n   * Sets marker's opacity.\n   */\n  public set opacity(value: number) {\n    this.marker.opacity = value;\n  }\n\n  /**\n   * Gets marker's opacity.\n   */\n  public get opacity(): number {\n    return this.marker.opacity;\n  }\n\n  /**\n   * Sets marker's notes.\n   */\n  public set notes(value: string | undefined) {\n    this.marker.notes = value;\n  }\n\n  /**\n   * Gets marker's notes.\n   */\n  public get notes(): string | undefined {\n    return this.marker.notes;\n  }\n\n  /**\n   * Creates a new instance of marker editor.\n   *\n   * @param properties - marker editor properties.\n   */\n  constructor(properties: MarkerEditorProperties<TMarkerType>) {\n    this._container = properties.container;\n    this._overlayContainer = properties.overlayContainer;\n    this._markerType = properties.markerType;\n    this._marker =\n      properties.marker ?? new properties.markerType(properties.container);\n\n    this.select = this.select.bind(this);\n    this.deselect = this.deselect.bind(this);\n    this.ownsTarget = this.ownsTarget.bind(this);\n    this.adjustControlBox = this.adjustControlBox.bind(this);\n    this.stateChanged = this.stateChanged.bind(this);\n    this.scale = this.scale.bind(this);\n    this.dispose = this.dispose.bind(this);\n    this.pointerDown = this.pointerDown.bind(this);\n    this.pointerUp = this.pointerUp.bind(this);\n    this.manipulate = this.manipulate.bind(this);\n    this.dblClick = this.dblClick.bind(this);\n  }\n\n  /**\n   * Returns true if the marker or the editor owns supplied target element.\n   *\n   * @param el target element\n   * @returns\n   */\n  public ownsTarget(el: EventTarget | null): boolean {\n    let found = false;\n    if (el !== null) {\n      if (this._marker?.ownsTarget(el)) {\n        found = true;\n      }\n    }\n    return found;\n  }\n\n  /**\n   * Is this marker selected in a multi-selection?\n   */\n  protected isMultiSelected = false;\n  /**\n   * Selects this marker and displays appropriate selected marker UI.\n   */\n  public select(multi = false): void {\n    this.isMultiSelected = multi;\n    this.container.style.cursor = 'move';\n    this._isSelected = true;\n    this.manipulationStartState = JSON.stringify(this._marker.getState());\n    //console.log('manipulationStartState', this.manipulationStartState);\n  }\n\n  /**\n   * Deselects this marker and hides selected marker UI.\n   */\n  public deselect(): void {\n    this.container.style.cursor = 'default';\n    this._isSelected = false;\n    this.stateChanged();\n  }\n\n  /**\n   * Handles pointer (mouse, touch, stylus, etc.) down event.\n   *\n   * @param point - event coordinates.\n   * @param target - direct event target element.\n   * @param ev - pointer event.\n   */\n  // prettier-ignore\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars, @typescript-eslint/no-empty-function\n  public pointerDown(point: IPoint, target?: EventTarget, ev?: PointerEvent): void {}\n\n  /**\n   * Handles pointer (mouse, touch, stylus, etc.) double click event.\n   *\n   * @param point - event coordinates.\n   * @param target - direct event target element.\n   * @param ev - pointer event.\n   */\n  // prettier-ignore\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars, @typescript-eslint/no-empty-function\n  public dblClick(point: IPoint, target?: EventTarget, ev?: MouseEvent): void {}\n\n  /**\n   * Handles marker manipulation (move, resize, rotate, etc.).\n   *\n   * @param point - event coordinates.\n   * @param ev - pointer event.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars, @typescript-eslint/no-empty-function\n  public manipulate(point: IPoint, ev?: PointerEvent): void {}\n\n  /**\n   * Handles pointer (mouse, touch, stylus, etc.) up event.\n   *\n   * @param point - event coordinates.\n   * @param ev - pointer event.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars, @typescript-eslint/no-empty-function\n  public pointerUp(point: IPoint, ev?: PointerEvent): void {}\n\n  /**\n   * Disposes the marker and clean's up.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\n  public dispose(): void {}\n\n  /**\n   * Adjusts marker's control box.\n   */\n  protected adjustControlBox() {}\n\n  /**\n   * Scales the marker and the editor.\n   *\n   * @param scaleX\n   * @param scaleY\n   */\n  public scale(scaleX: number, scaleY: number): void {\n    this._marker.scale(scaleX, scaleY);\n\n    this.adjustControlBox();\n  }\n\n  /**\n   * Called by a marker when its state could have changed.\n   * Does a check if the state has indeed changed before firing the handler.\n   */\n  protected stateChanged(): void {\n    if (\n      this.onStateChanged &&\n      this.state !== 'creating' &&\n      this.state !== 'new'\n    ) {\n      const currentState = JSON.stringify(this._marker.getState());\n      // console.log('currentState', currentState);\n      // @todo - check if this is needed\n      // avoid reacting to state (mode) differences\n      // if (this.manipulationStartState !== undefined) {\n      //   this.manipulationStartState.state = 'select';\n      // }\n      // currentState.state = 'select';\n      if (this.manipulationStartState != currentState) {\n        this.manipulationStartState = currentState;\n        this.onStateChanged(this);\n      }\n    }\n  }\n\n  /**\n   * Returns marker's state that can be restored in the future.\n   *\n   * @returns\n   */\n  public getState(): MarkerBaseState {\n    return this.marker.getState();\n  }\n\n  /**\n   * Restores previously saved marker state.\n   *\n   * @param state - previously saved state.\n   */\n  public restoreState(state: MarkerBaseState): void {\n    this._state = 'select';\n    this.marker.restoreState(state);\n    this.adjustControlBox();\n  }\n}\n","import { SvgHelper } from '../core/SvgHelper';\n\n/**\n * Represents location of the manipulation grips.\n */\nexport type GripLocation =\n  | 'topleft'\n  | 'topcenter'\n  | 'topright'\n  | 'leftcenter'\n  | 'rightcenter'\n  | 'bottomleft'\n  | 'bottomcenter'\n  | 'bottomright';\n\n/**\n * Represents a single resize-manipulation grip used in marker's manipulation controls.\n */\nexport class Grip {\n  /**\n   * Grip's visual element.\n   */\n  protected _visual?: SVGGraphicsElement;\n  /**\n   * Grip's visual element.\n   */\n  public get visual(): SVGGraphicsElement {\n    if (!this._visual) {\n      this.createVisual();\n    }\n    return this._visual!;\n  }\n\n  /**\n   * Grip's size (radius).\n   */\n  public gripSize = 5;\n\n  /**\n   * Grip's fill color.\n   */\n  public fillColor = 'rgba(255,255,255,0.9)';\n  /**\n   * Grip's stroke color.\n   */\n  public strokeColor = '#0ea5e9';\n\n  /**\n   * Creates a new grip.\n   */\n  constructor() {\n    this.createVisual = this.createVisual.bind(this);\n  }\n\n  /**\n   * Creates grip's visual.\n   */\n  protected createVisual() {\n    this._visual = SvgHelper.createGroup();\n    this._visual.appendChild(\n      SvgHelper.createCircle(this.gripSize * 2, [\n        ['fill', 'transparent'],\n        ['cx', (this.gripSize / 2).toString()],\n        ['cy', (this.gripSize / 2).toString()],\n      ]),\n    );\n    const visual = SvgHelper.createCircle(this.gripSize, [\n      ['fill-opacity', '1'],\n      ['stroke-width', '1'],\n      ['stroke-opacity', '1'],\n    ]);\n    visual.style.fill = `var(--mjs-grip-fill, ${this.fillColor})`;\n    visual.style.stroke = `var(--mjs-grip-stroke, ${this.strokeColor})`;\n    visual.style.filter = 'drop-shadow(0px 0px 2px rgba(0, 0, 0, .7))';\n    this._visual.appendChild(visual);\n  }\n\n  /**\n   * Returns true if passed SVG element belongs to the grip. False otherwise.\n   *\n   * @param el - target element.\n   */\n  public ownsTarget(el: EventTarget): boolean {\n    if (el === this._visual) {\n      return true;\n    } else {\n      let found = false;\n      this._visual?.childNodes.forEach((child) => {\n        if (child === el) {\n          found = true;\n        }\n      });\n      return found;\n    }\n  }\n}\n","import { Grip } from './Grip';\n\n/**\n * Represents a resize grip.\n */\nexport class ResizeGrip extends Grip {}\n","import { IPoint, PolygonMarker, SvgHelper } from '../core';\nimport { MarkerBaseEditor } from './MarkerBaseEditor';\nimport { MarkerEditorProperties } from './MarkerEditorProperties';\nimport { ResizeGrip } from './ResizeGrip';\n\n/**\n * Editor for polygon markers.\n *\n * @summary Polygon marker editor.\n * @group Editors\n */\nexport class PolygonMarkerEditor<\n  TMarkerType extends PolygonMarker = PolygonMarker,\n> extends MarkerBaseEditor<TMarkerType> {\n  /**\n   * Default line length when marker is created with a simple click (without dragging).\n   */\n  protected defaultLength = 50;\n\n  /**\n   * Pointer X coordinate at the start of move or resize.\n   */\n  protected manipulationStartX = 0;\n  /**\n   * Pointer Y coordinate at the start of move or resize.\n   */\n  protected manipulationStartY = 0;\n\n  /**\n   * Container for control elements.\n   */\n  protected controlBox: SVGGElement = SvgHelper.createGroup();\n  /**\n   * Container for manipulation grips.\n   */\n  protected manipulationBox: SVGGElement = SvgHelper.createGroup();\n\n  /**\n   * Array of manipulation grips.\n   */\n  protected grips: ResizeGrip[] = [];\n  /**\n   * Active manipulation grip.\n   */\n  protected activeGrip?: ResizeGrip;\n\n  constructor(properties: MarkerEditorProperties<TMarkerType>) {\n    super(properties);\n\n    this.ownsTarget = this.ownsTarget.bind(this);\n\n    this.setupControlBox = this.setupControlBox.bind(this);\n    this.adjustControlBox = this.adjustControlBox.bind(this);\n\n    this.adjustControlGrips = this.adjustControlGrips.bind(this);\n    this.createGrip = this.createGrip.bind(this);\n    this.positionGrip = this.positionGrip.bind(this);\n    this.positionGrips = this.positionGrips.bind(this);\n\n    this.resize = this.resize.bind(this);\n\n    this.manipulate = this.manipulate.bind(this);\n    this.pointerDown = this.pointerDown.bind(this);\n    this.pointerUp = this.pointerUp.bind(this);\n\n    this.setupControlBox();\n  }\n\n  public ownsTarget(el: EventTarget): boolean {\n    if (super.ownsTarget(el) || this.marker.ownsTarget(el)) {\n      return true;\n    } else if (this.grips.some((grip) => grip.ownsTarget(el))) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  public override pointerDown(\n    point: IPoint,\n    target?: EventTarget,\n    ev?: PointerEvent,\n  ): void {\n    super.pointerDown(point, target, ev);\n\n    this.manipulationStartX = point.x;\n    this.manipulationStartY = point.y;\n\n    if (this.state === 'new') {\n      this.startCreation(point);\n    } else if (this._state === 'creating') {\n      if (this.grips.length > 0 && target && this.grips[0].ownsTarget(target)) {\n        this.finishCreation();\n      } else {\n        this.addNewPointWhileCreating(point);\n      }\n    } else {\n      this.select(this.isMultiSelected);\n      this.activeGrip =\n        target && this.grips.find((grip) => grip.ownsTarget(target));\n\n      if (this.activeGrip) {\n        this._state = 'resize';\n      } else {\n        this._state = 'move';\n      }\n    }\n  }\n\n  private startCreation(point: IPoint) {\n    this.marker.stage = 'creating';\n    this.marker.points.push(point);\n    this.marker.points.push(point);\n    this.marker.createVisual();\n    this.marker.adjustVisual();\n    this.adjustControlGrips();\n    this.controlBox.style.display = '';\n\n    this.activeGrip = this.grips.at(-1);\n    if (this.activeGrip) {\n      this.activeGrip.visual.style.pointerEvents = 'none';\n    }\n\n    this._state = 'creating';\n  }\n\n  private addNewPointWhileCreating(point: IPoint) {\n    this.marker.points.push(point);\n    this.marker.adjustVisual();\n    this.adjustControlGrips();\n    this.activeGrip = this.grips.at(-1);\n    if (this.activeGrip) {\n      this.activeGrip.visual.style.pointerEvents = 'none';\n    }\n  }\n\n  private finishCreation() {\n    this.marker.stage = 'normal';\n    // connected the last point with the first one\n    // remove the first point\n    this.marker.points.splice(0, 1);\n    // single point is not a polygon\n    if (this.marker.points.length === 1) {\n      this.marker.points.splice(0, 1);\n    }\n    this.marker.adjustVisual();\n    this.adjustControlGrips();\n    this.grips.forEach((grip) => {\n      grip.visual.style.pointerEvents = '';\n    });\n\n    this._state = 'select';\n    if (this.marker.points.length > 0 && this.onMarkerCreated) {\n      this.onMarkerCreated(this);\n    }\n  }\n\n  public override pointerUp(point: IPoint, ev?: PointerEvent): void {\n    super.pointerUp(point, ev);\n    this.manipulate(point, ev);\n    if (this._state !== 'creating') {\n      this._state = 'select';\n    }\n    this.stateChanged();\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  public override manipulate(point: IPoint, ev?: PointerEvent): void {\n    if (this.state === 'creating') {\n      this.resize(point);\n    } else if (this.state === 'move') {\n      this.marker.points.forEach((p) => {\n        p.x += point.x - this.manipulationStartX;\n        p.y += point.y - this.manipulationStartY;\n      });\n      this.manipulationStartX = point.x;\n      this.manipulationStartY = point.y;\n      this.marker.adjustVisual();\n      this.adjustControlBox();\n    } else if (this.state === 'resize') {\n      this.resize(point);\n    }\n  }\n\n  protected resize(point: IPoint): void {\n    const activeGripIndex = this.activeGrip\n      ? this.grips.indexOf(this.activeGrip)\n      : -1;\n    if (activeGripIndex >= 0) {\n      this.marker.points[activeGripIndex] = point;\n      this.marker.adjustVisual();\n      this.adjustControlBox();\n    }\n  }\n\n  public override dblClick(\n    point: IPoint,\n    target?: EventTarget,\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    ev?: MouseEvent,\n  ): void {\n    if (target && this.state === 'select') {\n      const selectorLineIndex = this.marker.selectorVisualLines.findIndex(\n        (l) => l === target,\n      );\n      if (selectorLineIndex > -1) {\n        this.marker.points.splice(selectorLineIndex + 1, 0, point);\n        this.marker.adjustVisual();\n        this.adjustControlGrips();\n      } else {\n        const gripIndex = this.grips.findIndex((g) => g.ownsTarget(target));\n        if (gripIndex > -1) {\n          this.marker.points.splice(gripIndex, 1);\n          this.marker.adjustVisual();\n          this.adjustControlGrips();\n        }\n      }\n    }\n  }\n\n  /**\n   * Creates control box for manipulation controls.\n   */\n  protected setupControlBox(): void {\n    this.controlBox = SvgHelper.createGroup();\n    this.container.appendChild(this.controlBox);\n    this.manipulationBox = SvgHelper.createGroup();\n    this.controlBox.appendChild(this.manipulationBox);\n\n    this.adjustControlGrips();\n\n    this.controlBox.style.display = 'none';\n  }\n\n  protected adjustControlBox() {\n    // this.positionGrips();\n    this.adjustControlGrips();\n  }\n\n  /**\n   * Adds control grips to control box.\n   */\n  protected adjustControlGrips(): void {\n    const noOfMissingGrips = this.marker.points.length - this.grips.length;\n    if (noOfMissingGrips > 0) {\n      for (let i = 0; i < noOfMissingGrips; i++) {\n        this.grips.push(this.createGrip());\n      }\n    } else if (noOfMissingGrips < 0) {\n      for (let i = 0; i < -noOfMissingGrips; i++) {\n        const grip = this.grips.pop();\n        if (grip) {\n          this.manipulationBox.removeChild(grip.visual);\n        }\n      }\n    }\n\n    this.positionGrips();\n  }\n\n  /**\n   * Creates manipulation grip.\n   * @returns - manipulation grip.\n   */\n  protected createGrip(): ResizeGrip {\n    const grip = new ResizeGrip();\n    grip.visual.transform.baseVal.appendItem(SvgHelper.createTransform());\n    this.manipulationBox.appendChild(grip.visual);\n\n    return grip;\n  }\n\n  /**\n   * Updates manipulation grip layout.\n   */\n  protected positionGrips(): void {\n    this.grips.forEach((grip, i) => {\n      const point = this.marker.points[i];\n      this.positionGrip(\n        grip.visual,\n        point.x - grip.gripSize / 2,\n        point.y - grip.gripSize / 2,\n      );\n    });\n  }\n\n  /**\n   * Positions manipulation grip.\n   * @param grip - grip to position\n   * @param x - new X coordinate\n   * @param y - new Y coordinate\n   */\n  protected positionGrip(grip: SVGGraphicsElement, x: number, y: number): void {\n    const translate = grip.transform.baseVal.getItem(0);\n    translate.setTranslate(x, y);\n    grip.transform.baseVal.replaceItem(translate, 0);\n  }\n\n  public select(multi = false): void {\n    super.select(multi);\n    this.adjustControlBox();\n    this.manipulationBox.style.display = multi ? 'none' : '';\n    this.controlBox.style.display = '';\n  }\n\n  public deselect(): void {\n    super.deselect();\n    this.controlBox.style.display = 'none';\n    if (this.state === 'creating') {\n      this.finishCreation();\n    }\n  }\n}\n","import { IPoint, LinearMarkerBase, SvgHelper } from '../core';\nimport { MarkerBaseEditor } from './MarkerBaseEditor';\nimport { MarkerEditorProperties } from './MarkerEditorProperties';\nimport { ResizeGrip } from './ResizeGrip';\n\n/**\n * Editor for linear markers.\n *\n * @summary Editor for line-like markers.\n * @group Editors\n */\nexport class LinearMarkerEditor<\n  TMarkerType extends LinearMarkerBase = LinearMarkerBase,\n> extends MarkerBaseEditor<TMarkerType> {\n  /**\n   * Default line length when marker is created with a simple click (without dragging).\n   */\n  protected defaultLength = 50;\n\n  /**\n   * Pointer X coordinate at the start of move or resize.\n   */\n  protected manipulationStartX = 0;\n  /**\n   * Pointer Y coordinate at the start of move or resize.\n   */\n  protected manipulationStartY = 0;\n\n  private manipulationStartX1 = 0;\n  private manipulationStartY1 = 0;\n  private manipulationStartX2 = 0;\n  private manipulationStartY2 = 0;\n\n  /**\n   * Container for manipulation grips.\n   */\n  protected manipulationBox: SVGGElement = SvgHelper.createGroup();\n\n  /**\n   * First manipulation grip\n   */\n  protected grip1?: ResizeGrip;\n  /**\n   * Second manipulation grip.\n   */\n  protected grip2?: ResizeGrip;\n  /**\n   * Active manipulation grip.\n   */\n  protected activeGrip?: ResizeGrip;\n\n  constructor(properties: MarkerEditorProperties<TMarkerType>) {\n    super(properties);\n\n    this.ownsTarget = this.ownsTarget.bind(this);\n\n    this.setupControlBox = this.setupControlBox.bind(this);\n    this.adjustControlBox = this.adjustControlBox.bind(this);\n\n    this.addControlGrips = this.addControlGrips.bind(this);\n    this.createGrip = this.createGrip.bind(this);\n    this.positionGrip = this.positionGrip.bind(this);\n    this.positionGrips = this.positionGrips.bind(this);\n\n    this.resize = this.resize.bind(this);\n\n    this.manipulate = this.manipulate.bind(this);\n    this.pointerDown = this.pointerDown.bind(this);\n    this.pointerUp = this.pointerUp.bind(this);\n\n    this.setupControlBox();\n  }\n\n  public ownsTarget(el: EventTarget): boolean {\n    if (super.ownsTarget(el) || this.marker.ownsTarget(el)) {\n      return true;\n    } else if (this.grip1?.ownsTarget(el) || this.grip2?.ownsTarget(el)) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  public override pointerDown(\n    point: IPoint,\n    target?: EventTarget,\n    ev?: PointerEvent,\n  ): void {\n    super.pointerDown(point, target, ev);\n\n    this.manipulationStartX = point.x;\n    this.manipulationStartY = point.y;\n\n    if (this.state === 'new') {\n      this.marker.x1 = point.x;\n      this.marker.y1 = point.y;\n      this.marker.x2 = point.x;\n      this.marker.y2 = point.y;\n    }\n\n    this.manipulationStartX1 = this.marker.x1;\n    this.manipulationStartY1 = this.marker.y1;\n    this.manipulationStartX2 = this.marker.x2;\n    this.manipulationStartY2 = this.marker.y2;\n\n    if (this.state === 'new') {\n      this.marker.createVisual();\n      this.marker.adjustVisual();\n\n      this._state = 'creating';\n    } else {\n      this.select(this.isMultiSelected);\n      if (target && this.grip1?.ownsTarget(target)) {\n        this.activeGrip = this.grip1;\n      } else if (target && this.grip2?.ownsTarget(target)) {\n        this.activeGrip = this.grip2;\n      } else {\n        this.activeGrip = undefined;\n      }\n\n      if (this.activeGrip) {\n        this._state = 'resize';\n      } else {\n        this._state = 'move';\n      }\n    }\n  }\n\n  public override pointerUp(point: IPoint, ev?: PointerEvent): void {\n    const inState = this.state;\n    super.pointerUp(point, ev);\n    if (\n      this.state === 'creating' &&\n      Math.abs(this.marker.x1 - this.marker.x2) < 10 &&\n      Math.abs(this.marker.y1 - this.marker.y2) < 10\n    ) {\n      this.marker.x2 = this.marker.x1 + this.defaultLength;\n      this.marker.adjustVisual();\n      this.adjustControlBox();\n    } else {\n      this.manipulate(point, ev);\n    }\n    this._state = 'select';\n    if (inState === 'creating' && this.onMarkerCreated) {\n      this.onMarkerCreated(this);\n    }\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  public override manipulate(point: IPoint, ev?: PointerEvent): void {\n    if (this.state === 'creating') {\n      this.resize(point);\n    } else if (this.state === 'move') {\n      this.marker.x1 =\n        this.manipulationStartX1 + point.x - this.manipulationStartX;\n      this.marker.y1 =\n        this.manipulationStartY1 + point.y - this.manipulationStartY;\n      this.marker.x2 =\n        this.manipulationStartX2 + point.x - this.manipulationStartX;\n      this.marker.y2 =\n        this.manipulationStartY2 + point.y - this.manipulationStartY;\n      this.marker.adjustVisual();\n      this.adjustControlBox();\n    } else if (this.state === 'resize') {\n      this.resize(point);\n    }\n  }\n\n  protected resize(point: IPoint): void {\n    switch (this.activeGrip) {\n      case this.grip1:\n        this.marker.x1 = point.x;\n        this.marker.y1 = point.y;\n        break;\n      case this.grip2:\n      case undefined:\n        this.marker.x2 = point.x;\n        this.marker.y2 = point.y;\n        break;\n    }\n    this.marker.adjustVisual();\n    this.adjustControlBox();\n  }\n\n  /**\n   * Creates control box for manipulation controls.\n   */\n  protected setupControlBox(): void {\n    this.container.appendChild(this._controlBox);\n    this.manipulationBox = SvgHelper.createGroup();\n    this._controlBox.appendChild(this.manipulationBox);\n\n    this.addControlGrips();\n\n    this._controlBox.style.display = 'none';\n  }\n\n  protected adjustControlBox() {\n    this.positionGrips();\n  }\n\n  /**\n   * Adds control grips to control box.\n   */\n  protected addControlGrips(): void {\n    this.grip1 = this.createGrip();\n    this.grip2 = this.createGrip();\n\n    this.positionGrips();\n  }\n\n  /**\n   * Creates manipulation grip.\n   * @returns - manipulation grip.\n   */\n  protected createGrip(): ResizeGrip {\n    const grip = new ResizeGrip();\n    grip.visual.transform.baseVal.appendItem(SvgHelper.createTransform());\n    this.manipulationBox.appendChild(grip.visual);\n\n    return grip;\n  }\n\n  /**\n   * Updates manipulation grip layout.\n   */\n  protected positionGrips(): void {\n    if (this.grip1 && this.grip2) {\n      const gripSize = this.grip1.gripSize;\n\n      this.positionGrip(\n        this.grip1.visual,\n        this.marker.x1 - gripSize / 2,\n        this.marker.y1 - gripSize / 2,\n      );\n      this.positionGrip(\n        this.grip2.visual,\n        this.marker.x2 - gripSize / 2,\n        this.marker.y2 - gripSize / 2,\n      );\n    }\n  }\n\n  /**\n   * Positions manipulation grip.\n   * @param grip - grip to position\n   * @param x - new X coordinate\n   * @param y - new Y coordinate\n   */\n  protected positionGrip(grip: SVGGraphicsElement, x: number, y: number): void {\n    const translate = grip.transform.baseVal.getItem(0);\n    translate.setTranslate(x, y);\n    grip.transform.baseVal.replaceItem(translate, 0);\n  }\n\n  public select(multi = false): void {\n    super.select(multi);\n    this.adjustControlBox();\n    this.manipulationBox.style.display = multi ? 'none' : '';\n    this._controlBox.style.display = '';\n  }\n\n  public deselect(): void {\n    super.deselect();\n    this._controlBox.style.display = 'none';\n  }\n}\n","import { GripLocation } from './Grip';\nimport { ResizeGrip } from './ResizeGrip';\n\n/**\n * RectangularBoxMarkerGrips is a set of resize/rotation grips for a rectangular marker.\n */\nexport class RectangularBoxMarkerGrips {\n  public grips = new Map<GripLocation, ResizeGrip>([\n    ['topleft', new ResizeGrip()],\n    ['topcenter', new ResizeGrip()],\n    ['topright', new ResizeGrip()],\n    ['leftcenter', new ResizeGrip()],\n    ['rightcenter', new ResizeGrip()],\n    ['bottomleft', new ResizeGrip()],\n    ['bottomcenter', new ResizeGrip()],\n    ['bottomright', new ResizeGrip()],\n  ]);\n  /**\n   * Creates a new marker grip set.\n   */\n  constructor() {\n    this.findGripByVisual = this.findGripByVisual.bind(this);\n  }\n\n  /**\n   * Returns a marker grip owning the specified visual.\n   * @param gripVisual - visual for owner to be determined.\n   */\n  public findGripByVisual(gripVisual: EventTarget): ResizeGrip | undefined {\n    for (const grip of this.grips.values()) {\n      if (grip.ownsTarget(gripVisual)) {\n        return grip;\n      }\n    }\n    return undefined;\n  }\n\n  /**\n   * Returns a grip by its location.\n   * @param location\n   * @returns\n   */\n  public getGrip(location: GripLocation): ResizeGrip {\n    return this.grips.get(location)!;\n  }\n}\n","import { Grip } from './Grip';\n\n/**\n * Represents a rotation grip.\n */\nexport class RotateGrip extends Grip {\n  constructor() {\n    super();\n    // swap fill and stroke colors\n    const oldFill = this.fillColor;\n    this.fillColor = this.strokeColor;\n    this.strokeColor = oldFill;\n  }\n}\n","import { IPoint, RectangularBoxMarkerBase, SvgHelper } from '../core';\nimport { Grip, GripLocation } from './Grip';\nimport { MarkerBaseEditor } from './MarkerBaseEditor';\nimport { MarkerEditorProperties } from './MarkerEditorProperties';\nimport { RectangularBoxMarkerGrips } from './RectangularBoxMarkerGrips';\nimport { RotateGrip } from './RotateGrip';\n\n/**\n * Base editor for markers that can be represented by a rectangular area.\n *\n * @summary Base editor for markers that can be represented by a rectangular area.\n * @group Editors\n */\nexport class RectangularBoxMarkerBaseEditor<\n  TMarkerType extends RectangularBoxMarkerBase = RectangularBoxMarkerBase,\n> extends MarkerBaseEditor<TMarkerType> {\n  /**\n   * x coordinate of the top-left corner at the start of manipulation.\n   */\n  protected manipulationStartLeft = 0;\n  /**\n   * y coordinate of the top-left corner at the start of manipulation.\n   */\n  protected manipulationStartTop = 0;\n  /**\n   * Width at the start of manipulation.\n   */\n  protected manipulationStartWidth = 0;\n  /**\n   * Height at the start of manipulation.\n   */\n  protected manipulationStartHeight = 0;\n\n  /**\n   * x coordinate of the pointer at the start of manipulation.\n   */\n  protected manipulationStartX = 0;\n  /**\n   * y coordinate of the pointer at the start of manipulation.\n   */\n  protected manipulationStartY = 0;\n\n  /**\n   * Pointer's horizontal distance from the top left corner.\n   */\n  protected offsetX = 0;\n  /**\n   * Pointer's vertical distance from the top left corner.\n   */\n  protected offsetY = 0;\n\n  /**\n   * Container for the marker's editing controls.\n   */\n  protected controlBox = SvgHelper.createGroup();\n  /**\n   * Container for the marker's manipulation grips.\n   */\n  protected manipulationBox = SvgHelper.createGroup();\n  private readonly CB_DISTANCE: number = 0;\n  private controlRect?: SVGRectElement;\n  private rotatorGripLine?: SVGLineElement;\n\n  private controlGrips: RectangularBoxMarkerGrips =\n    new RectangularBoxMarkerGrips();\n  /**\n   * Array of disabled resize grips.\n   *\n   * Use this in derived classes to disable specific resize grips.\n   */\n  protected disabledResizeGrips: GripLocation[] = [];\n  private rotatorGrip?: RotateGrip;\n  /**\n   * Active grip during manipulation\n   */\n  protected activeGrip?: Grip;\n  private disableRotation = false;\n\n  constructor(properties: MarkerEditorProperties<TMarkerType>) {\n    super(properties);\n\n    this.setupControlBox();\n  }\n\n  public ownsTarget(el: EventTarget): boolean {\n    if (super.ownsTarget(el) || this._marker.ownsTarget(el)) {\n      return true;\n    } else if (\n      this.controlGrips?.findGripByVisual(el) !== undefined ||\n      (this.rotatorGrip !== undefined && this.rotatorGrip.ownsTarget(el))\n    ) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  public override pointerDown(\n    point: IPoint,\n    target?: EventTarget,\n    ev?: PointerEvent,\n  ): void {\n    super.pointerDown(point, target, ev);\n\n    if (this.state === 'new') {\n      this.marker.left = point.x;\n      this.marker.top = point.y;\n    }\n\n    this.manipulationStartLeft = this.marker.left;\n    this.manipulationStartTop = this.marker.top;\n    this.manipulationStartWidth = this.marker.width;\n    this.manipulationStartHeight = this.marker.height;\n\n    const rotatedPoint = this.marker.unrotatePoint(point);\n    this.manipulationStartX = rotatedPoint.x;\n    this.manipulationStartY = rotatedPoint.y;\n\n    this.offsetX = rotatedPoint.x - this.marker.left;\n    this.offsetY = rotatedPoint.y - this.marker.top;\n\n    if (this.state !== 'new') {\n      this.select(this.isMultiSelected);\n      this.activeGrip = this.controlGrips?.findGripByVisual(\n        target as SVGGraphicsElement,\n      );\n      if (this.activeGrip !== undefined) {\n        this._state = 'resize';\n      } else if (\n        this.rotatorGrip !== undefined &&\n        target !== undefined &&\n        this.rotatorGrip.ownsTarget(target)\n      ) {\n        this.activeGrip = this.rotatorGrip;\n\n        const rotatedCenter = this.marker.rotatePoint({\n          x: this.marker.centerX,\n          y: this.marker.centerY,\n        });\n        this.marker.left = rotatedCenter.x - this.marker.width / 2;\n        this.marker.top = rotatedCenter.y - this.marker.height / 2;\n        this.marker.moveVisual({ x: this.marker.left, y: this.marker.top });\n\n        const rotate = this.container.transform.baseVal.getItem(0);\n        rotate.setRotate(\n          this.marker.rotationAngle,\n          this.marker.centerX,\n          this.marker.centerY,\n        );\n        this.container.transform.baseVal.replaceItem(rotate, 0);\n\n        this.adjustControlBox();\n\n        this._state = 'rotate';\n      } else {\n        this._state = 'move';\n      }\n    }\n  }\n\n  /**\n   * When set to true marker created event will not be triggered.\n   */\n  protected _suppressMarkerCreateEvent = false;\n\n  public override pointerUp(point: IPoint, ev?: PointerEvent): void {\n    const inState = this.state;\n    super.pointerUp(point, ev);\n    if (\n      this.state === 'creating' &&\n      this.marker.width < 10 &&\n      this.marker.height < 10\n    ) {\n      this.marker.width = this.marker.defaultSize.width;\n      this.marker.height = this.marker.defaultSize.height;\n    } else {\n      this.manipulate(point, ev);\n    }\n    this._state = 'select';\n    if (\n      inState === 'creating' &&\n      this.onMarkerCreated &&\n      this._suppressMarkerCreateEvent === false\n    ) {\n      this.onMarkerCreated(this);\n    }\n    this.stateChanged();\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  public override manipulate(point: IPoint, ev?: PointerEvent): void {\n    const rotatedPoint = this.marker.unrotatePoint(point);\n\n    if (this.state === 'creating') {\n      this.resize(point, ev?.shiftKey);\n    } else if (this.state === 'move') {\n      this.marker.left =\n        this.manipulationStartLeft +\n        (rotatedPoint.x - this.manipulationStartLeft) -\n        this.offsetX;\n      this.marker.top =\n        this.manipulationStartTop +\n        (rotatedPoint.y - this.manipulationStartTop) -\n        this.offsetY;\n      this.marker.moveVisual({ x: this.marker.left, y: this.marker.top });\n      this.adjustControlBox();\n    } else if (this.state === 'resize') {\n      this.resize(rotatedPoint, ev?.shiftKey);\n    } else if (this.state === 'rotate') {\n      this.marker.rotate(point);\n    }\n  }\n\n  protected resize(point: IPoint, preserveAspectRatio = false): void {\n    let newX = this.manipulationStartLeft;\n    let newWidth = this.manipulationStartWidth;\n    let newY = this.manipulationStartTop;\n    let newHeight = this.manipulationStartHeight;\n\n    const deltaX = point.x - this.manipulationStartX;\n    const deltaY = point.y - this.manipulationStartY;\n    if (preserveAspectRatio) {\n      const aspectRatio =\n        this.manipulationStartWidth !== 0 && this.manipulationStartHeight !== 0\n          ? this.manipulationStartWidth / this.manipulationStartHeight\n          : 1;\n      switch (this.activeGrip) {\n        // undefined when creating a new marker\n        case this.controlGrips.getGrip('bottomright'):\n        case undefined: {\n          newWidth = this.manipulationStartWidth + Math.max(deltaX, deltaY);\n          newHeight =\n            this.manipulationStartHeight +\n            Math.max(deltaX, deltaY) / aspectRatio;\n          break;\n        }\n        case this.controlGrips.getGrip('bottomcenter'): {\n          newWidth = this.manipulationStartWidth + deltaY;\n          newHeight = this.manipulationStartHeight + deltaY / aspectRatio;\n          newX = this.manipulationStartLeft - deltaY / 2;\n          break;\n        }\n        case this.controlGrips.getGrip('bottomleft'): {\n          newWidth = this.manipulationStartWidth + Math.max(-deltaX, deltaY);\n          newHeight =\n            this.manipulationStartHeight +\n            Math.max(-deltaX, deltaY) / aspectRatio;\n          newX = this.manipulationStartLeft - Math.max(-deltaX, deltaY);\n          break;\n        }\n        case this.controlGrips.getGrip('leftcenter'): {\n          newWidth = this.manipulationStartWidth - deltaX;\n          newHeight = this.manipulationStartHeight - deltaX / aspectRatio;\n          newX = this.manipulationStartLeft + deltaX;\n          newY = this.manipulationStartTop + deltaX / aspectRatio / 2;\n          break;\n        }\n        case this.controlGrips.getGrip('topleft'): {\n          newWidth = this.manipulationStartWidth + Math.max(-deltaX, -deltaY);\n          newHeight =\n            this.manipulationStartHeight +\n            Math.max(-deltaX, -deltaY) / aspectRatio;\n          newX = this.manipulationStartLeft - Math.max(-deltaX, -deltaY);\n          newY =\n            this.manipulationStartTop -\n            Math.max(-deltaX, -deltaY) / aspectRatio;\n          break;\n        }\n        case this.controlGrips.getGrip('topcenter'): {\n          newWidth = this.manipulationStartWidth - deltaY;\n          newHeight = this.manipulationStartHeight - deltaY / aspectRatio;\n          newX = this.manipulationStartLeft + deltaY / 2;\n          newY = this.manipulationStartTop + deltaY / aspectRatio;\n          break;\n        }\n        case this.controlGrips.getGrip('topright'): {\n          newWidth = this.manipulationStartWidth + Math.max(deltaX, -deltaY);\n          newHeight =\n            this.manipulationStartHeight +\n            Math.max(deltaX, -deltaY) / aspectRatio;\n          newY =\n            this.manipulationStartTop - Math.max(deltaX, -deltaY) / aspectRatio;\n          break;\n        }\n        case this.controlGrips.getGrip('rightcenter'): {\n          newWidth = this.manipulationStartWidth + deltaX;\n          newHeight = this.manipulationStartHeight + deltaX / aspectRatio;\n          newY = this.manipulationStartTop - deltaX / aspectRatio / 2;\n          break;\n        }\n      }\n    } else {\n      // free form resizing\n      switch (this.activeGrip) {\n        case this.controlGrips.getGrip('bottomleft'):\n        case this.controlGrips.getGrip('leftcenter'):\n        case this.controlGrips.getGrip('topleft'):\n          newX = this.manipulationStartLeft + point.x - this.manipulationStartX;\n          newWidth =\n            this.manipulationStartWidth + this.manipulationStartLeft - newX;\n          break;\n        case this.controlGrips.getGrip('bottomright'):\n        case this.controlGrips.getGrip('rightcenter'):\n        case this.controlGrips.getGrip('topright'):\n        case undefined:\n          newWidth =\n            this.manipulationStartWidth + point.x - this.manipulationStartX;\n          break;\n      }\n\n      switch (this.activeGrip) {\n        case this.controlGrips.getGrip('topcenter'):\n        case this.controlGrips.getGrip('topleft'):\n        case this.controlGrips.getGrip('topright'):\n          newY = this.manipulationStartTop + point.y - this.manipulationStartY;\n          newHeight =\n            this.manipulationStartHeight + this.manipulationStartTop - newY;\n          break;\n        case this.controlGrips.getGrip('bottomcenter'):\n        case this.controlGrips.getGrip('bottomleft'):\n        case this.controlGrips.getGrip('bottomright'):\n        case undefined:\n          newHeight =\n            this.manipulationStartHeight + point.y - this.manipulationStartY;\n          break;\n      }\n    }\n\n    if (newWidth >= 0) {\n      this.marker.left = newX;\n      this.marker.width = newWidth;\n    } else {\n      this.marker.left = newX + newWidth;\n      this.marker.width = -newWidth;\n    }\n    if (newHeight >= 0) {\n      this.marker.top = newY;\n      this.marker.height = newHeight;\n    } else {\n      this.marker.top = newY + newHeight;\n      this.marker.height = -newHeight;\n    }\n\n    this.setSize();\n  }\n\n  /**\n   * Sets control box size and location.\n   */\n  protected setSize(): void {\n    this.marker.setSize();\n    this.adjustControlBox();\n  }\n\n  public select(multi = false): void {\n    super.select(multi);\n    this.adjustControlBox();\n    this.manipulationBox.style.display = multi ? 'none' : '';\n    this.controlBox.style.display = '';\n  }\n\n  public deselect(): void {\n    super.deselect();\n    this.controlBox.style.display = 'none';\n  }\n\n  /**\n   * Creates control box for manipulation controls.\n   */\n  protected setupControlBox() {\n    this.controlBox = SvgHelper.createGroup();\n    const translate = SvgHelper.createTransform();\n    translate.setTranslate(-this.CB_DISTANCE / 2, -this.CB_DISTANCE / 2);\n    this.controlBox.transform.baseVal.appendItem(translate);\n\n    this.container.appendChild(this.controlBox);\n\n    this.manipulationBox = SvgHelper.createGroup();\n    this.controlBox.appendChild(this.manipulationBox);\n\n    this.controlRect = SvgHelper.createRect(\n      this.marker.width + this.CB_DISTANCE,\n      this.marker.height + this.CB_DISTANCE,\n      [\n        ['stroke', 'black'],\n        ['stroke-width', '1'],\n        ['stroke-opacity', '0.5'],\n        ['stroke-dasharray', '3, 2'],\n        ['fill', 'transparent'],\n        ['pointer-events', 'none'],\n      ],\n    );\n\n    this.controlBox.appendChild(this.controlRect);\n\n    if (this.disableRotation !== true) {\n      this.rotatorGripLine = SvgHelper.createLine(\n        (this.marker.width + this.CB_DISTANCE * 2) / 2,\n        this.marker.top - this.CB_DISTANCE,\n        (this.marker.width + this.CB_DISTANCE * 2) / 2,\n        this.marker.top - this.CB_DISTANCE * 3,\n        [\n          ['stroke', 'black'],\n          ['stroke-width', '1'],\n          ['stroke-opacity', '0.5'],\n          ['stroke-dasharray', '3, 2'],\n        ],\n      );\n      this.rotatorGripLine.style.filter =\n        'drop-shadow(rgba(255, 255, 255, 0.7) 0px 2px 0px)';\n\n      this.manipulationBox.appendChild(this.rotatorGripLine);\n    }\n\n    this.controlGrips = new RectangularBoxMarkerGrips();\n    this.addControlGrips();\n\n    this.controlBox.style.display = 'none';\n  }\n\n  /**\n   * Adjusts control box size and location.\n   */\n  protected adjustControlBox() {\n    const translate = this.controlBox.transform.baseVal.getItem(0);\n    translate.setTranslate(\n      this.marker.left - this.CB_DISTANCE / 2,\n      this.marker.top - this.CB_DISTANCE / 2,\n    );\n    this.controlBox.transform.baseVal.replaceItem(translate, 0);\n    this.controlRect?.setAttribute(\n      'width',\n      (this.marker.width + this.CB_DISTANCE).toString(),\n    );\n    this.controlRect?.setAttribute(\n      'height',\n      (this.marker.height + this.CB_DISTANCE).toString(),\n    );\n\n    if (this.rotatorGripLine !== undefined) {\n      this.rotatorGripLine.setAttribute(\n        'x1',\n        ((this.marker.width + this.CB_DISTANCE) / 2).toString(),\n      );\n      this.rotatorGripLine.setAttribute(\n        'y1',\n        (-this.CB_DISTANCE / 2).toString(),\n      );\n      this.rotatorGripLine.setAttribute(\n        'x2',\n        ((this.marker.width + this.CB_DISTANCE) / 2).toString(),\n      );\n      this.rotatorGripLine.setAttribute(\n        'y2',\n        (-Math.max(this.CB_DISTANCE * 3, 30)).toString(),\n      );\n    }\n\n    this.positionGrips();\n  }\n\n  /**\n   * Adds control grips to control box.\n   */\n  protected addControlGrips() {\n    for (const grip of this.controlGrips.grips.values()) {\n      grip.visual.transform.baseVal.appendItem(SvgHelper.createTransform());\n      this.manipulationBox.appendChild(grip.visual);\n\n      this.manipulationBox.appendChild(grip.visual);\n    }\n\n    if (this.disableRotation !== true) {\n      this.rotatorGrip = this.createRotateGrip();\n    }\n\n    this.positionGrips();\n  }\n\n  // private createResizeGrip(): ResizeGrip {\n  //   const grip = new ResizeGrip();\n  //   grip.visual.transform.baseVal.appendItem(SvgHelper.createTransform());\n  //   this.controlBox.appendChild(grip.visual);\n\n  //   return grip;\n  // }\n\n  private createRotateGrip(): RotateGrip {\n    const grip = new RotateGrip();\n    grip.visual.transform.baseVal.appendItem(SvgHelper.createTransform());\n    this.manipulationBox.appendChild(grip.visual);\n\n    return grip;\n  }\n\n  /**\n   * Updates manipulation grip layout.\n   */\n  protected positionGrips() {\n    if (this.controlGrips !== undefined) {\n      const gripSize = this.controlGrips.getGrip('topleft').gripSize ?? 0;\n\n      const left = -gripSize / 2;\n      const top = left;\n      const cx = (this.marker.width + this.CB_DISTANCE) / 2 - gripSize / 2;\n      const cy = (this.marker.height + this.CB_DISTANCE) / 2 - gripSize / 2;\n      const bottom = this.marker.height + this.CB_DISTANCE - gripSize / 2;\n      const right = this.marker.width + this.CB_DISTANCE - gripSize / 2;\n\n      this.positionGrip(this.controlGrips.getGrip('topleft').visual, left, top);\n      this.positionGrip(this.controlGrips.getGrip('topcenter').visual, cx, top);\n      this.positionGrip(\n        this.controlGrips.getGrip('topright').visual,\n        right,\n        top,\n      );\n      this.positionGrip(\n        this.controlGrips.getGrip('leftcenter').visual,\n        left,\n        cy,\n      );\n      this.positionGrip(\n        this.controlGrips.getGrip('rightcenter').visual,\n        right,\n        cy,\n      );\n      this.positionGrip(\n        this.controlGrips.getGrip('bottomleft').visual,\n        left,\n        bottom,\n      );\n      this.positionGrip(\n        this.controlGrips.getGrip('bottomcenter').visual,\n        cx,\n        bottom,\n      );\n      this.positionGrip(\n        this.controlGrips.getGrip('bottomright').visual,\n        right,\n        bottom,\n      );\n\n      if (this.rotatorGrip !== undefined) {\n        const rotatorGripSize = this.rotatorGrip.gripSize ?? 0;\n        const rtop = -rotatorGripSize / 2;\n        const rcx =\n          (this.marker.width + this.CB_DISTANCE) / 2 - rotatorGripSize / 2;\n\n        this.positionGrip(\n          this.rotatorGrip.visual,\n          rcx,\n          rtop - Math.max(this.CB_DISTANCE * 3, 30),\n        );\n      }\n    }\n    this.adjustGripVisibility();\n  }\n\n  /**\n   * Positions specific grip.\n   * @param grip\n   * @param x\n   * @param y\n   */\n  protected positionGrip(\n    grip: SVGGraphicsElement | undefined,\n    x: number,\n    y: number,\n  ) {\n    if (grip !== undefined) {\n      const translate = grip.transform.baseVal.getItem(0);\n      translate.setTranslate(x, y);\n      grip.transform.baseVal.replaceItem(translate, 0);\n    }\n  }\n\n  /**\n   * Hides marker's editing controls.\n   */\n  protected hideControlBox(): void {\n    this.controlBox.style.display = 'none';\n  }\n  /**\n   * Shows marker's editing controls.\n   */\n  protected showControlBox(): void {\n    this.controlBox.style.display = '';\n  }\n\n  /**\n   * Adjusts visibility of resize grips.\n   */\n  protected adjustGripVisibility() {\n    for (const location of this.disabledResizeGrips) {\n      const grip = this.controlGrips.getGrip(location);\n      if (grip !== undefined) {\n        grip.visual.style.display = 'none';\n      }\n    }\n  }\n\n  public scale(scaleX: number, scaleY: number): void {\n    super.scale(scaleX, scaleY);\n\n    this.adjustControlBox();\n  }\n}\n","import { IPoint, ShapeOutlineMarkerBase } from '../core';\nimport { MarkerEditorProperties } from './MarkerEditorProperties';\nimport { RectangularBoxMarkerBaseEditor } from './RectangularBoxMarkerBaseEditor';\n\n/**\n * Editor for shape outline markers.\n *\n * @summary Shape outline (unfilled shape) marker editor.\n * @group Editors\n */\nexport class ShapeOutlineMarkerEditor<\n  TMarkerType extends ShapeOutlineMarkerBase = ShapeOutlineMarkerBase,\n> extends RectangularBoxMarkerBaseEditor<TMarkerType> {\n  constructor(properties: MarkerEditorProperties<TMarkerType>) {\n    super(properties);\n\n    this._creationStyle = 'draw';\n  }\n\n  public override pointerDown(\n    point: IPoint,\n    target?: EventTarget,\n    ev?: PointerEvent,\n  ): void {\n    super.pointerDown(point, target, ev);\n    if (this.state === 'new') {\n      this.marker.createVisual();\n\n      this.marker.moveVisual(point);\n\n      this._state = 'creating';\n    }\n  }\n\n  protected resize(point: IPoint, preserveAspectRatio = false): void {\n    super.resize(point, preserveAspectRatio);\n    this.setSize();\n  }\n\n  public override pointerUp(point: IPoint, ev?: PointerEvent): void {\n    super.pointerUp(point, ev);\n    this.setSize();\n  }\n}\n","/**\n * Manages undo and redo stacks.\n */\nexport class UndoRedoManager<T> {\n  private undoStack: T[] = [];\n  private redoStack: T[] = [];\n\n  private lastRedoStep?: T;\n\n  /**\n   * Returns true if there are items in the undo stack.\n   */\n  public get isUndoPossible(): boolean {\n    return this.undoStack.length > 1;\n  }\n\n  /**\n   * Returns true if there are items in the redo stack.\n   */\n  public get isRedoPossible(): boolean {\n    return this.redoStack.length > 0;\n  }\n\n  /**\n   * Returns the number of items in the undo stack\n   */\n  public get undoStepCount(): number {\n    return this.undoStack.length;\n  }\n\n  /**\n   * Returns the number of items in the redo stack\n   */\n  public get redoStepCount(): number {\n    return this.redoStack.length;\n  }\n\n  /**\n   * Adds a step to the undo stack.\n   * @param stepData data representing a state.\n   */\n  public addUndoStep(stepData: T): boolean {\n    if (\n      this.undoStack.length === 0 ||\n      JSON.stringify(this.undoStack[this.undoStack.length - 1]) !==\n        JSON.stringify(stepData)\n    ) {\n      this.undoStack.push(JSON.parse(JSON.stringify(stepData)));\n      if (JSON.stringify(this.lastRedoStep) !== JSON.stringify(stepData)) {\n        this.redoStack.splice(0, this.redoStack.length);\n      }\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Replaces the last undo step with step data provided\n   * @param stepData data representing a state.\n   */\n  public replaceLastUndoStep(stepData: T): void {\n    if (this.undoStack.length > 0) {\n      this.undoStack[this.undoStack.length - 1] = JSON.parse(\n        JSON.stringify(stepData),\n      );\n    }\n  }\n\n  /**\n   * Returns the last step in the undo log\n   */\n  public getLastUndoStep(): T | undefined {\n    if (this.undoStack.length > 0) {\n      return this.undoStack[this.undoStack.length - 1];\n    } else {\n      return undefined;\n    }\n  }\n\n  /**\n   * Returns data for the previous step in the undo stack and adds last step to the redo stack.\n   * @returns\n   */\n  public undo(): T | undefined {\n    if (this.undoStack.length > 1) {\n      const lastStep = this.undoStack.pop();\n      if (lastStep !== undefined) {\n        this.redoStack.push(lastStep);\n      }\n      return this.undoStack.length > 0\n        ? this.undoStack[this.undoStack.length - 1]\n        : undefined;\n    }\n  }\n\n  /**\n   * Returns most recent item in the redo stack.\n   * @returns\n   */\n  public redo(): T | undefined {\n    this.lastRedoStep = this.redoStack.pop();\n    if (this.lastRedoStep !== undefined) {\n      this.undoStack.push(this.lastRedoStep);\n    }\n    return this.lastRedoStep;\n  }\n}\n","import { FreehandMarker, IPoint, SvgHelper } from '../core';\nimport { MarkerBaseEditor } from './MarkerBaseEditor';\nimport { MarkerEditorProperties } from './MarkerEditorProperties';\n\n/**\n * Editor for freehand markers.\n *\n * @summary Freehand marker editor.\n * @group Editors\n */\nexport class FreehandMarkerEditor<\n  TMarkerType extends FreehandMarker = FreehandMarker,\n> extends MarkerBaseEditor<TMarkerType> {\n  /**\n   * Pointer X coordinate at the start of move or resize.\n   */\n  protected manipulationStartX = 0;\n  /**\n   * Pointer Y coordinate at the start of move or resize.\n   */\n  protected manipulationStartY = 0;\n\n  /**\n   * Container for control elements.\n   */\n  protected controlBox: SVGGElement = SvgHelper.createGroup();\n  private controlRect?: SVGRectElement;\n\n  constructor(properties: MarkerEditorProperties<TMarkerType>) {\n    super(properties);\n\n    this._continuousCreation = true;\n\n    this.ownsTarget = this.ownsTarget.bind(this);\n\n    this.setupControlBox = this.setupControlBox.bind(this);\n    this.adjustControlBox = this.adjustControlBox.bind(this);\n\n    this.manipulate = this.manipulate.bind(this);\n    this.pointerDown = this.pointerDown.bind(this);\n    this.pointerUp = this.pointerUp.bind(this);\n\n    this.setupControlBox();\n  }\n\n  public ownsTarget(el: EventTarget): boolean {\n    if (\n      super.ownsTarget(el) ||\n      this.marker.ownsTarget(el) ||\n      el === this.controlRect\n    ) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  public override pointerDown(\n    point: IPoint,\n    target?: EventTarget,\n    ev?: PointerEvent,\n  ): void {\n    super.pointerDown(point, target, ev);\n\n    this.manipulationStartX = point.x;\n    this.manipulationStartY = point.y;\n\n    if (this.state === 'new') {\n      this.startCreation(point);\n    } else if (this.state !== 'move') {\n      this.select();\n      this._state = 'move';\n    }\n  }\n\n  private startCreation(point: IPoint) {\n    this.marker.stage = 'creating';\n    this.marker.points.push(point);\n    this.marker.createVisual();\n    this.marker.adjustVisual();\n    this._state = 'creating';\n  }\n\n  private addNewPointWhileCreating(point: IPoint) {\n    this.marker.points.push(point);\n    this.marker.adjustVisual();\n  }\n\n  private finishCreation() {\n    this.marker.stage = 'normal';\n    this.marker.adjustVisual();\n    this._state = 'select';\n    if (this.onMarkerCreated) {\n      this.onMarkerCreated(this);\n    }\n  }\n\n  public override pointerUp(point: IPoint, ev?: PointerEvent): void {\n    super.pointerUp(point, ev);\n    this.manipulate(point, ev);\n    if (this._state === 'creating') {\n      this.finishCreation();\n    }\n    this.state = 'select';\n    this.stateChanged();\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  public override manipulate(point: IPoint, ev?: PointerEvent): void {\n    if (this.state === 'creating') {\n      this.addNewPointWhileCreating(point);\n    } else if (this.state === 'move') {\n      this.marker.points.forEach((p) => {\n        p.x += point.x - this.manipulationStartX;\n        p.y += point.y - this.manipulationStartY;\n      });\n      this.manipulationStartX = point.x;\n      this.manipulationStartY = point.y;\n      this.marker.adjustVisual();\n      this.adjustControlBox();\n    }\n  }\n\n  /**\n   * Creates control box for manipulation controls.\n   */\n  protected setupControlBox(): void {\n    this.controlBox = SvgHelper.createGroup();\n    this.container.appendChild(this.controlBox);\n\n    this.controlRect = SvgHelper.createRect(0, 0, [\n      ['stroke', 'black'],\n      ['stroke-width', '1'],\n      ['stroke-opacity', '0.5'],\n      ['stroke-dasharray', '3, 2'],\n      ['fill', 'transparent'],\n    ]);\n\n    this.controlBox.appendChild(this.controlRect);\n\n    this.controlBox.style.display = 'none';\n  }\n\n  protected adjustControlBox() {\n    if (this.marker.points.length > 0) {\n      const left = Math.min(...this.marker.points.map((p) => p.x));\n      const top = Math.min(...this.marker.points.map((p) => p.y));\n      const right = Math.max(...this.marker.points.map((p) => p.x));\n      const bottom = Math.max(...this.marker.points.map((p) => p.y));\n\n      if (this.controlRect) {\n        SvgHelper.setAttributes(this.controlRect, [\n          ['x', (left - this.strokeWidth).toString()],\n          ['y', (top - this.strokeWidth).toString()],\n          ['width', (right - left + this.strokeWidth * 2).toString()],\n          ['height', (bottom - top + this.strokeWidth * 2).toString()],\n        ]);\n      }\n    }\n  }\n\n  public select(): void {\n    super.select();\n    this.adjustControlBox();\n    this.controlBox.style.display = '';\n  }\n\n  public deselect(): void {\n    super.deselect();\n    this.controlBox.style.display = 'none';\n  }\n}\n","/**\n * Text changed event handler type.\n */\nexport type TextChangedHandler = (text: string) => void;\n\n/**\n * Blur event handler type.\n */\nexport type BlurHandler = () => void;\n\n/**\n * Represents a text block editor element.\n */\nexport class TextBlockEditor {\n  private textEditor: HTMLDivElement;\n  private isInFocus = false;\n\n  private _width = 0;\n  /**\n   * Returns editor width in pixels.\n   */\n  public get width() {\n    return this._width;\n  }\n  /**\n   * Sets editor width in pixels.\n   */\n  public set width(value) {\n    this._width = value;\n    this.textEditor.style.width = `${this.width}px`;\n  }\n\n  private _height = 0;\n  /**\n   * Returns editor height in pixels.\n   */\n  public get height() {\n    return this._height;\n  }\n  /**\n   * Sets editor height in pixels.\n   */\n  public set height(value) {\n    this._height = value;\n    this.textEditor.style.height = `${this.height}px`;\n  }\n\n  private _left = 0;\n  /**\n   * Returns the horizontal (X) location of the editor's left corner (in pixels).\n   */\n  public get left() {\n    return this._left;\n  }\n  /**\n   * Sets the horizontal (X) location of the editor's left corner (in pixels).\n   */\n  public set left(value) {\n    this._left = value;\n    this.textEditor.style.left = `${this.left}px`;\n  }\n\n  private _top = 0;\n  /**\n   * Returns the vertical (Y) location of the editor's top left corner (in pixels).\n   */\n  public get top() {\n    return this._top;\n  }\n  /**\n   * Sets the vertical (Y) location of the editor's top left corner (in pixels).\n   */\n  public set top(value) {\n    this._top = value;\n    this.textEditor.style.top = `${this.top}px`;\n  }\n\n  private _text = '';\n  /**\n   * Returns the text block text.\n   */\n  public get text() {\n    return this._text;\n  }\n  /**\n   * Sets the text block text.\n   */\n  public set text(value) {\n    this._text = value;\n  }\n\n  private _fontFamily = 'sans-serif';\n  /**\n   * Returns text block's font family.\n   */\n  public get fontFamily() {\n    return this._fontFamily;\n  }\n  /**\n   * Sets the text block's font family.\n   */\n  public set fontFamily(value) {\n    this._fontFamily = value;\n    this.textEditor.style.fontFamily = this._fontFamily;\n  }\n\n  private _fontSize = '1rem';\n  /**\n   * Returns text block's font size.\n   */\n  public get fontSize() {\n    return this._fontSize;\n  }\n  /**\n   * Sets text block's font size.\n   */\n  public set fontSize(value) {\n    this._fontSize = value;\n    this.textEditor.style.fontSize = this._fontSize;\n  }\n\n  private _textColor = '#000';\n  /**\n   * Returns text block's font color.\n   */\n  public get textColor() {\n    return this._textColor;\n  }\n  /**\n   * Returns text block's font color.\n   */\n  public set textColor(value) {\n    this._textColor = value;\n    this.textEditor.style.color = this.textColor;\n  }\n\n  private _bgColor = 'transparent';\n  /**\n   * Returns text block's background color.\n   */\n  public get bgColor() {\n    return this._bgColor;\n  }\n  /**\n   * Sets text block's background color.\n   */\n  public set bgColor(value) {\n    this._bgColor = value;\n    this.textEditor.style.backgroundColor = this.bgColor;\n  }\n\n  /**\n   * Text changed event handler.\n   */\n  public onTextChanged?: TextChangedHandler;\n\n  /**\n   * Blur event handler.\n   */\n  public onBlur?: BlurHandler;\n\n  /**\n   * Creates a new text block editor instance.\n   */\n  constructor() {\n    this.textEditor = document.createElement('div');\n\n    this.getEditorUi = this.getEditorUi.bind(this);\n    this.focus = this.focus.bind(this);\n    this.setup = this.setup.bind(this);\n  }\n\n  private isSetupCompleted = false;\n  private setup() {\n    // this.textEditor.style.position = 'absolute';\n    this.textEditor.style.pointerEvents = 'auto';\n    this.textEditor.style.display = 'flex';\n    this.textEditor.style.flexDirection = 'column';\n    this.textEditor.style.alignItems = 'center';\n    this.textEditor.style.justifyContent = 'center';\n    this.textEditor.style.width = `${this._width}px`;\n    this.textEditor.style.height = `${this._height}px`;\n    this.textEditor.style.overflow = 'hidden';\n    this.textEditor.style.textAlign = 'center';\n    this.textEditor.style.fontFamily = this._fontFamily;\n    this.textEditor.style.fontSize = this._fontSize;\n    this.textEditor.style.lineHeight = '1em';\n    if (this._text !== '') {\n      this.textEditor.innerText = this._text;\n    } else {\n      this.textEditor.innerHTML = '&nbsp;';\n    }\n    this.textEditor.contentEditable = 'true';\n    this.textEditor.style.outline = 'none';\n    this.textEditor.style.color = this._textColor;\n    this.textEditor.style.whiteSpace = 'pre';\n    this.textEditor.addEventListener('pointerdown', (ev) => {\n      ev.stopPropagation();\n    });\n    this.textEditor.addEventListener('pointerup', (ev) => {\n      ev.stopPropagation();\n    });\n    this.textEditor.addEventListener('keydown', (ev) => {\n      if (ev.key === 'Escape') {\n        ev.preventDefault();\n        this.textEditor.blur();\n      }\n    });\n    this.textEditor.addEventListener('keyup', (ev) => {\n      ev.cancelBubble = true;\n      this._text = this.textEditor.innerText;\n      if (this.onTextChanged !== undefined) {\n        this.onTextChanged(this._text);\n      }\n    });\n    this.textEditor.addEventListener('blur', () => {\n      this._text = this.textEditor.innerText;\n      if (this.onTextChanged !== undefined) {\n        this.onTextChanged(this._text);\n      }\n      if (this.onBlur !== undefined) {\n        this.onBlur();\n      }\n    });\n    this.textEditor.addEventListener('paste', (ev) => {\n      if (ev.clipboardData) {\n        // paste plain text\n        const content = ev.clipboardData.getData('text');\n        const selection = window.getSelection();\n        if (!selection || !selection.rangeCount) return false;\n        selection.deleteFromDocument();\n        selection.getRangeAt(0).insertNode(document.createTextNode(content));\n        ev.preventDefault();\n      }\n    });\n\n    this.isSetupCompleted = true;\n  }\n\n  /**\n   * Returns editor's UI,\n   * @returns UI in a div element.\n   */\n  public getEditorUi(): HTMLDivElement {\n    if (!this.isSetupCompleted) {\n      this.setup();\n    }\n\n    return this.textEditor;\n  }\n\n  /**\n   * Focuses text editing in the editor.\n   */\n  public focus() {\n    this.textEditor.focus();\n\n    // position cursor at the end of the text\n    const range = document.createRange();\n    range.selectNodeContents(this.textEditor);\n    range.collapse(false);\n    const selection = window.getSelection();\n    selection?.removeAllRanges();\n    selection?.addRange(range);\n  }\n  /**\n   * Unfocuses the editor.\n   */\n  public blur() {\n    this.textEditor.blur();\n  }\n}\n","import { FontSize, IPoint, SvgHelper, TextMarker } from '../core';\nimport { MarkerEditorProperties } from './MarkerEditorProperties';\nimport { RectangularBoxMarkerBaseEditor } from './RectangularBoxMarkerBaseEditor';\nimport { TextBlockEditor } from './TextBlockEditor';\n\n/**\n * Editor for text markers.\n *\n * @summary Text marker editor.\n * @group Editors\n */\nexport class TextMarkerEditor<\n  TMarkerType extends TextMarker = TextMarker,\n> extends RectangularBoxMarkerBaseEditor<TMarkerType> {\n  /**\n   * Container for text block editor.\n   */\n  protected textBlockEditorContainer: SVGForeignObjectElement =\n    SvgHelper.createForeignObject();\n  /**\n   * Text block editor.\n   */\n  protected textBlockEditor: TextBlockEditor;\n\n  /**\n   * Text color.\n   */\n  public set color(color: string) {\n    this.marker.color = color;\n    this.stateChanged();\n  }\n  /**\n   * Text color.\n   */\n  public get color(): string {\n    return this.marker.color;\n  }\n\n  /**\n   * Sets text's font family.\n   */\n  public set fontFamily(font: string) {\n    this.marker.fontFamily = font;\n    this.stateChanged();\n  }\n  /**\n   * Returns text's font family.\n   */\n  public get fontFamily(): string {\n    return this.marker.fontFamily;\n  }\n\n  /**\n   * Sets text's font size.\n   */\n  public set fontSize(size: FontSize) {\n    this.marker.fontSize = size;\n    this.stateChanged();\n  }\n  /**\n   * Returns text's font size.\n   */\n  public get fontSize(): FontSize {\n    return this.marker.fontSize;\n  }\n\n  constructor(properties: MarkerEditorProperties<TMarkerType>) {\n    super(properties);\n\n    this.disabledResizeGrips = [\n      'topleft',\n      'topcenter',\n      'topright',\n      'bottomleft',\n      'bottomcenter',\n      'bottomright',\n      'leftcenter',\n      'rightcenter',\n    ];\n\n    this._creationStyle = 'drop';\n\n    this.textBlockEditor = new TextBlockEditor();\n    this.marker.onSizeChanged = this.markerSizeChanged;\n\n    this.showEditor = this.showEditor.bind(this);\n    this.hideEditor = this.hideEditor.bind(this);\n    this.pointerDown = this.pointerDown.bind(this);\n    this.pointerUp = this.pointerUp.bind(this);\n    this.resize = this.resize.bind(this);\n    this.markerSizeChanged = this.markerSizeChanged.bind(this);\n  }\n\n  private _pointerDownTime: number = Number.MAX_VALUE;\n  private _pointerDownPoint: IPoint = { x: 0, y: 0 };\n\n  public override pointerDown(\n    point: IPoint,\n    target?: EventTarget,\n    ev?: PointerEvent,\n  ): void {\n    super.pointerDown(point, target, ev);\n\n    this._pointerDownTime = Date.now();\n    this._pointerDownPoint = point;\n\n    if (this.state === 'new') {\n      this.marker.createVisual();\n\n      this.marker.moveVisual(point);\n\n      this._state = 'creating';\n    }\n  }\n\n  public override dblClick(\n    point: IPoint,\n    target?: EventTarget,\n    ev?: MouseEvent,\n  ): void {\n    super.dblClick(point, target, ev);\n    if (this.state !== 'edit') {\n      this.showEditor();\n    }\n  }\n\n  protected setSize(): void {\n    super.setSize();\n    this.textBlockEditorContainer.style.transform = `translate(${this.marker.left}px, ${this.marker.top}px)`;\n    this.textBlockEditorContainer.style.width = `${this.marker.width}px`;\n    this.textBlockEditorContainer.setAttribute('width', `${this.marker.width}`);\n    this.textBlockEditorContainer.style.height = `${this.marker.height}px`;\n    this.textBlockEditorContainer.setAttribute(\n      'height',\n      `${this.marker.height}`,\n    );\n    this.textBlockEditor.width = this.marker.width;\n    this.textBlockEditor.height = this.marker.height;\n  }\n\n  protected resize(point: IPoint, preserveAspectRatio = false): void {\n    super.resize(point, preserveAspectRatio);\n    this.setSize();\n  }\n\n  public override pointerUp(point: IPoint, ev?: PointerEvent): void {\n    const inState = this.state;\n    super.pointerUp(point, ev);\n    this.setSize();\n\n    if (\n      inState === 'creating' ||\n      (Date.now() - this._pointerDownTime > 500 &&\n        Math.abs(this._pointerDownPoint.x - point.x) < 5 &&\n        Math.abs(this._pointerDownPoint.y - point.y) < 5)\n    ) {\n      this.showEditor();\n    }\n\n    this.adjustControlBox();\n  }\n\n  private showEditor(): void {\n    this.textBlockEditor.text = this.marker.text;\n    this.textBlockEditor.textColor = this.marker.color;\n    this.textBlockEditor.bgColor = this.marker.fillColor;\n    this.textBlockEditor.fontFamily = this.marker.fontFamily;\n    this.textBlockEditor.fontSize = `${this.marker.fontSize.value}${this.marker.fontSize.units}`;\n\n    if (this.textBlockEditor.onTextChanged === undefined) {\n      this.textBlockEditor.onTextChanged = (text: string) => {\n        this.marker.text = text;\n      };\n    }\n    if (this.textBlockEditor.onBlur === undefined) {\n      this.textBlockEditor.onBlur = () => {\n        this.hideEditor();\n        this.deselect();\n      };\n    }\n    this.textBlockEditorContainer.appendChild(\n      this.textBlockEditor.getEditorUi(),\n    );\n    this.container.appendChild(this.textBlockEditorContainer);\n\n    this.marker.hideVisual();\n    this.hideControlBox();\n\n    this.textBlockEditor.focus();\n  }\n\n  private hideEditor(): void {\n    this.marker.text = this.textBlockEditor.text;\n    this.marker.showVisual();\n    this.showControlBox();\n    this.state = 'select';\n    this.container.removeChild(this.textBlockEditorContainer);\n  }\n\n  private markerSizeChanged = () => {\n    this.setSize();\n  };\n}\n","import { ShapeMarkerBase } from '../core';\nimport { ShapeOutlineMarkerEditor } from './ShapeOutlineMarkerEditor';\n\n/**\n * Editor for filled shape markers.\n *\n * @summary Filled shape marker editor.\n * @group Editors\n */\nexport class ShapeMarkerEditor<\n  TMarkerType extends ShapeMarkerBase = ShapeMarkerBase,\n> extends ShapeOutlineMarkerEditor<TMarkerType> {}\n","import { ArrowMarker, ArrowType } from '../core';\nimport { LinearMarkerEditor } from './LinearMarkerEditor';\n\n/**\n * Editor for arrow markers.\n *\n * @summary Arrow marker editor.\n * @group Editors\n */\nexport class ArrowMarkerEditor<\n  TMarkerType extends ArrowMarker = ArrowMarker,\n> extends LinearMarkerEditor<TMarkerType> {\n  /**\n   * Sets the arrow type.\n   */\n  public set arrowType(value: ArrowType) {\n    this.marker.arrowType = value;\n  }\n\n  /**\n   * Returns the arrow type.\n   */\n  public get arrowType(): ArrowType {\n    return this.marker.arrowType;\n  }\n}\n","import { CalloutMarker, IPoint, SvgHelper } from '../core';\nimport { MarkerEditorProperties } from './MarkerEditorProperties';\nimport { ResizeGrip } from './ResizeGrip';\nimport { TextMarkerEditor } from './TextMarkerEditor';\n\n/**\n * Editor for callout markers.\n *\n * @summary Callout marker editor.\n * @group Editors\n */\nexport class CalloutMarkerEditor<\n  TMarkerType extends CalloutMarker = CalloutMarker,\n> extends TextMarkerEditor<TMarkerType> {\n  private tipGrip?: ResizeGrip;\n\n  private manipulationStartTipPositionX = 0;\n  private manipulationStartTipPositionY = 0;\n\n  constructor(properties: MarkerEditorProperties<TMarkerType>) {\n    super(properties);\n  }\n\n  protected addControlGrips(): void {\n    this.tipGrip = this.createTipGrip();\n\n    super.addControlGrips();\n  }\n\n  private createTipGrip(): ResizeGrip {\n    const grip = new ResizeGrip();\n    grip.visual.transform.baseVal.appendItem(SvgHelper.createTransform());\n    this.manipulationBox.appendChild(grip.visual);\n\n    return grip;\n  }\n\n  protected positionGrips() {\n    super.positionGrips();\n\n    if (this.tipGrip) {\n      const tipGripSize = this.tipGrip.gripSize ?? 0;\n      this.positionGrip(\n        this.tipGrip.visual,\n        this.marker.tipPosition.x - tipGripSize / 2,\n        this.marker.tipPosition.y - tipGripSize / 2,\n      );\n    }\n  }\n\n  public ownsTarget(el: EventTarget): boolean {\n    if (super.ownsTarget(el) || this.tipGrip?.ownsTarget(el)) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  public override pointerDown(\n    point: IPoint,\n    target?: EventTarget,\n    ev?: PointerEvent,\n  ): void {\n    super.pointerDown(point, target, ev);\n\n    this.manipulationStartTipPositionX = this.marker.tipPosition.x;\n    this.manipulationStartTipPositionY = this.marker.tipPosition.y;\n\n    if (\n      this.tipGrip !== undefined &&\n      target !== undefined &&\n      this.tipGrip.ownsTarget(target)\n    ) {\n      this.activeGrip = this.tipGrip;\n      this._state = 'resize';\n    }\n  }\n\n  protected resize(point: IPoint, preserveAspectRatio = false): void {\n    const newX =\n      this.manipulationStartTipPositionX + point.x - this.manipulationStartX;\n    const newY =\n      this.manipulationStartTipPositionY + point.y - this.manipulationStartY;\n\n    if (this.activeGrip === this.tipGrip) {\n      this.marker.tipPosition = { x: newX, y: newY };\n      this.adjustControlBox();\n    } else {\n      super.resize(point, preserveAspectRatio);\n    }\n  }\n}\n","import { ImageMarkerBase, IPoint } from '../core';\nimport { MarkerEditorProperties } from './MarkerEditorProperties';\nimport { RectangularBoxMarkerBaseEditor } from './RectangularBoxMarkerBaseEditor';\n\n/**\n * Editor for image markers.\n *\n * @summary Image marker editor.\n * @group Editors\n */\nexport class ImageMarkerEditor<\n  TMarkerType extends ImageMarkerBase = ImageMarkerBase,\n> extends RectangularBoxMarkerBaseEditor<TMarkerType> {\n  constructor(properties: MarkerEditorProperties<TMarkerType>) {\n    super(properties);\n\n    this._creationStyle = 'drop';\n\n    this.disabledResizeGrips = [\n      'topcenter',\n      'bottomcenter',\n      'leftcenter',\n      'rightcenter',\n    ];\n\n    this.pointerDown = this.pointerDown.bind(this);\n    this.pointerUp = this.pointerUp.bind(this);\n    this.resize = this.resize.bind(this);\n  }\n\n  public override pointerDown(\n    point: IPoint,\n    target?: EventTarget,\n    ev?: PointerEvent,\n  ): void {\n    super.pointerDown(point, target, ev);\n\n    if (this.state === 'new') {\n      this.marker.createVisual();\n\n      this.marker.moveVisual(point);\n\n      this._state = 'creating';\n    }\n  }\n\n  public override pointerUp(point: IPoint, ev?: PointerEvent): void {\n    super.pointerUp(point, ev);\n    this.setSize();\n    this.adjustControlBox();\n  }\n}\n","import { CaptionFrameMarker } from '../core';\nimport { MarkerEditorProperties } from './MarkerEditorProperties';\nimport { TextMarkerEditor } from './TextMarkerEditor';\n\n/**\n * Editor for caption frame markers.\n *\n * @summary Caption frame marker editor.\n * @group Editors\n */\nexport class CaptionFrameMarkerEditor<\n  TMarkerType extends CaptionFrameMarker = CaptionFrameMarker,\n> extends TextMarkerEditor<TMarkerType> {\n  constructor(properties: MarkerEditorProperties<TMarkerType>) {\n    super(properties);\n\n    this.disabledResizeGrips = [];\n    this._creationStyle = 'draw';\n  }\n\n  protected setSize(): void {\n    super.setSize();\n    this.textBlockEditorContainer.style.transform = `translate(${\n      this.marker.left\n    }px, ${this.marker.top + this.marker.strokeWidth / 2}px)`;\n    if (this.marker.textBlock.textSize) {\n      const height =\n        this.marker.textBlock.textSize.height + this.marker.padding * 2;\n      this.textBlockEditorContainer.style.width = `${this.marker.width}px`;\n      this.textBlockEditorContainer.style.height = `${height}px`;\n      this.textBlockEditor.width = this.marker.width;\n      this.textBlockEditor.height = height;\n    }\n  }\n}\n","import { CurveMarker, IPoint, SvgHelper } from '../core';\nimport { LinearMarkerEditor } from './LinearMarkerEditor';\nimport { ResizeGrip } from './ResizeGrip';\n\nexport class CurveMarkerEditor<\n  TMarkerType extends CurveMarker = CurveMarker,\n> extends LinearMarkerEditor<TMarkerType> {\n  /**\n   * Curve manipulation grip.\n   */\n  protected curveGrip?: ResizeGrip;\n\n  private manipulationStartCurveX = 0;\n  private manipulationStartCurveY = 0;\n\n  private curveControlLine1?: SVGLineElement;\n  private curveControlLine2?: SVGLineElement;\n\n  public ownsTarget(el: EventTarget): boolean {\n    if (super.ownsTarget(el) || this.curveGrip?.ownsTarget(el)) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  public override pointerDown(\n    point: IPoint,\n    target?: EventTarget,\n    ev?: PointerEvent,\n  ): void {\n    if (this.state === 'new') {\n      this.marker.curveX = point.x;\n      this.marker.curveY = point.y;\n    }\n\n    this.manipulationStartCurveX = this.marker.curveX;\n    this.manipulationStartCurveY = this.marker.curveY;\n\n    super.pointerDown(point, target, ev);\n\n    if (this.state !== 'new' && this.state !== 'creating') {\n      if (target && this.curveGrip?.ownsTarget(target)) {\n        this.activeGrip = this.curveGrip;\n      }\n\n      if (this.activeGrip) {\n        this._state = 'resize';\n      } else {\n        this._state = 'move';\n      }\n    }\n  }\n\n  protected resize(point: IPoint): void {\n    super.resize(point);\n\n    if (this.activeGrip === this.curveGrip) {\n      this.marker.curveX = point.x;\n      this.marker.curveY = point.y;\n\n      this.marker.adjustVisual();\n      this.adjustControlBox();\n    }\n\n    if (this.state === 'creating') {\n      this.marker.curveX =\n        this.marker.x1 + (this.marker.x2 - this.marker.x1) / 2;\n      this.marker.curveY =\n        this.marker.y1 + (this.marker.y2 - this.marker.y1) / 2;\n    }\n  }\n\n  public override manipulate(point: IPoint, ev?: PointerEvent): void {\n    if (this.state === 'move') {\n      this.marker.curveX =\n        this.manipulationStartCurveX + point.x - this.manipulationStartX;\n      this.marker.curveY =\n        this.manipulationStartCurveY + point.y - this.manipulationStartY;\n    }\n    super.manipulate(point, ev);\n  }\n\n  protected setupControlBox(): void {\n    super.setupControlBox();\n    this.curveControlLine1 = SvgHelper.createLine(\n      this.marker.x1,\n      this.marker.y1,\n      this.marker.curveX,\n      this.marker.curveY,\n      [\n        ['stroke', 'black'],\n        ['stroke-width', '1'],\n        ['stroke-opacity', '0.5'],\n        ['stroke-dasharray', '3, 2'],\n        ['fill', 'transparent'],\n        ['pointer-events', 'none'],\n      ],\n    );\n    this.curveControlLine2 = SvgHelper.createLine(\n      this.marker.x2,\n      this.marker.y2,\n      this.marker.curveX,\n      this.marker.curveY,\n      [\n        ['stroke', 'black'],\n        ['stroke-width', '1'],\n        ['stroke-opacity', '0.5'],\n        ['stroke-dasharray', '3, 2'],\n        ['fill', 'transparent'],\n        ['pointer-events', 'none'],\n      ],\n    );\n\n    this._controlBox.insertBefore(\n      this.curveControlLine1,\n      this._controlBox.firstChild,\n    );\n    this._controlBox.insertBefore(\n      this.curveControlLine2,\n      this._controlBox.firstChild,\n    );\n  }\n\n  protected adjustControlBox() {\n    super.adjustControlBox();\n\n    if (this.curveControlLine1 && this.curveControlLine2) {\n      this.curveControlLine1.setAttribute('x1', this.marker.x1.toString());\n      this.curveControlLine1.setAttribute('y1', this.marker.y1.toString());\n      this.curveControlLine1.setAttribute('x2', this.marker.curveX.toString());\n      this.curveControlLine1.setAttribute('y2', this.marker.curveY.toString());\n\n      this.curveControlLine2.setAttribute('x1', this.marker.x2.toString());\n      this.curveControlLine2.setAttribute('y1', this.marker.y2.toString());\n      this.curveControlLine2.setAttribute('x2', this.marker.curveX.toString());\n      this.curveControlLine2.setAttribute('y2', this.marker.curveY.toString());\n    }\n  }\n\n  protected addControlGrips(): void {\n    super.addControlGrips();\n\n    this.curveGrip = this.createGrip();\n    this.positionGrips();\n  }\n\n  protected positionGrips(): void {\n    super.positionGrips();\n\n    if (this.curveGrip) {\n      const gripSize = this.curveGrip.gripSize;\n\n      this.positionGrip(\n        this.curveGrip.visual,\n        this.marker.curveX - gripSize / 2,\n        this.marker.curveY - gripSize / 2,\n      );\n    }\n  }\n}\n","import {\n  AnnotationState,\n  CalloutMarker,\n  CaptionFrameMarker,\n  CheckImageMarker,\n  CoverMarker,\n  CurveMarker,\n  CustomImageMarker,\n  EllipseFrameMarker,\n  EllipseMarker,\n  FrameMarker,\n  FreehandMarker,\n  HighlighterMarker,\n  HighlightMarker,\n  IPoint,\n  LineMarker,\n  MarkerBase,\n  PolygonMarker,\n  TextMarker,\n  XImageMarker,\n  SvgFilters,\n} from './core';\nimport { SvgHelper } from './core/SvgHelper';\nimport { PolygonMarkerEditor } from './editor/PolygonMarkerEditor';\nimport { LinearMarkerEditor } from './editor/LinearMarkerEditor';\nimport { MarkerBaseEditor } from './editor/MarkerBaseEditor';\nimport { ShapeOutlineMarkerEditor } from './editor/ShapeOutlineMarkerEditor';\nimport { UndoRedoManager } from './editor/UndoRedoManager';\nimport { FreehandMarkerEditor } from './editor/FreehandMarkerEditor';\nimport { TextMarkerEditor } from './editor/TextMarkerEditor';\nimport { Activator } from './core/Activator';\n\nimport Logo from './assets/markerjs-logo-m.svg';\nimport { ShapeMarkerEditor } from './editor/ShapeMarkerEditor';\nimport { ArrowMarker } from './core/ArrowMarker';\nimport { ArrowMarkerEditor } from './editor/ArrowMarkerEditor';\nimport { MeasurementMarker } from './core/MeasurementMarker';\nimport { CalloutMarkerEditor } from './editor/CalloutMarkerEditor';\nimport { ImageMarkerEditor } from './editor/ImageMarkerEditor';\nimport { CaptionFrameMarkerEditor } from './editor/CaptionFrameMarkerEditor';\nimport { CurveMarkerEditor } from './editor/CurveMarkerEditor';\n\n/**\n * Marker area custom event types.\n */\nexport interface MarkerAreaEventMap {\n  /**\n   * Marker area initialized.\n   */\n  areainit: CustomEvent<MarkerAreaEventData>;\n  /**\n   * Marker area shown.\n   */\n  areashow: CustomEvent<MarkerAreaEventData>;\n  /**\n   * Marker area state restored.\n   */\n  arearestorestate: CustomEvent<MarkerAreaEventData>;\n  /**\n   * Marker area focused.\n   */\n  areafocus: CustomEvent<MarkerAreaEventData>;\n  /**\n   * Marker area lost focus.\n   */\n  areablur: CustomEvent<MarkerAreaEventData>;\n  /**\n   * Marker area state changed.\n   */\n  areastatechange: CustomEvent<MarkerAreaEventData>;\n\n  /**\n   * Marker selected.\n   */\n  markerselect: CustomEvent<MarkerEditorEventData>;\n  /**\n   * Marker deselected.\n   */\n  markerdeselect: CustomEvent<MarkerEditorEventData>;\n  /**\n   * Marker creating.\n   */\n  markercreating: CustomEvent<MarkerEditorEventData>;\n  /**\n   * Marker created.\n   */\n  markercreate: CustomEvent<MarkerEditorEventData>;\n  /**\n   * Marker about to be deleted.\n   */\n  markerbeforedelete: CustomEvent<MarkerEditorEventData>;\n  /**\n   * Marker deleted.\n   */\n  markerdelete: CustomEvent<MarkerEditorEventData>;\n  /**\n   * Marker changed.\n   */\n  markerchange: CustomEvent<MarkerEditorEventData>;\n}\n\n/**\n * Marker area custom event data.\n */\nexport interface MarkerAreaEventData {\n  /**\n   * {@link MarkerArea} instance.\n   */\n  markerArea: MarkerArea;\n}\n\n/**\n * Marker editor custom event data.\n */\nexport interface MarkerEditorEventData extends MarkerAreaEventData {\n  markerEditor: MarkerBaseEditor;\n}\n\n/**\n * @ignore\n */\nexport type MarkerAreaMode = 'select' | 'create' | 'delete';\n\n/**\n * Marker area web component is the main annotation editor component.\n *\n * @summary\n * The main annotation editor component.\n *\n * @group Components\n *\n * @example\n *\n * Import `MarkerArea` from `@markerjs/markerjs3`:\n *\n * ```js\n * import { MarkerArea } from '@markerjs/markerjs3';\n * ```\n *\n * In the code below we assume that you have an `HTMLImageElement` as `targetImage`. It can be a reference to an image you already have on the page or you can simply create it with something like this:\n *\n * ```js\n * const targetImg = document.createElement('img');\n * targetImg.src = './sample.jpg';\n * ```\n *\n * Now you just need to create an instance of `MarkerArea`, set its `targetImage` property and add it to the page:\n *\n * ```js\n * const markerArea = new MarkerArea();\n * markerArea.targetImage = targetImg;\n * editorContainerDiv.appendChild(markerArea);\n * ```\n *\n * To initiate creation of a marker you just call `createMarker()` and pass it the name (or type) of the marker you want to create. So, if you have a button with id `addFrameButton` you can make it create a new `FrameMarker` with something like this:\n *\n * ```js\n * document.querySelector(\"#addButton\")!.addEventListener(\"click\", () => {\n *   markerArea.createMarker(\"FrameMarker\");\n * });\n * ```\n *\n * And whenever you want to save state (current annotation) you just call `getState()`:\n *\n * ```js\n * document.querySelector(\"#saveStateButton\")!.addEventListener(\"click\", () => {\n *   const state = markerArea.getState();\n *   console.log(state);\n * });\n * ```\n */\nexport class MarkerArea extends HTMLElement {\n  private _contentContainer?: HTMLDivElement;\n  private _canvasContainer?: HTMLDivElement;\n\n  private _overlayContainer!: HTMLDivElement;\n  private _overlayContentContainer!: HTMLDivElement;\n\n  private _mainCanvas?: SVGSVGElement;\n  private _groupLayer?: SVGGElement;\n\n  private _editingTarget?: HTMLImageElement;\n\n  private width = 0;\n  private height = 0;\n\n  private _targetWidth = -1;\n  /**\n   * Returns the target image width.\n   */\n  public get targetWidth() {\n    return this._targetWidth;\n  }\n  /**\n   * Sets the target image width.\n   */\n  public set targetWidth(value) {\n    this._targetWidth = value;\n    this.setMainCanvasSize();\n  }\n  private _targetHeight = -1;\n  /**\n   * Returns the target image height.\n   */\n  public get targetHeight() {\n    return this._targetHeight;\n  }\n  /**\n   * Sets the target image height.\n   */\n  public set targetHeight(value) {\n    this._targetHeight = value;\n    this.setMainCanvasSize();\n  }\n\n  private mode: MarkerAreaMode = 'select';\n\n  private _logoUI?: HTMLElement;\n\n  private _isInitialized = false;\n\n  private _currentMarkerEditor?: MarkerBaseEditor;\n  /**\n   * Returns the currently active marker editor.\n   */\n  public get currentMarkerEditor(): MarkerBaseEditor | undefined {\n    return this._currentMarkerEditor;\n  }\n  private _selectedMarkerEditors: MarkerBaseEditor[] = [];\n  /**\n   * Returns the currently selected marker editors.\n   */\n  public get selectedMarkerEditors(): MarkerBaseEditor[] {\n    return this._selectedMarkerEditors;\n  }\n\n  private _newMarkerOutline: SVGPathElement = SvgHelper.createPath('', [\n    ['stroke', '#333'],\n    ['stroke-width', '0.5'],\n    ['stroke-dasharray', '2 5'],\n    ['fill', 'rgba(200,200,200,0.5)'],\n    ['pointer-events', 'none'],\n  ]);\n\n  private _targetImageLoaded = false;\n  private _targetImage: HTMLImageElement | undefined;\n  /**\n   * Returns the target image.\n   */\n  public get targetImage(): HTMLImageElement | undefined {\n    return this._targetImage;\n  }\n  /**\n   * Sets the target image.\n   */\n  public set targetImage(value: HTMLImageElement | undefined) {\n    this._targetImage = value;\n    this._targetImageLoaded = false;\n    if (value !== undefined) {\n      this.addTargetImage();\n    }\n  }\n\n  /**\n   * The collection of available marker editor types.\n   */\n  public markerEditors: Map<\n    typeof MarkerBase,\n    typeof MarkerBaseEditor<MarkerBase>\n  > = new Map();\n\n  /**\n   * The collection of marker editors in the annotation.\n   */\n  public editors: MarkerBaseEditor[] = [];\n\n  private _zoomLevel = 1;\n  /**\n   * Returns the current zoom level.\n   */\n  public get zoomLevel(): number {\n    return this._zoomLevel;\n  }\n  /**\n   * Sets the current zoom level.\n   */\n  public set zoomLevel(value: number) {\n    this._zoomLevel = value;\n    if (\n      this._canvasContainer &&\n      this._contentContainer &&\n      this._mainCanvas &&\n      this._overlayContainer\n    ) {\n      // this.setMainCanvasSize();\n      this._mainCanvas.style.transform = `scale(${this._zoomLevel})`;\n      this.setEditingTargetSize();\n\n      const scrollMultiplier = Math.max(this._zoomLevel, 1);\n      this._canvasContainer.scrollTo({\n        left:\n          (this._mainCanvas.clientWidth * scrollMultiplier -\n            this._canvasContainer.clientWidth) /\n          2,\n        top:\n          (this._mainCanvas.clientHeight * scrollMultiplier -\n            this._canvasContainer.clientHeight) /\n          2,\n      });\n\n      this._overlayContainer.style.transform = `scale(${this._zoomLevel})`;\n    }\n  }\n\n  private prevPanPoint: IPoint = { x: 0, y: 0 };\n  private panTo(point: IPoint) {\n    this._canvasContainer?.scrollBy({\n      left: this.prevPanPoint.x - point.x,\n      top: this.prevPanPoint.y - point.y,\n    });\n    this.prevPanPoint = point;\n  }\n\n  private undoRedoManager = new UndoRedoManager<AnnotationState>();\n\n  private _defaultFilter?: string;\n  /**\n   * Returns the default SVG filter for the created markers.\n   *\n   * @since 3.2.0\n   */\n  public get defaultFilter(): string | undefined {\n    return this._defaultFilter;\n  }\n  /**\n   * Sets the default SVG filter for the created markers.\n   *\n   * @remarks\n   * The filter should be a valid SVG filter string.\n   *\n   * In Chromium-based browsers and Firefox, you can use CSS filter strings\n   *  e.g. \"drop-shadow(2px 2px 2px black)\". Unfortunately, at the time of\n   * the implementation this doesn't work in Safari (meaning any browser on iOS as well).\n   *\n   * For cross-browser compatibility, version 3.3 introduces a set of default filters.\n   * These are dropShadow, outline, and glow. You can use them by setting the defaultFilter\n   * to \"url(#dropShadow)\", \"url(#outline)\", or \"url(#glow)\" respectively.\n   *\n   * @since 3.2.0\n   */\n  public set defaultFilter(value: string | undefined) {\n    this._defaultFilter = value;\n  }\n\n  private _defsElement?: SVGDefsElement;\n  private _defs: (string | Node)[] = [];\n\n  constructor() {\n    super();\n\n    this.markerEditors.set(FrameMarker, ShapeOutlineMarkerEditor<FrameMarker>);\n    this.markerEditors.set(\n      EllipseFrameMarker,\n      ShapeOutlineMarkerEditor<FrameMarker>,\n    );\n    this.markerEditors.set(LineMarker, LinearMarkerEditor<LineMarker>);\n    this.markerEditors.set(PolygonMarker, PolygonMarkerEditor<PolygonMarker>);\n    this.markerEditors.set(\n      FreehandMarker,\n      FreehandMarkerEditor<FreehandMarker>,\n    );\n    this.markerEditors.set(TextMarker, TextMarkerEditor<TextMarker>);\n    this.markerEditors.set(CoverMarker, ShapeMarkerEditor<CoverMarker>);\n    this.markerEditors.set(HighlightMarker, ShapeMarkerEditor<HighlightMarker>);\n    this.markerEditors.set(EllipseMarker, ShapeMarkerEditor<EllipseMarker>);\n    this.markerEditors.set(ArrowMarker, ArrowMarkerEditor<ArrowMarker>);\n    this.markerEditors.set(\n      MeasurementMarker,\n      LinearMarkerEditor<MeasurementMarker>,\n    );\n    this.markerEditors.set(CalloutMarker, CalloutMarkerEditor<CalloutMarker>);\n    this.markerEditors.set(\n      CustomImageMarker,\n      ImageMarkerEditor<CustomImageMarker>,\n    );\n    this.markerEditors.set(\n      CheckImageMarker,\n      ImageMarkerEditor<CheckImageMarker>,\n    );\n    this.markerEditors.set(XImageMarker, ImageMarkerEditor<CheckImageMarker>);\n    this.markerEditors.set(\n      CaptionFrameMarker,\n      CaptionFrameMarkerEditor<CaptionFrameMarker>,\n    );\n    this.markerEditors.set(CurveMarker, CurveMarkerEditor<CurveMarker>);\n    this.markerEditors.set(\n      HighlighterMarker,\n      FreehandMarkerEditor<HighlighterMarker>,\n    );\n\n    this.connectedCallback = this.connectedCallback.bind(this);\n    this.disconnectedCallback = this.disconnectedCallback.bind(this);\n\n    this.createLayout = this.createLayout.bind(this);\n    this.addMainCanvas = this.addMainCanvas.bind(this);\n    this.setMainCanvasSize = this.setMainCanvasSize.bind(this);\n    this.setEditingTargetSize = this.setEditingTargetSize.bind(this);\n    this.initOverlay = this.initOverlay.bind(this);\n    this.addTargetImage = this.addTargetImage.bind(this);\n\n    this.attachEvents = this.attachEvents.bind(this);\n    this.attachWindowEvents = this.attachWindowEvents.bind(this);\n    this.detachEvents = this.detachEvents.bind(this);\n    this.detachWindowEvents = this.detachWindowEvents.bind(this);\n\n    this.onCanvasPointerDown = this.onCanvasPointerDown.bind(this);\n    this.onCanvasDblClick = this.onCanvasDblClick.bind(this);\n    this.onKeyUp = this.onKeyUp.bind(this);\n    this.onPointerMove = this.onPointerMove.bind(this);\n    this.onPointerOut = this.onPointerOut.bind(this);\n    this.onPointerUp = this.onPointerUp.bind(this);\n\n    this.createMarker = this.createMarker.bind(this);\n    this.addNewMarker = this.addNewMarker.bind(this);\n    this.markerCreated = this.markerCreated.bind(this);\n    this.markerStateChanged = this.markerStateChanged.bind(this);\n    this.deleteMarker = this.deleteMarker.bind(this);\n    this.deleteSelectedMarkers = this.deleteSelectedMarkers.bind(this);\n\n    this.switchToSelectMode = this.switchToSelectMode.bind(this);\n\n    this.showOutline = this.showOutline.bind(this);\n    this.hideOutline = this.hideOutline.bind(this);\n\n    this.getState = this.getState.bind(this);\n    this.restoreState = this.restoreState.bind(this);\n\n    this.undo = this.undo.bind(this);\n    this.addUndoStep = this.addUndoStep.bind(this);\n    this.undoStep = this.undoStep.bind(this);\n    this.redo = this.redo.bind(this);\n    this.redoStep = this.redoStep.bind(this);\n\n    this.toggleLogo = this.toggleLogo.bind(this);\n    this.addLogo = this.addLogo.bind(this);\n    this.removeLogo = this.removeLogo.bind(this);\n\n    this.adjustMarqueeSelectOutline =\n      this.adjustMarqueeSelectOutline.bind(this);\n    this.hideMarqueeSelectOutline = this.hideMarqueeSelectOutline.bind(this);\n\n    this.addDefs = this.addDefs.bind(this);\n    this.addDefaultFilterDefs = this.addDefaultFilterDefs.bind(this);\n\n    this.attachShadow({ mode: 'open' });\n  }\n\n  private connectedCallback() {\n    this.dispatchEvent(\n      new CustomEvent<MarkerAreaEventData>('areainit', {\n        detail: { markerArea: this },\n      }),\n    );\n    Activator.addKeyAddListener(this.toggleLogo);\n    this.createLayout();\n    this.addMainCanvas();\n    this.initOverlay();\n    this.attachEvents();\n    this._isInitialized = true;\n    if (this.targetImage !== undefined) {\n      this.addTargetImage();\n    }\n    this.setMainCanvasSize();\n    this.addDefaultFilterDefs();\n    this.toggleLogo();\n    this.addUndoStep();\n    this.dispatchEvent(\n      new CustomEvent<MarkerAreaEventData>('areashow', {\n        detail: { markerArea: this },\n      }),\n    );\n  }\n\n  private disconnectedCallback() {\n    this.detachEvents();\n  }\n\n  private createLayout() {\n    this.style.display = 'flex';\n    this.style.width = this.style.width !== '' ? this.style.width : '100%';\n    this.style.height = this.style.height !== '' ? this.style.height : '100%';\n    this.style.position = 'relative';\n\n    this._contentContainer = document.createElement('div');\n    this._contentContainer.style.display = 'flex';\n    this._contentContainer.style.position = 'relative';\n    this._contentContainer.style.flexGrow = '2';\n    this._contentContainer.style.flexShrink = '1';\n    this._contentContainer.style.overflow = 'hidden';\n\n    this._canvasContainer = document.createElement('div');\n    this._canvasContainer.style.touchAction = 'pinch-zoom';\n    this._canvasContainer.className = 'canvas-container';\n    this._canvasContainer.style.display = 'grid';\n    this._canvasContainer.style.gridTemplateColumns = '1fr';\n    this._canvasContainer.style.flexGrow = '2';\n    this._canvasContainer.style.flexShrink = '2';\n    this._canvasContainer.style.justifyItems = 'center';\n    this._canvasContainer.style.alignItems = 'center';\n    this._canvasContainer.style.overflow = 'auto';\n    this._canvasContainer.style.userSelect = 'none';\n\n    this._contentContainer.appendChild(this._canvasContainer);\n\n    this.shadowRoot?.appendChild(this._contentContainer);\n  }\n\n  private addMainCanvas() {\n    this.width = this._contentContainer?.clientWidth || 0;\n    this.height = this._contentContainer?.clientHeight || 0;\n\n    this._mainCanvas = document.createElementNS(\n      'http://www.w3.org/2000/svg',\n      'svg',\n    );\n    this._mainCanvas.setAttribute('xmlns', 'http://www.w3.org/2000/svg');\n    this.setMainCanvasSize();\n    this._mainCanvas.style.gridColumnStart = '1';\n    this._mainCanvas.style.gridRowStart = '1';\n    this._mainCanvas.style.pointerEvents = 'auto';\n    // this._mainCanvas.style.backgroundColor = 'pink'; // @todo\n    // this._mainCanvas.style.opacity = '0.3'; // @todo\n    this._mainCanvas.style.margin = '10px';\n    this._mainCanvas.style.transform = `scale(${this._zoomLevel})`;\n\n    this.addDefsToMainCanvas();\n\n    this._groupLayer = SvgHelper.createGroup();\n\n    this._mainCanvas.appendChild(this._groupLayer);\n\n    this._canvasContainer?.appendChild(this._mainCanvas);\n  }\n\n  private addDefsToMainCanvas() {\n    this._defsElement = SvgHelper.createDefs();\n    this._mainCanvas?.appendChild(this._defsElement);\n    this._defsElement.append(...this._defs);\n  }\n\n  private setMainCanvasSize() {\n    if (\n      this._mainCanvas !== undefined &&\n      this._targetHeight > 0 &&\n      this._targetWidth > 0\n    ) {\n      this._mainCanvas.style.width = `${this._targetWidth * this.zoomLevel}px`;\n      this._mainCanvas.style.height = `${\n        this._targetHeight * this.zoomLevel\n      }px`;\n      this._mainCanvas.setAttribute(\n        'width',\n        `${this._targetWidth * this.zoomLevel}`,\n      );\n      this._mainCanvas.setAttribute(\n        'height',\n        `${this._targetHeight * this.zoomLevel}`,\n      );\n      this._mainCanvas.setAttribute(\n        'viewBox',\n        '0 0 ' +\n          this._targetWidth.toString() +\n          ' ' +\n          this._targetHeight.toString(),\n      );\n      this.setEditingTargetSize();\n    }\n  }\n\n  private setEditingTargetSize() {\n    if (this._editingTarget !== undefined) {\n      this._editingTarget.width = this._targetWidth * this.zoomLevel;\n      this._editingTarget.height = this._targetHeight * this.zoomLevel;\n      this._editingTarget.style.width = `${\n        this._targetWidth * this.zoomLevel\n      }px`;\n      this._editingTarget.style.height = `${\n        this._targetHeight * this.zoomLevel\n      }px`;\n    }\n  }\n\n  private initOverlay(): void {\n    this._overlayContainer = document.createElement('div');\n    this._overlayContainer.style.pointerEvents = 'none';\n    this._overlayContainer.style.display = 'flex';\n    this._overlayContainer.style.alignItems = 'center';\n    this._overlayContainer.style.justifyContent = 'center';\n    this._overlayContainer.style.gridRowStart = '1';\n    this._overlayContainer.style.gridColumnStart = '1';\n\n    this._canvasContainer?.appendChild(this._overlayContainer);\n\n    this._overlayContentContainer = document.createElement('div');\n    this._overlayContentContainer.style.position = 'relative';\n    // @todo\n    // this._overlayContentContainer.style.width = `${this.documentWidth}px`;\n    // this._overlayContentContainer.style.height = `${this.documentHeight}px`;\n    this._overlayContentContainer.style.display = 'flex';\n    this._overlayContainer.appendChild(this._overlayContentContainer);\n  }\n\n  private addTargetImage() {\n    if (\n      this._isInitialized &&\n      this._editingTarget === undefined &&\n      this.targetImage !== undefined &&\n      this._canvasContainer !== undefined &&\n      this._mainCanvas !== undefined\n    ) {\n      this._editingTarget = document.createElement('img');\n\n      this._targetWidth =\n        this._targetWidth > 0\n          ? this._targetWidth\n          : this.targetImage.clientWidth;\n      this._targetHeight =\n        this._targetHeight > 0\n          ? this._targetHeight\n          : this.targetImage.clientHeight;\n\n      this._editingTarget.addEventListener('load', (ev) => {\n        if (this._editingTarget !== undefined) {\n          if (this._targetHeight <= 0 || this._targetWidth <= 0) {\n            const img = <HTMLImageElement>ev.target;\n\n            const aspectRatio = img.naturalWidth / img.naturalHeight;\n            const calculatedWidth =\n              this._targetWidth > 0\n                ? this._targetWidth\n                : this._targetHeight > 0\n                ? this._targetHeight * aspectRatio\n                : img.clientWidth > 0\n                ? img.clientWidth\n                : img.naturalWidth;\n            const calculatedHeight =\n              this._targetHeight > 0\n                ? this._targetHeight\n                : this._targetWidth > 0\n                ? this._targetWidth / aspectRatio\n                : img.clientHeight > 0\n                ? img.clientHeight\n                : img.naturalHeight;\n\n            this._targetWidth = calculatedWidth;\n            this._targetHeight = calculatedHeight;\n          }\n          this._editingTarget.width = this._targetWidth;\n          this._editingTarget.height = this._targetHeight;\n          this._editingTarget.style.width = `${this._targetWidth}px`;\n          this._editingTarget.style.height = `${this._targetHeight}px`;\n          this._editingTarget.style.gridColumnStart = '1';\n          this._editingTarget.style.gridRowStart = '1';\n\n          this.setMainCanvasSize();\n\n          this._targetImageLoaded = true;\n          if (this._stateToRestore !== undefined) {\n            this.restoreState(this._stateToRestore);\n          }\n        }\n\n        // reset zoom to scroll to center if needed\n        this.zoomLevel = this._zoomLevel;\n      });\n      this._editingTarget.src = this.targetImage.src;\n\n      this._canvasContainer.insertBefore(this._editingTarget, this._mainCanvas);\n    }\n  }\n\n  private addDefaultFilterDefs() {\n    this.addDefs(...SvgFilters.getDefaultFilterSet());\n  }\n\n  /**\n   * Registers a marker type and its editor to be available in the marker area.\n   * @param markerType\n   * @param editorType\n   */\n  public registerMarkerType(\n    markerType: typeof MarkerBase,\n    editorType: typeof MarkerBaseEditor<MarkerBase>,\n  ) {\n    this.markerEditors.set(markerType, editorType);\n  }\n\n  /**\n   * Creates a new marker of the specified type.\n   * @param markerType\n   * @returns\n   */\n  public createMarker(markerType: typeof MarkerBase | string) {\n    let mType: typeof MarkerBase = FrameMarker;\n    if (typeof markerType === 'string') {\n      mType = this.getMarkerTypeByName(markerType) || FrameMarker;\n    } else {\n      mType = markerType;\n    }\n    const markerEditor = this.markerEditors.get(mType);\n    if (markerEditor && this._mainCanvas) {\n      this.setCurrentEditor();\n      this.deselectEditor();\n      this.addUndoStep();\n      this._currentMarkerEditor = this.addNewMarker(markerEditor, mType);\n      this._currentMarkerEditor.onMarkerCreated = this.markerCreated;\n      this._currentMarkerEditor.onStateChanged = this.markerStateChanged;\n\n      switch (this._currentMarkerEditor.creationStyle) {\n        case 'drop':\n          this._mainCanvas.style.cursor = 'move';\n          break;\n        case 'draw':\n        default:\n          this._mainCanvas.style.cursor = 'crosshair';\n          break;\n      }\n\n      this.dispatchEvent(\n        new CustomEvent<MarkerEditorEventData>('markercreating', {\n          detail: {\n            markerArea: this,\n            markerEditor: this._currentMarkerEditor,\n          },\n        }),\n      );\n    }\n\n    return this._currentMarkerEditor;\n  }\n\n  private addNewMarker(\n    markerEditorType: typeof MarkerBaseEditor<MarkerBase>,\n    markerType: typeof MarkerBase,\n  ): MarkerBaseEditor {\n    if (this._mainCanvas === undefined) {\n      throw new Error('Main canvas is not initialized.');\n    }\n\n    const g = SvgHelper.createGroup();\n    if (this.defaultFilter && markerType.applyDefaultFilter) {\n      g.setAttribute('filter', this.defaultFilter);\n    }\n    this._mainCanvas.appendChild(g);\n\n    return new markerEditorType({\n      container: g,\n      overlayContainer: this._overlayContentContainer,\n      markerType: markerType,\n    });\n  }\n\n  private markerCreated(editor: MarkerBaseEditor<MarkerBase>) {\n    if (this._mainCanvas) {\n      this.mode = 'select';\n      this._mainCanvas.style.cursor = 'default';\n      this.editors.push(editor);\n      this.setCurrentEditor(editor);\n      if (editor.continuousCreation) {\n        const newMarkerEditor = this.createMarker(editor.marker.typeName);\n        if (\n          editor.is(FreehandMarkerEditor) &&\n          newMarkerEditor?.is(FreehandMarkerEditor)\n        ) {\n          newMarkerEditor.strokeColor = editor.strokeColor;\n          newMarkerEditor.strokeWidth = editor.strokeWidth;\n          newMarkerEditor.strokeDasharray = editor.strokeDasharray;\n        }\n      }\n      this.addUndoStep();\n      this.dispatchEvent(\n        new CustomEvent<MarkerEditorEventData>('markercreate', {\n          detail: { markerArea: this, markerEditor: editor },\n        }),\n      );\n    }\n  }\n\n  private markerStateChanged(markerEditor: MarkerBaseEditor): void {\n    this.addUndoStep();\n    this.dispatchEvent(\n      new CustomEvent<MarkerEditorEventData>('markerchange', {\n        detail: { markerArea: this, markerEditor: markerEditor },\n      }),\n    );\n  }\n\n  /**\n   * Deletes a marker represented by the specified editor.\n   * @param markerEditor\n   */\n  public deleteMarker(markerEditor: MarkerBaseEditor): void {\n    if (this.editors.indexOf(markerEditor) >= 0) {\n      this.addUndoStep();\n      this.dispatchEvent(\n        new CustomEvent<MarkerEditorEventData>('markerbeforedelete', {\n          detail: { markerArea: this, markerEditor: markerEditor },\n        }),\n      );\n      this._mainCanvas?.removeChild(markerEditor.container);\n      markerEditor.dispose();\n      this.editors.splice(this.editors.indexOf(markerEditor), 1);\n      this._selectedMarkerEditors.splice(\n        this._selectedMarkerEditors.indexOf(markerEditor),\n        1,\n      );\n      this.dispatchEvent(\n        new CustomEvent<MarkerEditorEventData>('markerdelete', {\n          detail: { markerArea: this, markerEditor: markerEditor },\n        }),\n      );\n    }\n  }\n\n  /**\n   * Deselects all markers.\n   */\n  public deleteSelectedMarkers() {\n    const markersToDelete = [...this._selectedMarkerEditors];\n    // this._selectedMarkerEditors.splice(0);\n    markersToDelete.forEach((m) => this.deleteMarker(m));\n    this.hideMarqueeSelectOutline();\n  }\n\n  /**\n   * Sets the current editor and selects it.\n   *\n   * If `editor` is not supplied the current editor is unselected.\n   *\n   * @param editor\n   */\n  public setCurrentEditor(editor?: MarkerBaseEditor): void {\n    if (this._currentMarkerEditor !== editor) {\n      // no need to deselect if not changed\n      if (this._currentMarkerEditor !== undefined) {\n        this.deselectEditor(this._currentMarkerEditor);\n      }\n    }\n    this._currentMarkerEditor = editor;\n    if (\n      this._currentMarkerEditor !== undefined &&\n      !this._currentMarkerEditor.isSelected\n    ) {\n      if (this._currentMarkerEditor.state !== 'new') {\n        this.selectEditor(this._currentMarkerEditor);\n        this._currentMarkerEditor.select(false);\n      }\n    }\n  }\n\n  /**\n   * Selects the specified editor without setting it as the current editor.\n   * @param editor\n   */\n  public selectEditor(editor: MarkerBaseEditor): void {\n    if (this._selectedMarkerEditors.indexOf(editor) < 0) {\n      if (this._selectedMarkerEditors.length > 0) {\n        this._selectedMarkerEditors[0].select(true);\n      }\n      this._selectedMarkerEditors.push(editor);\n      editor.select(true);\n\n      this.dispatchEvent(\n        new CustomEvent<MarkerEditorEventData>('markerselect', {\n          detail: { markerArea: this, markerEditor: editor },\n        }),\n      );\n    }\n  }\n\n  /**\n   * Deselects the specified editor (or all editors if not specified).\n   * @param editor\n   */\n  public deselectEditor(editor?: MarkerBaseEditor): void {\n    const selectedCountOnEntry = this._selectedMarkerEditors.length;\n\n    // workaround for the polygon marker getting stuck in \"creating\" state\n    // when user switches to something else before finishing the polygon\n    if (editor && editor.state === 'creating') {\n      editor.deselect();\n    }\n\n    if (selectedCountOnEntry > 0) {\n      const eventEditor =\n        editor ??\n        this._selectedMarkerEditors[this._selectedMarkerEditors.length - 1];\n\n      if (editor === undefined) {\n        this._selectedMarkerEditors.forEach((m) => m.deselect());\n        this._selectedMarkerEditors.splice(0);\n      } else {\n        const index = this._selectedMarkerEditors.indexOf(editor);\n        if (index >= 0) {\n          this._selectedMarkerEditors.splice(index, 1);\n          editor.deselect();\n        }\n      }\n\n      this.dispatchEvent(\n        new CustomEvent<MarkerEditorEventData>('markerdeselect', {\n          detail: { markerArea: this, markerEditor: eventEditor },\n        }),\n      );\n    }\n  }\n\n  private touchPoints = 0;\n  private leadPointerId?: number;\n  private isDragging = false;\n  private isSelecting = false;\n  private isPanning = false;\n\n  private _marqueeSelectOutline: SVGRectElement = SvgHelper.createRect(0, 0, [\n    ['stroke', 'rgb(35, 35, 255)'],\n    ['stroke-width', '1'],\n    ['fill', 'rgba(129, 129, 255, 0.3)'],\n    ['pointer-events', 'none'],\n    ['cursor', 'move'],\n  ]);\n  private _marqueeSelectRect = new DOMRect(0, 0, 0, 0);\n\n  private _manipulationStartX = 0;\n  private _manipulationStartY = 0;\n\n  private onCanvasPointerDown(ev: PointerEvent) {\n    // @todo ?\n    // if (!this._isFocused) {\n    //   this.focus();\n    // }\n\n    this._manipulationStartX = ev.clientX;\n    this._manipulationStartY = ev.clientY;\n\n    this.touchPoints++;\n    if (this.touchPoints === 1) {\n      this.leadPointerId = ev.pointerId;\n    }\n\n    if (\n      (ev.pointerType === 'touch' && this.touchPoints === 1) ||\n      (ev.pointerType !== 'touch' && ev.button === 0 && !ev.altKey)\n    ) {\n      if (\n        this._currentMarkerEditor !== undefined &&\n        (this._currentMarkerEditor.state === 'new' ||\n          this._currentMarkerEditor.state === 'creating')\n      ) {\n        this.isDragging = true;\n        this._currentMarkerEditor.pointerDown(\n          SvgHelper.clientToLocalCoordinates(\n            this._mainCanvas,\n            ev.clientX,\n            ev.clientY,\n            this.zoomLevel,\n          ),\n          ev.target ?? undefined,\n          ev,\n        );\n      } else if (this.mode === 'select') {\n        const localPoint = SvgHelper.clientToLocalCoordinates(\n          this._mainCanvas,\n          ev.clientX,\n          ev.clientY,\n          this.zoomLevel,\n        );\n        const hitMarker = this.editors.find((m) => m.ownsTarget(ev.target));\n        if (hitMarker !== undefined) {\n          this.isDragging = true;\n          if (ev.shiftKey) {\n            this.selectEditor(hitMarker);\n            this.initializeMarqueeSelection(localPoint);\n          } else if (!hitMarker.isSelected) {\n            this.deselectEditor();\n            this.setCurrentEditor(hitMarker);\n          }\n          this._selectedMarkerEditors.forEach((m) =>\n            m.pointerDown(localPoint, ev.target ?? undefined, ev),\n          );\n        } else if (\n          ev.target === this._marqueeSelectOutline &&\n          this._selectedMarkerEditors.length > 1\n        ) {\n          this.isDragging = true;\n          this._selectedMarkerEditors.forEach((m) =>\n            m.pointerDown(localPoint, ev.target ?? undefined, ev),\n          );\n        } else {\n          this.setCurrentEditor();\n          this.deselectEditor();\n          this.isSelecting = true;\n          this.isDragging = true;\n\n          // marquee select\n          this.initializeMarqueeSelection(localPoint);\n\n          this.prevPanPoint = { x: ev.clientX, y: ev.clientY };\n        }\n      }\n    } else if (\n      (ev.pointerType !== 'touch' &&\n        ((ev.button === 0 && ev.altKey) || ev.button === 1)) || // left button + alt or middle button\n      (ev.pointerType === 'touch' &&\n        this.touchPoints === 2 &&\n        ev.pointerId === this.leadPointerId)\n    ) {\n      this.isDragging = true;\n      this.isPanning = true;\n      this.prevPanPoint = { x: ev.clientX, y: ev.clientY };\n\n      if (this._mainCanvas) {\n        this._mainCanvas.style.cursor = 'grabbing';\n      }\n    }\n  }\n\n  private initializeMarqueeSelection(localPoint: IPoint) {\n    this._marqueeSelectRect.x = localPoint.x;\n    this._marqueeSelectRect.y = localPoint.y;\n    this._marqueeSelectRect.width = 0;\n    this._marqueeSelectRect.height = 0;\n    SvgHelper.setAttributes(this._marqueeSelectOutline, [\n      ['x', localPoint.x.toString()],\n      ['y', localPoint.y.toString()],\n      ['width', '0'],\n      ['height', '0'],\n    ]);\n    if (\n      this._groupLayer &&\n      !this._groupLayer.contains(this._marqueeSelectOutline)\n    ) {\n      this._groupLayer.appendChild(this._marqueeSelectOutline);\n    }\n  }\n\n  private onCanvasDblClick(ev: MouseEvent) {\n    // @todo ?\n    // if (!this._isFocused) {\n    //   this.focus();\n    // }\n\n    if (this.mode === 'select') {\n      const hitMarker = this.editors.find((m) => m.ownsTarget(ev.target));\n      if (hitMarker !== undefined && hitMarker !== this._currentMarkerEditor) {\n        this.setCurrentEditor(hitMarker);\n      }\n      if (this._currentMarkerEditor !== undefined) {\n        this._currentMarkerEditor.dblClick(\n          SvgHelper.clientToLocalCoordinates(\n            this._mainCanvas,\n            ev.clientX,\n            ev.clientY,\n            this.zoomLevel,\n          ),\n          ev.target ?? undefined,\n          ev,\n        );\n      } else {\n        this.setCurrentEditor();\n      }\n    }\n  }\n\n  private onPointerMove(ev: PointerEvent) {\n    if (\n      (ev.pointerType === 'touch' && this.touchPoints === 1) ||\n      (ev.pointerType !== 'touch' && this.isDragging && !ev.altKey)\n    ) {\n      const localPoint = SvgHelper.clientToLocalCoordinates(\n        this._mainCanvas,\n        ev.clientX,\n        ev.clientY,\n        this.zoomLevel,\n      );\n\n      if (\n        this._currentMarkerEditor !== undefined ||\n        this._selectedMarkerEditors.length > 0\n      ) {\n        // don't swallow the event when editing text markers\n        if (\n          this._currentMarkerEditor === undefined ||\n          this._currentMarkerEditor.state !== 'edit'\n        ) {\n          ev.preventDefault();\n        }\n\n        if (\n          this._currentMarkerEditor !== undefined ||\n          this._selectedMarkerEditors.length > 0\n        ) {\n          this.showOutline(localPoint);\n\n          if (this._selectedMarkerEditors.length > 0) {\n            this._selectedMarkerEditors.forEach((m) =>\n              m.manipulate(localPoint, ev),\n            );\n          } else {\n            this._currentMarkerEditor?.manipulate(localPoint, ev);\n          }\n        } else if (this.zoomLevel > 1) {\n          this.panTo({ x: ev.clientX, y: ev.clientY });\n        }\n\n        this.adjustMarqueeSelectOutline();\n      } else if (this.isSelecting) {\n        // adjust marquee\n        const localManipulationStart = SvgHelper.clientToLocalCoordinates(\n          this._mainCanvas,\n          this._manipulationStartX,\n          this._manipulationStartY,\n          this.zoomLevel,\n        );\n\n        this._marqueeSelectRect.x = Math.min(\n          localPoint.x,\n          localManipulationStart.x,\n        );\n        this._marqueeSelectRect.y = Math.min(\n          localPoint.y,\n          localManipulationStart.y,\n        );\n        this._marqueeSelectRect.width =\n          Math.abs(ev.clientX - this._manipulationStartX) / this.zoomLevel;\n        this._marqueeSelectRect.height =\n          Math.abs(ev.clientY - this._manipulationStartY) / this.zoomLevel;\n\n        SvgHelper.setAttributes(this._marqueeSelectOutline, [\n          ['x', `${this._marqueeSelectRect.x}`],\n          ['y', `${this._marqueeSelectRect.y}`],\n          ['width', `${this._marqueeSelectRect.width}`],\n          ['height', `${this._marqueeSelectRect.height}`],\n        ]);\n      }\n    } else if (\n      (ev.pointerType !== 'touch' && this.isPanning) ||\n      (ev.pointerType === 'touch' &&\n        this.touchPoints === 2 &&\n        ev.pointerId === this.leadPointerId)\n    ) {\n      this.panTo({ x: ev.clientX, y: ev.clientY });\n    }\n  }\n\n  private showOutline(localPoint: IPoint) {\n    if (\n      this._currentMarkerEditor &&\n      this._currentMarkerEditor.creationStyle === 'drop' &&\n      this._currentMarkerEditor.state === 'new'\n    ) {\n      if (\n        this._mainCanvas !== undefined &&\n        !this._mainCanvas.contains(this._newMarkerOutline)\n      ) {\n        this._mainCanvas.appendChild(this._newMarkerOutline);\n      }\n      const size = this._currentMarkerEditor.marker.defaultSize;\n      SvgHelper.setAttributes(this._newMarkerOutline, [\n        ['d', this._currentMarkerEditor.marker.getOutline()],\n      ]);\n      this._newMarkerOutline.style.transform = `translate(${\n        localPoint.x - size.width / 2\n      }px, ${localPoint.y - size.height / 2}px)`;\n    }\n  }\n\n  private hideOutline() {\n    if (this._mainCanvas?.contains(this._newMarkerOutline)) {\n      this._mainCanvas.removeChild(this._newMarkerOutline);\n    }\n  }\n\n  private onPointerUp(ev: PointerEvent) {\n    if (this.touchPoints > 0) {\n      this.touchPoints--;\n      if (this.touchPoints === 0) {\n        this.leadPointerId = undefined;\n      }\n    }\n    if (this.touchPoints === 0) {\n      if (\n        this.isDragging &&\n        (this._currentMarkerEditor !== undefined ||\n          this._selectedMarkerEditors.length > 0)\n      ) {\n        const localPoint = SvgHelper.clientToLocalCoordinates(\n          this._mainCanvas,\n          ev.clientX,\n          ev.clientY,\n          this.zoomLevel,\n        );\n\n        if (this._selectedMarkerEditors.length > 1) {\n          this._selectedMarkerEditors.forEach((m) =>\n            m.pointerUp(localPoint, ev),\n          );\n          this.adjustMarqueeSelectOutline();\n        } else {\n          this._currentMarkerEditor?.pointerUp(localPoint, ev);\n        }\n\n        this.hideOutline();\n\n        this.addUndoStep();\n      } else if (this.isSelecting) {\n        // finish marquee selection\n        this.finishMarqueeSelection();\n        if (this._selectedMarkerEditors.length < 2) {\n          this.hideMarqueeSelectOutline();\n          if (this._selectedMarkerEditors.length === 1) {\n            // revert to single selection\n            const onlySelected = this._selectedMarkerEditors[0];\n            this.deselectEditor();\n            this.setCurrentEditor(onlySelected);\n          }\n        }\n      }\n    }\n    this.isDragging = false;\n    this.isSelecting = false;\n    this.isPanning = false;\n    if (this._mainCanvas) {\n      this._mainCanvas.style.cursor = 'default';\n    }\n  }\n\n  private finishMarqueeSelection() {\n    this.deselectEditor();\n\n    this.editors.forEach((m) => {\n      const markerRect = m.marker.getBBox();\n      if (\n        markerRect.x <\n          this._marqueeSelectRect.x + this._marqueeSelectRect.width &&\n        markerRect.x + markerRect.width > this._marqueeSelectRect.x &&\n        markerRect.y <\n          this._marqueeSelectRect.y + this._marqueeSelectRect.height &&\n        markerRect.y + markerRect.height > this._marqueeSelectRect.y\n      ) {\n        this.selectEditor(m);\n      }\n    });\n\n    this.adjustMarqueeSelectOutline();\n  }\n\n  private adjustMarqueeSelectOutline() {\n    let x = Number.MAX_VALUE;\n    let y = Number.MAX_VALUE;\n    let width = 0;\n    let height = 0;\n\n    this._selectedMarkerEditors.forEach((m) => {\n      const markerRect = m.marker.getBBox();\n\n      x = Math.min(x, markerRect.x);\n      y = Math.min(y, markerRect.y);\n      width = Math.max(width, markerRect.x + markerRect.width);\n      height = Math.max(height, markerRect.y + markerRect.height);\n    });\n\n    if (this._selectedMarkerEditors.length > 1) {\n      this._marqueeSelectRect.x = x;\n      this._marqueeSelectRect.y = y;\n      this._marqueeSelectRect.width = width - x;\n      this._marqueeSelectRect.height = height - y;\n\n      SvgHelper.setAttributes(this._marqueeSelectOutline, [\n        ['x', `${this._marqueeSelectRect.x}`],\n        ['y', `${this._marqueeSelectRect.y}`],\n        ['width', `${this._marqueeSelectRect.width}`],\n        ['height', `${this._marqueeSelectRect.height}`],\n        ['pointer-events', ''],\n      ]);\n    } else {\n      this.hideMarqueeSelectOutline();\n    }\n  }\n\n  private hideMarqueeSelectOutline() {\n    if (\n      this._groupLayer &&\n      this._groupLayer.contains(this._marqueeSelectOutline)\n    ) {\n      this._groupLayer.removeChild(this._marqueeSelectOutline);\n    }\n  }\n\n  private onPointerOut(/*ev: PointerEvent*/) {\n    if (this.touchPoints > 0) {\n      this.touchPoints--;\n    }\n    this.hideOutline();\n  }\n\n  private onKeyUp(ev: KeyboardEvent) {\n    if (\n      this._currentMarkerEditor !== undefined &&\n      (ev.key === 'Delete' || ev.key === 'Backspace')\n    ) {\n      // @todo\n      // this.deleteSelectedMarker();\n    }\n  }\n\n  private attachEvents() {\n    // needed to distinguish when the element is in focus (active)\n    if (!this.hasAttribute('tabindex')) {\n      this.setAttribute('tabindex', '0');\n    }\n\n    // @todo\n    // this.setupResizeObserver();\n    this._mainCanvas?.addEventListener('pointerdown', this.onCanvasPointerDown);\n    // workaround to prevent a bug with Apple Pencil\n    // https://bugs.webkit.org/show_bug.cgi?id=217430\n    this._mainCanvas?.addEventListener('touchmove', (ev) =>\n      ev.preventDefault(),\n    );\n    this._mainCanvas?.addEventListener('dblclick', this.onCanvasDblClick);\n\n    this._marqueeSelectOutline.addEventListener('dblclick', (ev) => {\n      ev.preventDefault();\n      ev.stopPropagation();\n      this.deselectEditor();\n      this.hideMarqueeSelectOutline();\n    });\n\n    // @todo - using these in Diagrams but not in mjs2 - why?\n    // this._mainCanvas?.addEventListener('pointermove', this.onCanvasPointerMove);\n    // this._mainCanvas?.addEventListener('pointerup', this.onCanvasPointerUp);\n    // this._mainCanvas?.addEventListener('pointerout', this.onCanvasPointerOut);\n    this.attachWindowEvents();\n  }\n\n  private attachWindowEvents() {\n    window.addEventListener('pointermove', this.onPointerMove);\n    window.addEventListener('pointerup', this.onPointerUp);\n    window.addEventListener('pointerleave', this.onPointerUp);\n    window.addEventListener('pointercancel', this.onPointerOut);\n    window.addEventListener('pointerout', this.onPointerOut);\n    window.addEventListener('keyup', this.onKeyUp);\n  }\n\n  private detachEvents() {\n    // @todo\n    // if (this._resizeObserver && this._container) {\n    //   this._resizeObserver.unobserve(this._container);\n    // }\n\n    // this._mainCanvas?.removeEventListener(\n    //   'pointerdown',\n    //   this.onCanvasPointerDown\n    // );\n    // this._mainCanvas?.removeEventListener(\n    //   'pointerdown',\n    //   this.onCanvasPointerUp\n    // );\n    // this._mainCanvas?.removeEventListener('dblclick', this.onDblClick);\n    this.detachWindowEvents();\n  }\n\n  private detachWindowEvents() {\n    // @todo\n    // window.removeEventListener('pointermove', this.onPointerMove);\n    // window.removeEventListener('pointerup', this.onPointerUp);\n    // window.removeEventListener('pointercancel', this.onPointerOut);\n    // window.removeEventListener('pointerout', this.onPointerOut);\n    // window.removeEventListener('pointerleave', this.onPointerUp);\n    // window.removeEventListener('keyup', this.onKeyUp);\n  }\n\n  private getMarkerTypeByName(typeName: string): typeof MarkerBase | undefined {\n    let result: typeof MarkerBase | undefined;\n    this.markerEditors.forEach((value, key) => {\n      if (key.typeName === typeName) {\n        result = key;\n      }\n    });\n    return result;\n  }\n\n  /**\n   * Switches the marker area to select mode and deselects all the selected markers.\n   */\n  public switchToSelectMode() {\n    this.setCurrentEditor();\n    if (this._mainCanvas) {\n      this._mainCanvas.style.cursor = 'default';\n    }\n  }\n\n  /**\n   * Returns the annotation state.\n   * @returns\n   */\n  public getState(): AnnotationState {\n    const result: AnnotationState = {\n      version: 3,\n      width: this.targetWidth,\n      height: this.targetHeight,\n      defaultFilter: this.defaultFilter,\n\n      markers: this.editors.map((editor) => {\n        return editor.getState();\n      }),\n    };\n\n    return JSON.parse(JSON.stringify(result));\n  }\n\n  private _stateToRestore: AnnotationState | undefined;\n  /**\n   * Restores the annotation from the previously saved state.\n   * @param state\n   * @param addUndoStep if true (default) or omitted, an undo step is added after restoring the state\n   */\n  public restoreState(state: AnnotationState, addUndoStep = true): void {\n    // can't restore if image is not loaded yet\n    if (!this._targetImageLoaded) {\n      this._stateToRestore = state;\n      return;\n    }\n    this._stateToRestore = undefined;\n\n    const stateCopy: AnnotationState = JSON.parse(JSON.stringify(state));\n    this.editors.splice(0);\n\n    if (this._mainCanvas && this._groupLayer) {\n      // deselect everything\n      this.hideMarqueeSelectOutline();\n      this.deselectEditor();\n      // remove all markers\n      while (this._mainCanvas.lastChild) {\n        this._mainCanvas.removeChild(this._mainCanvas.lastChild);\n      }\n      // re-add defs\n      this.addDefsToMainCanvas();\n      // re-add group layer\n      this._mainCanvas.appendChild(this._groupLayer);\n    }\n\n    if (this.defaultFilter === undefined && stateCopy.defaultFilter) {\n      this.defaultFilter = stateCopy.defaultFilter;\n    }\n\n    stateCopy.markers.forEach((markerState) => {\n      const markerType = this.getMarkerTypeByName(markerState.typeName);\n      if (markerType !== undefined) {\n        const editorType = this.markerEditors.get(markerType);\n        if (editorType !== undefined) {\n          const markerEditor = this.addNewMarker(editorType, markerType);\n          markerEditor.restoreState(markerState);\n          this.editors.push(markerEditor);\n        }\n      }\n    });\n\n    if (\n      stateCopy.width &&\n      stateCopy.height &&\n      (stateCopy.width !== this.targetWidth ||\n        stateCopy.height !== this.targetHeight)\n    ) {\n      this.scaleMarkers(\n        this.targetWidth / stateCopy.width,\n        this.targetHeight / stateCopy.height,\n      );\n    }\n\n    if (addUndoStep) {\n      this.addUndoStep(true);\n    }\n\n    this.dispatchEvent(\n      new CustomEvent<MarkerAreaEventData>('arearestorestate', {\n        detail: { markerArea: this },\n      }),\n    );\n  }\n\n  private scaleMarkers(scaleX: number, scaleY: number) {\n    let preScaleSelectedMarker: MarkerBaseEditor | undefined;\n    // @todo\n    // if (!(this._currentMarker && this._currentMarker instanceof TextMarker)) {\n    // can't unselect text marker as it would hide keyboard on mobile\n    // eslint-disable-next-line prefer-const\n    preScaleSelectedMarker = this._currentMarkerEditor;\n    this.setCurrentEditor();\n    // } else {\n    //   this._currentMarker.scale(scaleX, scaleY);\n    // }\n    this.editors.forEach((editor) => {\n      if (editor !== this._currentMarkerEditor) {\n        editor.scale(scaleX, scaleY);\n      }\n    });\n    if (preScaleSelectedMarker !== undefined) {\n      this.setCurrentEditor(preScaleSelectedMarker);\n    }\n  }\n\n  /**\n   * NOTE:\n   *\n   * before removing or modifying this method please consider supporting marker.js\n   * by visiting https://markerjs.com/ for details\n   *\n   * thank you!\n   */\n  private toggleLogo() {\n    if (!Activator.isLicensed('MJS3E') && !Activator.isLicensed('MJS3')) {\n      // NOTE:\n      // before removing this call please consider supporting marker.js\n      // by visiting https://markerjs.com/ for details\n      // thank you!\n      this.addLogo();\n    } else {\n      this.removeLogo();\n    }\n  }\n\n  private addLogo() {\n    if (this._logoUI !== undefined) {\n      this._contentContainer?.removeChild(this._logoUI);\n    }\n    this._logoUI = document.createElement('div');\n    this._logoUI.style.display = 'inline-block';\n    this._logoUI.style.margin = '0px';\n    this._logoUI.style.padding = '0px';\n    this._logoUI.style.fill = '#333333';\n    this._logoUI.style.opacity = '0.5';\n    const logoUI = this._logoUI;\n    this._logoUI.addEventListener('mouseenter', () => {\n      logoUI.style.opacity = '1';\n    });\n    this._logoUI.addEventListener('mouseleave', () => {\n      logoUI.style.opacity = '0.5';\n    });\n\n    const link = document.createElement('a');\n    link.href =\n      'https://markerjs.com/?utm_source=markerjs3&utm_medium=logo&utm_content=marker_area';\n    link.target = '_blank';\n    link.innerHTML = Logo;\n    link.title = 'Powered by marker.js';\n\n    link.style.display = 'grid';\n    link.style.alignItems = 'center';\n    link.style.justifyItems = 'center';\n    link.style.padding = '3px';\n    link.style.width = '20px';\n    link.style.height = '20px';\n    link.style.cursor = 'pointer';\n\n    this._logoUI.appendChild(link);\n\n    this._contentContainer?.appendChild(this._logoUI);\n\n    this._logoUI.style.position = 'absolute';\n    this._logoUI.style.pointerEvents = 'all';\n    this.positionLogo();\n  }\n\n  private removeLogo() {\n    if (\n      this._contentContainer &&\n      this._logoUI !== undefined &&\n      this._contentContainer.contains(this._logoUI)\n    ) {\n      this._contentContainer.removeChild(this._logoUI);\n    }\n  }\n\n  private positionLogo() {\n    if (this._logoUI && this._contentContainer) {\n      this._logoUI.style.left = `20px`;\n      this._logoUI.style.bottom = `20px`;\n    }\n  }\n\n  /**\n   * Returns true if undo operation can be performed (undo stack is not empty).\n   */\n  public get isUndoPossible(): boolean {\n    if (this.undoRedoManager && this.undoRedoManager.isUndoPossible) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Returns true if redo operation can be performed (redo stack is not empty).\n   */\n  public get isRedoPossible(): boolean {\n    if (this.undoRedoManager && this.undoRedoManager.isRedoPossible) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  private addUndoStep(forceAdd = false): void {\n    if (\n      this._currentMarkerEditor === undefined ||\n      this._currentMarkerEditor.state !== 'edit'\n    ) {\n      const currentState = this.getState();\n      const lastUndoState = this.undoRedoManager.getLastUndoStep();\n      if (\n        !forceAdd &&\n        lastUndoState &&\n        (lastUndoState.width !== currentState.width ||\n          lastUndoState.height !== currentState.height)\n      ) {\n        // if the size changed just replace the last step with a resized one\n        this.undoRedoManager.replaceLastUndoStep(currentState);\n        this.dispatchEvent(\n          new CustomEvent<MarkerAreaEventData>('areastatechange', {\n            detail: { markerArea: this },\n          }),\n        );\n      } else {\n        const stepAdded = this.undoRedoManager.addUndoStep(currentState);\n        if (stepAdded) {\n          this.dispatchEvent(\n            new CustomEvent<MarkerAreaEventData>('areastatechange', {\n              detail: { markerArea: this },\n            }),\n          );\n        }\n      }\n    }\n  }\n\n  /**\n   * Undo last action.\n   */\n  public undo(): void {\n    // this.addUndoStep(); // this seems illogical, but it was here for some reason, commenting for now in case regressions occur\n    this.undoStep();\n  }\n\n  private undoStep(): void {\n    const stepData = this.undoRedoManager.undo();\n    if (stepData !== undefined) {\n      this.restoreState(stepData, false);\n    }\n  }\n\n  /**\n   * Redo previously undone action.\n   */\n  public redo(): void {\n    this.redoStep();\n  }\n\n  private redoStep(): void {\n    const stepData = this.undoRedoManager.redo();\n    if (stepData !== undefined) {\n      this.restoreState(stepData, false);\n      this.dispatchEvent(\n        new CustomEvent<MarkerAreaEventData>('areastatechange', {\n          detail: { markerArea: this },\n        }),\n      );\n    }\n  }\n\n  /**\n   * Adds \"defs\" to main canvas SVG.\n   * Useful for filters, custom fonts and potentially other scenarios.\n   *\n   * @param nodes\n   * @since 3.3.0\n   */\n  public addDefs(...nodes: (string | Node)[]): void {\n    this._defs.push(...nodes);\n\n    if (this._defsElement) {\n      this._defsElement.append(...nodes);\n    }\n  }\n\n  addEventListener<T extends keyof MarkerAreaEventMap>(\n    // the event name, a key of MarkerAreaEventMap\n    type: T,\n\n    // the listener, using a value of MarkerAreaEventMap\n    listener: (this: MarkerArea, ev: MarkerAreaEventMap[T]) => void,\n\n    // any options\n    options?: boolean | AddEventListenerOptions,\n  ): void;\n  addEventListener<K extends keyof HTMLElementEventMap>(\n    type: K,\n    listener: (this: HTMLElement, ev: HTMLElementEventMap[K]) => void,\n    options?: boolean | AddEventListenerOptions | undefined,\n  ): void;\n  addEventListener(\n    type: string,\n    listener: EventListenerOrEventListenerObject,\n    options?: boolean | AddEventListenerOptions | undefined,\n  ): void {\n    super.addEventListener(type, listener, options);\n  }\n\n  removeEventListener<T extends keyof MarkerAreaEventMap>(\n    // the event name, a key of MarkerAreaEventMap\n    type: T,\n\n    // the listener, using a value of MarkerAreaEventMap\n    listener: (this: MarkerArea, ev: MarkerAreaEventMap[T]) => void,\n\n    // any options\n    options?: boolean | EventListenerOptions,\n  ): void;\n  removeEventListener<K extends keyof HTMLElementEventMap>(\n    type: K,\n    listener: (this: HTMLElement, ev: HTMLElementEventMap[K]) => void,\n    options?: boolean | EventListenerOptions | undefined,\n  ): void;\n  removeEventListener(\n    type: string,\n    listener: EventListenerOrEventListenerObject,\n    options?: boolean | EventListenerOptions | undefined,\n  ): void {\n    super.removeEventListener(type, listener, options);\n  }\n}\n","/**\n * @module Editor\n * @category API Reference\n */\nimport { MarkerArea } from './MarkerArea';\n\nexport {\n  MarkerArea,\n  MarkerAreaEventData,\n  MarkerEditorEventData,\n  MarkerAreaMode,\n  MarkerAreaEventMap,\n} from './MarkerArea';\nexport {\n  MarkerBaseEditor,\n  MarkerEditorState,\n  MarkerCreationStyle,\n} from './editor/MarkerBaseEditor';\nexport { MarkerEditorProperties } from './editor/MarkerEditorProperties';\nexport { Grip, GripLocation } from './editor/Grip';\nexport { ResizeGrip } from './editor/ResizeGrip';\nexport { RotateGrip } from './editor/RotateGrip';\nexport { ShapeOutlineMarkerEditor } from './editor/ShapeOutlineMarkerEditor';\nexport { ShapeMarkerEditor } from './editor/ShapeMarkerEditor';\nexport { LinearMarkerEditor } from './editor/LinearMarkerEditor';\nexport { PolygonMarkerEditor } from './editor/PolygonMarkerEditor';\nexport { FreehandMarkerEditor } from './editor/FreehandMarkerEditor';\nexport {\n  TextBlockEditor,\n  BlurHandler,\n  TextChangedHandler,\n} from './editor/TextBlockEditor';\nexport { TextMarkerEditor } from './editor/TextMarkerEditor';\nexport { ArrowMarkerEditor } from './editor/ArrowMarkerEditor';\nexport { CalloutMarkerEditor } from './editor/CalloutMarkerEditor';\nexport { ImageMarkerEditor } from './editor/ImageMarkerEditor';\nexport { CaptionFrameMarkerEditor } from './editor/CaptionFrameMarkerEditor';\nexport { CurveMarkerEditor } from './editor/CurveMarkerEditor';\n\nif (\n  window &&\n  window.customElements &&\n  window.customElements.get('mjs-marker-area') === undefined\n) {\n  window.customElements.define('mjs-marker-area', MarkerArea);\n}\n","import {\n  AnnotationState,\n  CoverMarker,\n  FrameMarker,\n  FreehandMarker,\n  HighlightMarker,\n  MarkerBase,\n  PolygonMarker,\n  SvgHelper,\n  TextMarker,\n  LineMarker,\n  MeasurementMarker,\n  ArrowMarker,\n  EllipseFrameMarker,\n  EllipseMarker,\n  CustomImageMarker,\n  CheckImageMarker,\n  XImageMarker,\n  CaptionFrameMarker,\n  CalloutMarker,\n  CurveMarker,\n  HighlighterMarker,\n  SvgFilters,\n  IPoint,\n} from './core';\nimport { Activator } from './core/Activator';\n\nimport Logo from './assets/markerjs-logo-m.svg';\n\n/**\n * Event map for {@link MarkerView}.\n */\nexport interface MarkerViewEventMap {\n  /**\n   * Viewer initialized.\n   */\n  viewinit: CustomEvent<MarkerViewEventData>;\n\n  /**\n   * Viewer shown.\n   */\n  viewshow: CustomEvent<MarkerViewEventData>;\n\n  /**\n   * Viewer state restored.\n   */\n  viewrestorestate: CustomEvent<MarkerViewEventData>;\n\n  /**\n   * Marker clicked.\n   */\n  markerclick: CustomEvent<MarkerEventData>;\n  /**\n   * Marker mouse over.\n   */\n  markerover: CustomEvent<MarkerEventData>;\n  /**\n   * Marker pointer down.\n   */\n  markerpointerdown: CustomEvent<MarkerEventData>;\n  /**\n   * Marker pointer move.\n   */\n  markerpointermove: CustomEvent<MarkerEventData>;\n  /**\n   * Marker pointer up.\n   */\n  markerpointerup: CustomEvent<MarkerEventData>;\n  /**\n   * Marker pointer enter.\n   */\n  markerpointerenter: CustomEvent<MarkerEventData>;\n  /**\n   * Marker pointer leave.\n   */\n  markerpointerleave: CustomEvent<MarkerEventData>;\n}\n\n/**\n * Event data for {@link MarkerView}.\n */\nexport interface MarkerViewEventData {\n  /**\n   * {@link MarkerView} instance.\n   */\n  markerView: MarkerView;\n}\n\n/**\n * Marker custom event data.\n */\nexport interface MarkerEventData extends MarkerViewEventData {\n  /**\n   * Marker instance.\n   */\n  marker: MarkerBase;\n}\n\n/**\n * MarkerView is the main annotation viewer web component.\n *\n * @summary\n * The main annotation viewer web component.\n *\n * @group Components\n *\n * @example\n * To show dynamic annotation overlays on top of the original image you use `MarkerView`.\n * ```js\n * import { MarkerView } from '@markerjs/markerjs3';\n *\n * const markerView = new MarkerView();\n * markerView.targetImage = targetImg;\n * viewerContainer.appendChild(markerView);\n *\n * markerView.show(savedState);\n * ```\n */\nexport class MarkerView extends HTMLElement {\n  private _contentContainer?: HTMLDivElement;\n  private _canvasContainer?: HTMLDivElement;\n\n  private _mainCanvas?: SVGSVGElement;\n  private _groupLayer?: SVGGElement;\n\n  private _editingTarget?: HTMLImageElement;\n\n  private width = 0;\n  private height = 0;\n\n  private _targetWidth = -1;\n  /**\n   * Returns the target image width.\n   */\n  public get targetWidth() {\n    return this._targetWidth;\n  }\n  /**\n   * Sets the target image width.\n   */\n  public set targetWidth(value) {\n    this._targetWidth = value;\n    this.setMainCanvasSize();\n  }\n  private _targetHeight = -1;\n  /**\n   * Returns the target image height.\n   */\n  public get targetHeight() {\n    return this._targetHeight;\n  }\n  /**\n   * Sets the target image height.\n   */\n  public set targetHeight(value) {\n    this._targetHeight = value;\n    this.setMainCanvasSize();\n  }\n\n  private _targetImageLoaded = false;\n  private _targetImage: HTMLImageElement | undefined;\n  /**\n   * Returns the target image.\n   */\n  public get targetImage(): HTMLImageElement | undefined {\n    return this._targetImage;\n  }\n  /**\n   * Sets the target image.\n   */\n  public set targetImage(value: HTMLImageElement | undefined) {\n    this._targetImage = value;\n    this._targetImageLoaded = false;\n    if (value !== undefined) {\n      this.addTargetImage();\n    }\n  }\n\n  /**\n   * Marker types available for the viewer.\n   */\n  public markerTypes: Array<typeof MarkerBase> = [];\n\n  /**\n   * Collection of markers currently displayed on the viewer.\n   */\n  public markers: MarkerBase[] = [];\n\n  private _logoUI?: HTMLElement;\n\n  private _zoomLevel = 1;\n  /**\n   * Returns the current zoom level.\n   */\n  public get zoomLevel(): number {\n    return this._zoomLevel;\n  }\n  /**\n   * Sets the current zoom level.\n   */\n  public set zoomLevel(value: number) {\n    this._zoomLevel = value;\n    if (this._canvasContainer && this._contentContainer && this._mainCanvas) {\n      this._mainCanvas.style.transform = `scale(${this._zoomLevel})`;\n      this.setEditingTargetSize();\n\n      const scrollMultiplier = Math.max(this._zoomLevel, 1);\n      this._canvasContainer.scrollTo({\n        left:\n          (this._mainCanvas.clientWidth * scrollMultiplier -\n            this._canvasContainer.clientWidth) /\n          2,\n        top:\n          (this._mainCanvas.clientHeight * scrollMultiplier -\n            this._canvasContainer.clientHeight) /\n          2,\n      });\n    }\n  }\n\n  private _defaultFilter?: string;\n  /**\n   * Returns the default SVG filter for the created markers.\n   *\n   * @since 3.2.0\n   */\n  public get defaultFilter(): string | undefined {\n    return this._defaultFilter;\n  }\n  /**\n   * Sets the default SVG filter for the created markers\n   * (e.g. \"drop-shadow(2px 2px 2px black)\").\n   *\n   * @since 3.2.0\n   */\n  public set defaultFilter(value: string | undefined) {\n    this._defaultFilter = value;\n  }\n\n  private _isInitialized = false;\n\n  private _defsElement?: SVGDefsElement;\n  private _defs: (string | Node)[] = [];\n\n  private prevPanPoint: IPoint = { x: 0, y: 0 };\n\n  constructor() {\n    super();\n\n    this.markerTypes = [\n      FrameMarker,\n      LineMarker,\n      ArrowMarker,\n      MeasurementMarker,\n      PolygonMarker,\n      FreehandMarker,\n      TextMarker,\n      CoverMarker,\n      HighlightMarker,\n      CalloutMarker,\n      EllipseFrameMarker,\n      EllipseMarker,\n      CustomImageMarker,\n      CheckImageMarker,\n      XImageMarker,\n      CaptionFrameMarker,\n      CurveMarker,\n      HighlighterMarker,\n    ];\n\n    this.connectedCallback = this.connectedCallback.bind(this);\n    this.disconnectedCallback = this.disconnectedCallback.bind(this);\n\n    this.createLayout = this.createLayout.bind(this);\n    this.addMainCanvas = this.addMainCanvas.bind(this);\n    this.setMainCanvasSize = this.setMainCanvasSize.bind(this);\n    this.setEditingTargetSize = this.setEditingTargetSize.bind(this);\n    this.addTargetImage = this.addTargetImage.bind(this);\n\n    this.attachMarkerEvents = this.attachMarkerEvents.bind(this);\n    this.attachEvents = this.attachEvents.bind(this);\n    this.attachWindowEvents = this.attachWindowEvents.bind(this);\n    this.detachEvents = this.detachEvents.bind(this);\n    this.detachWindowEvents = this.detachWindowEvents.bind(this);\n\n    this.onCanvasPointerDown = this.onCanvasPointerDown.bind(this);\n    this.onPointerMove = this.onPointerMove.bind(this);\n    this.onPointerUp = this.onPointerUp.bind(this);\n    this.onPointerOut = this.onPointerOut.bind(this);\n\n    this.addNewMarker = this.addNewMarker.bind(this);\n\n    this.show = this.show.bind(this);\n    this.scaleMarkers = this.scaleMarkers.bind(this);\n\n    this.toggleLogo = this.toggleLogo.bind(this);\n    this.addLogo = this.addLogo.bind(this);\n    this.removeLogo = this.removeLogo.bind(this);\n\n    this.addDefs = this.addDefs.bind(this);\n    this.addDefaultFilterDefs = this.addDefaultFilterDefs.bind(this);\n\n    this.attachShadow({ mode: 'open' });\n  }\n\n  private connectedCallback() {\n    this.dispatchEvent(\n      new CustomEvent<MarkerViewEventData>('viewinit', {\n        detail: { markerView: this },\n      }),\n    );\n    Activator.addKeyAddListener(this.toggleLogo);\n    this.createLayout();\n    this.addMainCanvas();\n    this.attachEvents();\n    this._isInitialized = true;\n    if (this.targetImage !== undefined) {\n      this.addTargetImage();\n    }\n    this.setMainCanvasSize();\n    this.addDefaultFilterDefs();\n    this.toggleLogo();\n    this.dispatchEvent(\n      new CustomEvent<MarkerViewEventData>('viewshow', {\n        detail: { markerView: this },\n      }),\n    );\n  }\n\n  private disconnectedCallback() {\n    this.detachEvents();\n  }\n\n  private createLayout() {\n    this.style.display = 'flex';\n    this.style.width = this.style.width !== '' ? this.style.width : '100%';\n    this.style.height = this.style.height !== '' ? this.style.height : '100%';\n    this.style.position = 'relative';\n\n    this._contentContainer = document.createElement('div');\n    this._contentContainer.style.display = 'flex';\n    this._contentContainer.style.position = 'relative';\n    this._contentContainer.style.flexGrow = '2';\n    this._contentContainer.style.flexShrink = '1';\n    this._contentContainer.style.overflow = 'hidden';\n\n    this._canvasContainer = document.createElement('div');\n    this._canvasContainer.style.touchAction = 'pinch-zoom';\n    this._canvasContainer.className = 'canvas-container';\n    this._canvasContainer.style.display = 'grid';\n    this._canvasContainer.style.gridTemplateColumns = '1fr';\n    this._canvasContainer.style.flexGrow = '2';\n    this._canvasContainer.style.flexShrink = '2';\n    this._canvasContainer.style.justifyItems = 'center';\n    this._canvasContainer.style.alignItems = 'center';\n    this._canvasContainer.style.overflow = 'auto';\n    this._contentContainer.appendChild(this._canvasContainer);\n\n    this.shadowRoot?.appendChild(this._contentContainer);\n  }\n\n  private addMainCanvas() {\n    this.width = this._contentContainer?.clientWidth || 0;\n    this.height = this._contentContainer?.clientHeight || 0;\n\n    this._mainCanvas = document.createElementNS(\n      'http://www.w3.org/2000/svg',\n      'svg',\n    );\n    this._mainCanvas.setAttribute('xmlns', 'http://www.w3.org/2000/svg');\n    this.setMainCanvasSize();\n    this._mainCanvas.style.gridColumnStart = '1';\n    this._mainCanvas.style.gridRowStart = '1';\n    this._mainCanvas.style.pointerEvents = 'auto';\n    // this._mainCanvas.style.backgroundColor = 'pink'; // @todo\n    // this._mainCanvas.style.opacity = '0.3'; // @todo\n    this._mainCanvas.style.margin = '10px';\n    this._mainCanvas.style.transform = `scale(${this._zoomLevel})`;\n\n    this.addDefsToMainCanvas();\n\n    this._groupLayer = SvgHelper.createGroup();\n\n    this._mainCanvas.appendChild(this._groupLayer);\n\n    this._canvasContainer?.appendChild(this._mainCanvas);\n  }\n\n  private addDefsToMainCanvas() {\n    this._defsElement = SvgHelper.createDefs();\n    this._mainCanvas?.appendChild(this._defsElement);\n    this._defsElement.append(...this._defs);\n  }\n\n  private setMainCanvasSize() {\n    if (\n      this._mainCanvas !== undefined &&\n      this._targetHeight > 0 &&\n      this._targetWidth > 0\n    ) {\n      this._mainCanvas.style.width = `${this._targetWidth * this.zoomLevel}px`;\n      this._mainCanvas.style.height = `${\n        this._targetHeight * this.zoomLevel\n      }px`;\n      this._mainCanvas.setAttribute(\n        'width',\n        `${this._targetWidth * this.zoomLevel}`,\n      );\n      this._mainCanvas.setAttribute(\n        'height',\n        `${this._targetHeight * this.zoomLevel}`,\n      );\n      this._mainCanvas.setAttribute(\n        'viewBox',\n        '0 0 ' +\n          this._targetWidth.toString() +\n          ' ' +\n          this._targetHeight.toString(),\n      );\n      this.setEditingTargetSize();\n    }\n  }\n\n  private setEditingTargetSize() {\n    if (this._editingTarget !== undefined) {\n      this._editingTarget.width = this._targetWidth * this.zoomLevel;\n      this._editingTarget.height = this._targetHeight * this.zoomLevel;\n      this._editingTarget.style.width = `${\n        this._targetWidth * this.zoomLevel\n      }px`;\n      this._editingTarget.style.height = `${\n        this._targetHeight * this.zoomLevel\n      }px`;\n    }\n  }\n\n  private addTargetImage() {\n    if (\n      this._isInitialized &&\n      this._editingTarget === undefined &&\n      this.targetImage !== undefined &&\n      this._canvasContainer !== undefined &&\n      this._mainCanvas !== undefined\n    ) {\n      this._editingTarget = document.createElement('img');\n\n      this._targetWidth =\n        this._targetWidth > 0\n          ? this._targetWidth\n          : this.targetImage.clientWidth;\n      this._targetHeight =\n        this._targetHeight > 0\n          ? this._targetHeight\n          : this.targetImage.clientHeight;\n\n      this._editingTarget.addEventListener('load', (ev) => {\n        if (this._editingTarget !== undefined) {\n          if (this._targetHeight <= 0 || this._targetWidth <= 0) {\n            const img = <HTMLImageElement>ev.target;\n\n            const aspectRatio = img.naturalWidth / img.naturalHeight;\n            const calculatedWidth =\n              this._targetWidth > 0\n                ? this._targetWidth\n                : this._targetHeight > 0\n                ? this._targetHeight * aspectRatio\n                : img.clientWidth > 0\n                ? img.clientWidth\n                : img.naturalWidth;\n            const calculatedHeight =\n              this._targetHeight > 0\n                ? this._targetHeight\n                : this._targetWidth > 0\n                ? this._targetWidth / aspectRatio\n                : img.clientHeight > 0\n                ? img.clientHeight\n                : img.naturalHeight;\n\n            this._targetWidth = calculatedWidth;\n            this._targetHeight = calculatedHeight;\n          }\n          this._editingTarget.width = this._targetWidth;\n          this._editingTarget.height = this._targetHeight;\n          this._editingTarget.style.width = `${this._targetWidth}px`;\n          this._editingTarget.style.height = `${this._targetHeight}px`;\n          this._editingTarget.style.gridColumnStart = '1';\n          this._editingTarget.style.gridRowStart = '1';\n\n          this.setMainCanvasSize();\n\n          this._targetImageLoaded = true;\n          if (this._stateToRestore !== undefined) {\n            this.show(this._stateToRestore);\n          }\n        }\n\n        // reset zoom to scroll to center if needed\n        this.zoomLevel = this._zoomLevel;\n      });\n      this._editingTarget.src = this.targetImage.src;\n\n      this._canvasContainer.insertBefore(this._editingTarget, this._mainCanvas);\n    }\n  }\n\n  private addDefaultFilterDefs() {\n    this.addDefs(...SvgFilters.getDefaultFilterSet());\n  }\n\n  private addNewMarker(markerType: typeof MarkerBase): MarkerBase {\n    if (this._mainCanvas === undefined) {\n      throw new Error('Main canvas is not initialized.');\n    }\n\n    const g = SvgHelper.createGroup();\n    if (this.defaultFilter && markerType.applyDefaultFilter) {\n      g.setAttribute('filter', this.defaultFilter);\n    }\n    this._mainCanvas.appendChild(g);\n\n    const newMarker = new markerType(g);\n\n    this.attachMarkerEvents(newMarker);\n\n    return newMarker;\n  }\n\n  private attachMarkerEvents(marker: MarkerBase) {\n    marker.container.addEventListener('click', () => {\n      this.dispatchEvent(\n        new CustomEvent<MarkerEventData>('markerclick', {\n          detail: { marker: marker, markerView: this },\n        }),\n      );\n    });\n    marker.container.addEventListener('pointerover', () => {\n      this.dispatchEvent(\n        new CustomEvent<MarkerEventData>('markerover', {\n          detail: { marker: marker, markerView: this },\n        }),\n      );\n    });\n    marker.container.addEventListener('pointerdown', () => {\n      this.dispatchEvent(\n        new CustomEvent<MarkerEventData>('markerpointerdown', {\n          detail: { marker: marker, markerView: this },\n        }),\n      );\n    });\n    marker.container.addEventListener('pointermove', () => {\n      this.dispatchEvent(\n        new CustomEvent<MarkerEventData>('markerpointermove', {\n          detail: { marker: marker, markerView: this },\n        }),\n      );\n    });\n    marker.container.addEventListener('pointerup', () => {\n      this.dispatchEvent(\n        new CustomEvent<MarkerEventData>('markerpointerup', {\n          detail: { marker: marker, markerView: this },\n        }),\n      );\n    });\n    marker.container.addEventListener('pointerenter', () => {\n      this.dispatchEvent(\n        new CustomEvent<MarkerEventData>('markerpointerenter', {\n          detail: { marker: marker, markerView: this },\n        }),\n      );\n    });\n    marker.container.addEventListener('pointerleave', () => {\n      this.dispatchEvent(\n        new CustomEvent<MarkerEventData>('markerpointerleave', {\n          detail: { marker: marker, markerView: this },\n        }),\n      );\n    });\n  }\n\n  private attachEvents() {\n    // needed to distinguish when the element is in focus (active)\n    if (!this.hasAttribute('tabindex')) {\n      this.setAttribute('tabindex', '0');\n    }\n\n    // @todo\n    // this.setupResizeObserver();\n\n    this._mainCanvas?.addEventListener('pointerdown', this.onCanvasPointerDown);\n    // workaround to prevent a bug with Apple Pencil\n    // https://bugs.webkit.org/show_bug.cgi?id=217430\n    this._mainCanvas?.addEventListener('touchmove', (ev) =>\n      ev.preventDefault(),\n    );\n\n    this.attachWindowEvents();\n  }\n\n  private attachWindowEvents() {\n    window.addEventListener('pointermove', this.onPointerMove);\n    window.addEventListener('pointerup', this.onPointerUp);\n    window.addEventListener('pointerleave', this.onPointerUp);\n    window.addEventListener('pointercancel', this.onPointerOut);\n    window.addEventListener('pointerout', this.onPointerOut);\n  }\n\n  private detachEvents() {\n    // @todo\n    // if (this._resizeObserver && this._container) {\n    //   this._resizeObserver.unobserve(this._container);\n    // }\n    // this._mainCanvas?.removeEventListener('pointerdown', this.onPointerDown);\n    // this._mainCanvas?.removeEventListener(\n    //   'pointerdown',\n    //   this.onStencilPointerUp\n    // );\n    this.detachWindowEvents();\n  }\n\n  private detachWindowEvents() {\n    // @todo\n    // window.removeEventListener('pointermove', this.onPointerMove);\n    // window.removeEventListener('pointerup', this.onPointerUp);\n    // window.removeEventListener('pointercancel', this.onPointerOut);\n    // window.removeEventListener('pointerout', this.onPointerOut);\n    // window.removeEventListener('pointerleave', this.onPointerUp);\n  }\n\n  private touchPoints = 0;\n  private leadPointerId?: number;\n\n  private onCanvasPointerDown(ev: PointerEvent) {\n    // @todo ?\n    // if (!this._isFocused) {\n    //   this.focus();\n    // }\n\n    this.touchPoints++;\n    if (this.touchPoints === 1) {\n      this.leadPointerId = ev.pointerId;\n      this.prevPanPoint = { x: ev.clientX, y: ev.clientY };\n      if (this._mainCanvas) {\n        this._mainCanvas.style.cursor = 'grabbing';\n      }\n    }\n  }\n\n  private onPointerMove(ev: PointerEvent) {\n    if (this.touchPoints > 0 && this.leadPointerId === ev.pointerId) {\n      this.panTo({ x: ev.clientX, y: ev.clientY });\n    }\n  }\n\n  private onPointerUp() {\n    if (this.touchPoints > 0) {\n      this.touchPoints--;\n      if (this.touchPoints === 0) {\n        this.leadPointerId = undefined;\n      }\n\n      if (this._mainCanvas) {\n        this._mainCanvas.style.cursor = 'default';\n      }\n    }\n  }\n\n  private onPointerOut(/*ev: PointerEvent*/) {\n    if (this.touchPoints > 0) {\n      this.touchPoints--;\n    }\n  }\n\n  private getMarkerTypeByName(typeName: string): typeof MarkerBase | undefined {\n    let result: typeof MarkerBase | undefined;\n    this.markerTypes.forEach((mType) => {\n      if (mType.typeName === typeName) {\n        result = mType;\n      }\n    });\n    return result;\n  }\n\n  /**\n   * Adds a new marker type to be available in the viewer.\n   * @param markerType\n   */\n  public registerMarkerType(markerType: typeof MarkerBase): void {\n    if (this.markerTypes.indexOf(markerType) < 0) {\n      this.markerTypes.push(markerType);\n    }\n  }\n\n  private _stateToRestore: AnnotationState | undefined;\n  /**\n   * Loads and shows previously saved annotation state.\n   * @param state\n   */\n  public show(state: AnnotationState): void {\n    // can't restore if image is not loaded yet\n    if (!this._targetImageLoaded) {\n      this._stateToRestore = state;\n      return;\n    }\n    this._stateToRestore = undefined;\n\n    const stateCopy: AnnotationState = JSON.parse(JSON.stringify(state));\n    this.markers.splice(0);\n\n    while (this._mainCanvas?.lastChild) {\n      this._mainCanvas.removeChild(this._mainCanvas.lastChild);\n    }\n\n    // re-add defs\n    this.addDefsToMainCanvas();\n\n    if (this.defaultFilter === undefined && stateCopy.defaultFilter) {\n      this.defaultFilter = stateCopy.defaultFilter;\n    }\n\n    stateCopy.markers.forEach((markerState) => {\n      const markerType = this.getMarkerTypeByName(markerState.typeName);\n      if (markerType !== undefined) {\n        const marker = this.addNewMarker(markerType);\n        marker.restoreState(markerState);\n        this.markers.push(marker);\n      }\n    });\n\n    if (\n      stateCopy.width &&\n      stateCopy.height &&\n      (stateCopy.width !== this.targetWidth ||\n        stateCopy.height !== this.targetHeight)\n    ) {\n      this.scaleMarkers(\n        this.targetWidth / stateCopy.width,\n        this.targetHeight / stateCopy.height,\n      );\n    }\n\n    this.dispatchEvent(\n      new CustomEvent<MarkerViewEventData>('viewrestorestate', {\n        detail: { markerView: this },\n      }),\n    );\n  }\n\n  private scaleMarkers(scaleX: number, scaleY: number) {\n    this.markers.forEach((marker) => {\n      marker.scale(scaleX, scaleY);\n    });\n  }\n\n  private panTo(point: IPoint) {\n    this._canvasContainer?.scrollBy({\n      left: this.prevPanPoint.x - point.x,\n      top: this.prevPanPoint.y - point.y,\n    });\n    this.prevPanPoint = point;\n  }\n\n  /**\n   * NOTE:\n   *\n   * before removing or modifying this method please consider supporting marker.js\n   * by visiting https://markerjs.com/buy for details\n   *\n   * thank you!\n   */\n  private toggleLogo() {\n    if (!Activator.isLicensed('MJS3V') && !Activator.isLicensed('MJS3')) {\n      // NOTE:\n      // before removing this call please consider supporting marker.js\n      // by visiting https://markerjs.com/ for details\n      // thank you!\n      this.addLogo();\n    } else {\n      this.removeLogo();\n    }\n  }\n\n  private addLogo() {\n    if (this._logoUI !== undefined) {\n      this._contentContainer?.removeChild(this._logoUI);\n    }\n    this._logoUI = document.createElement('div');\n    this._logoUI.style.display = 'inline-block';\n    this._logoUI.style.margin = '0px';\n    this._logoUI.style.padding = '0px';\n    this._logoUI.style.fill = '#333333';\n    this._logoUI.style.opacity = '0.5';\n    const logoUI = this._logoUI;\n    this._logoUI.addEventListener('mouseenter', () => {\n      logoUI.style.opacity = '1';\n    });\n    this._logoUI.addEventListener('mouseleave', () => {\n      logoUI.style.opacity = '0.5';\n    });\n\n    const link = document.createElement('a');\n    link.href =\n      'https://markerjs.com/?utm_source=markerjs3&utm_medium=logo&utm_content=marker_view';\n    link.target = '_blank';\n    link.innerHTML = Logo;\n    link.title = 'Powered by marker.js';\n\n    link.style.display = 'grid';\n    link.style.alignItems = 'center';\n    link.style.justifyItems = 'center';\n    link.style.padding = '3px';\n    link.style.width = '20px';\n    link.style.height = '20px';\n    link.style.cursor = 'pointer';\n\n    this._logoUI.appendChild(link);\n\n    this._contentContainer?.appendChild(this._logoUI);\n\n    this._logoUI.style.position = 'absolute';\n    this._logoUI.style.pointerEvents = 'all';\n    this.positionLogo();\n  }\n\n  private removeLogo() {\n    if (\n      this._contentContainer &&\n      this._logoUI !== undefined &&\n      this._contentContainer.contains(this._logoUI)\n    ) {\n      this._contentContainer.removeChild(this._logoUI);\n    }\n  }\n\n  private positionLogo() {\n    if (this._logoUI && this._contentContainer) {\n      this._logoUI.style.left = `20px`;\n      this._logoUI.style.bottom = `20px`;\n    }\n  }\n\n  /**\n   * Adds \"defs\" to main canvas SVG.\n   * Useful for filters, custom fonts and potentially other scenarios.\n   * @since 3.3.0\n   */\n  public addDefs(...nodes: (string | Node)[]): void {\n    this._defs.push(...nodes);\n\n    if (this._defsElement) {\n      this._defsElement.append(...nodes);\n    }\n  }\n\n  addEventListener<T extends keyof MarkerViewEventMap>(\n    // the event name, a key of MarkerViewEventMap\n    type: T,\n\n    // the listener, using a value of MarkerViewEventMap\n    listener: (this: MarkerView, ev: MarkerViewEventMap[T]) => void,\n\n    // any options\n    options?: boolean | AddEventListenerOptions,\n  ): void;\n  addEventListener<K extends keyof HTMLElementEventMap>(\n    type: K,\n    listener: (this: HTMLElement, ev: HTMLElementEventMap[K]) => void,\n    options?: boolean | AddEventListenerOptions | undefined,\n  ): void;\n  addEventListener(\n    type: string,\n    listener: EventListenerOrEventListenerObject,\n    options?: boolean | AddEventListenerOptions | undefined,\n  ): void {\n    super.addEventListener(type, listener, options);\n  }\n\n  removeEventListener<T extends keyof MarkerViewEventMap>(\n    // the event name, a key of MarkerViewEventMap\n    type: T,\n\n    // the listener, using a value of MarkerViewEventMap\n    listener: (this: MarkerView, ev: MarkerViewEventMap[T]) => void,\n\n    // any options\n    options?: boolean | EventListenerOptions,\n  ): void;\n  removeEventListener<K extends keyof HTMLElementEventMap>(\n    type: K,\n    listener: (this: HTMLElement, ev: HTMLElementEventMap[K]) => void,\n    options?: boolean | EventListenerOptions | undefined,\n  ): void;\n  removeEventListener(\n    type: string,\n    listener: EventListenerOrEventListenerObject,\n    options?: boolean | EventListenerOptions | undefined,\n  ): void {\n    super.removeEventListener(type, listener, options);\n  }\n}\n","/**\n * @module Viewer\n * @category API Reference\n */\nimport { MarkerView } from './MarkerView';\n\nexport {\n  MarkerView,\n  MarkerViewEventData,\n  MarkerEventData,\n  MarkerViewEventMap,\n} from './MarkerView';\n\nif (\n  window &&\n  window.customElements &&\n  window.customElements.get('mjs-marker-view') === undefined\n) {\n  window.customElements.define('mjs-marker-view', MarkerView);\n}\n","/**\n * @module Renderer\n * @category API Reference\n */\nimport {\n  AnnotationState,\n  CoverMarker,\n  FrameMarker,\n  FreehandMarker,\n  HighlightMarker,\n  MarkerBase,\n  PolygonMarker,\n  SvgHelper,\n  TextMarker,\n  LineMarker,\n  ArrowMarker,\n  MeasurementMarker,\n  EllipseFrameMarker,\n  EllipseMarker,\n  CalloutMarker,\n  CustomImageMarker,\n  CheckImageMarker,\n  XImageMarker,\n  CaptionFrameMarker,\n  CurveMarker,\n  HighlighterMarker,\n  SvgFilters,\n} from './core';\n\n/**\n * Renderer is used to rasterize annotations.\n *\n * @example\n * To render the annotation as a static image you use `Renderer`.\n *\n * ```js\n * import { MarkerArea, Renderer } from '@markerjs/markerjs3';\n * ```\n *\n * Just create an instance of it and pass the annotation state to the `rasterize()` method:\n *\n * ```js\n * const renderer = new Renderer();\n * renderer.targetImage = targetImg;\n * const dataUrl = await renderer.rasterize(markerArea.getState());\n *\n * const img = document.createElement('img');\n * img.src = dataUrl;\n *\n * someDiv.appendChild(img);\n * ```\n */\nexport class Renderer {\n  private _mainCanvas?: SVGSVGElement;\n\n  private _editingTarget?: HTMLImageElement;\n\n  private _renderHelperContainer?: HTMLDivElement;\n\n  private _targetWidth = -1;\n  /**\n   * Width of the target image.\n   */\n  public get targetWidth() {\n    return this._targetWidth;\n  }\n  /**\n   * Width of the target image.\n   */\n  public set targetWidth(value) {\n    this._targetWidth = value;\n    this.setMainCanvasSize();\n  }\n  private _targetHeight = -1;\n  /**\n   * Height of the target image.\n   */\n  public get targetHeight() {\n    return this._targetHeight;\n  }\n  /**\n   * Height of the target image.\n   */\n  public set targetHeight(value) {\n    this._targetHeight = value;\n    this.setMainCanvasSize();\n  }\n\n  private _targetImageLoaded = false;\n\n  private _targetImage: HTMLImageElement | undefined;\n  /**\n   * Target image to render annotations on.\n   */\n  public get targetImage(): HTMLImageElement | undefined {\n    return this._targetImage;\n  }\n  /**\n   * Target image to render annotations on.\n   */\n  public set targetImage(value: HTMLImageElement | undefined) {\n    this._targetImageLoaded = false;\n    this._targetImage = value;\n    if (value !== undefined) {\n      this.addTargetImage();\n    }\n  }\n\n  /**\n   * Marker types available for rendering.\n   */\n  public markerTypes: Array<typeof MarkerBase> = [];\n\n  /**\n   * Array of markers to render.\n   */\n  public markers: MarkerBase[] = [];\n\n  private _isInitialized = false;\n\n  /**\n   * Whether the image should be rendered at the original (natural) target image size.\n   */\n  public naturalSize = false;\n  /**\n   * Rendered image type (`image/png`, `image/jpeg`, etc.).\n   */\n  public imageType = 'image/png';\n  /**\n   * For formats that support it, specifies rendering quality.\n   *\n   * In the case of `image/jpeg` you can specify a value between 0 and 1 (lowest to highest quality).\n   *\n   * @type {number} - image rendering quality (0..1)\n   */\n  public imageQuality?: number;\n  /**\n   * When set to true, only the marker layer without the original image will be rendered.\n   */\n  public markersOnly = false;\n\n  /**\n   * When set and {@linkcode naturalSize} is `false` sets the width of the rendered image.\n   *\n   * Both `width` and `height` have to be set for this to take effect.\n   */\n  public width?: number;\n  /**\n   * When set and {@linkcode naturalSize} is `false` sets the height of the rendered image.\n   *\n   * Both `width` and `height` have to be set for this to take effect.\n   */\n  public height?: number;\n\n  private _defaultFilter?: string;\n  /**\n   * Returns the default SVG filter for the created markers.\n   *\n   * @since 3.2.0\n   */\n  public get defaultFilter(): string | undefined {\n    return this._defaultFilter;\n  }\n  /**\n   * Sets the default SVG filter for the created markers\n   * (e.g. \"drop-shadow(2px 2px 2px black)\").\n   *\n   * @since 3.2.0\n   */\n  public set defaultFilter(value: string | undefined) {\n    this._defaultFilter = value;\n  }\n\n  private _defsElement?: SVGDefsElement;\n  private _defs: (string | Node)[] = [];\n\n  constructor() {\n    this.markerTypes = [\n      FrameMarker,\n      LineMarker,\n      ArrowMarker,\n      MeasurementMarker,\n      PolygonMarker,\n      FreehandMarker,\n      TextMarker,\n      CoverMarker,\n      HighlightMarker,\n      CalloutMarker,\n      EllipseFrameMarker,\n      EllipseMarker,\n      CustomImageMarker,\n      CheckImageMarker,\n      XImageMarker,\n      CaptionFrameMarker,\n      CurveMarker,\n      HighlighterMarker,\n    ];\n\n    this.init = this.init.bind(this);\n\n    this.addMainCanvas = this.addMainCanvas.bind(this);\n    this.setMainCanvasSize = this.setMainCanvasSize.bind(this);\n    this.setEditingTargetSize = this.setEditingTargetSize.bind(this);\n    this.addTargetImage = this.addTargetImage.bind(this);\n\n    this.addNewMarker = this.addNewMarker.bind(this);\n\n    this.restoreState = this.restoreState.bind(this);\n    this.scaleMarkers = this.scaleMarkers.bind(this);\n\n    this.addDefs = this.addDefs.bind(this);\n    this.addDefaultFilterDefs = this.addDefaultFilterDefs.bind(this);\n  }\n\n  private init() {\n    this.addMainCanvas();\n    this._isInitialized = true;\n    if (this.targetImage !== undefined) {\n      this.addTargetImage();\n    }\n    this.setMainCanvasSize();\n    this.addDefaultFilterDefs();\n  }\n\n  private addMainCanvas() {\n    this._mainCanvas = document.createElementNS(\n      'http://www.w3.org/2000/svg',\n      'svg',\n    );\n    this._mainCanvas.setAttribute('xmlns', 'http://www.w3.org/2000/svg');\n    this.setMainCanvasSize();\n    this._mainCanvas.style.gridColumnStart = '1';\n    this._mainCanvas.style.gridRowStart = '1';\n    this._mainCanvas.style.pointerEvents = 'auto';\n\n    // text isn't sized correctly without adding to the DOM\n    this._mainCanvas.style.visibility = 'hidden';\n\n    this.addDefsToMainCanvas();\n\n    this._renderHelperContainer = document.createElement('div');\n    this._renderHelperContainer.style.position = 'absolute';\n    this._renderHelperContainer.style.top = '0px';\n    this._renderHelperContainer.style.left = '0px';\n    this._renderHelperContainer.style.width = '10px';\n    this._renderHelperContainer.style.height = '10px';\n    this._renderHelperContainer.style.overflow = 'hidden';\n    this._renderHelperContainer.style.visibility = 'hidden';\n\n    this._renderHelperContainer.appendChild(this._mainCanvas);\n\n    document.body.appendChild(this._renderHelperContainer);\n  }\n\n  private addDefsToMainCanvas() {\n    this._defsElement = SvgHelper.createDefs();\n    this._mainCanvas?.appendChild(this._defsElement);\n    this._defsElement.append(...this._defs);\n  }\n\n  private setMainCanvasSize() {\n    if (\n      this._mainCanvas !== undefined &&\n      this._targetHeight > 0 &&\n      this._targetWidth > 0\n    ) {\n      this._mainCanvas.style.width = `${this._targetWidth}px`;\n      this._mainCanvas.style.height = `${this._targetHeight}px`;\n      this._mainCanvas.setAttribute('width', `${this._targetWidth}`);\n      this._mainCanvas.setAttribute('height', `${this._targetHeight}`);\n      this._mainCanvas.setAttribute(\n        'viewBox',\n        '0 0 ' +\n          this._targetWidth.toString() +\n          ' ' +\n          this._targetHeight.toString(),\n      );\n      this.setEditingTargetSize();\n    }\n  }\n\n  private setEditingTargetSize() {\n    if (this._editingTarget !== undefined) {\n      this._editingTarget.width = this._targetWidth;\n      this._editingTarget.height = this._targetHeight;\n      this._editingTarget.style.width = `${this._targetWidth}px`;\n      this._editingTarget.style.height = `${this._targetHeight}px`;\n    }\n  }\n\n  private addTargetImage() {\n    if (\n      this._isInitialized &&\n      this._editingTarget === undefined &&\n      this.targetImage !== undefined &&\n      this._mainCanvas !== undefined\n    ) {\n      this._editingTarget = document.createElement('img');\n\n      this._targetWidth =\n        this._targetWidth > 0\n          ? this._targetWidth\n          : this.targetImage.clientWidth;\n      this._targetHeight =\n        this._targetHeight > 0\n          ? this._targetHeight\n          : this.targetImage.clientHeight;\n\n      this._editingTarget.addEventListener('load', (ev) => {\n        if (this._editingTarget !== undefined) {\n          if (this._targetHeight <= 0 || this._targetWidth <= 0) {\n            const img = <HTMLImageElement>ev.target;\n\n            const aspectRatio = img.naturalWidth / img.naturalHeight;\n            const calculatedWidth =\n              this._targetWidth > 0\n                ? this._targetWidth\n                : this._targetHeight > 0\n                ? this._targetHeight * aspectRatio\n                : img.naturalWidth;\n            const calculatedHeight =\n              this._targetHeight > 0\n                ? this._targetHeight\n                : this._targetWidth > 0\n                ? this._targetWidth / aspectRatio\n                : img.naturalHeight;\n\n            this._targetWidth = calculatedWidth;\n            this._targetHeight = calculatedHeight;\n          }\n          this._editingTarget.width = this._targetWidth;\n          this._editingTarget.height = this._targetHeight;\n          this._editingTarget.style.width = `${this._targetWidth}px`;\n          this._editingTarget.style.height = `${this._targetHeight}px`;\n          this._editingTarget.style.gridColumnStart = '1';\n          this._editingTarget.style.gridRowStart = '1';\n\n          this._targetImageLoaded = true;\n\n          this.setMainCanvasSize();\n        }\n      });\n      this._editingTarget.style.visibility = 'hidden';\n      this._editingTarget.src = this.targetImage.src;\n\n      this._renderHelperContainer?.insertBefore(\n        this._editingTarget,\n        this._mainCanvas,\n      );\n      // document.body.appendChild(this._editingTarget);\n    }\n  }\n\n  private addDefaultFilterDefs() {\n    this.addDefs(...SvgFilters.getDefaultFilterSet());\n  }\n\n  private addNewMarker(markerType: typeof MarkerBase): MarkerBase {\n    if (this._mainCanvas === undefined) {\n      throw new Error('Main canvas is not initialized.');\n    }\n\n    const g = SvgHelper.createGroup();\n    if (this.defaultFilter && markerType.applyDefaultFilter) {\n      g.setAttribute('filter', this.defaultFilter);\n    }\n    this._mainCanvas.appendChild(g);\n\n    return new markerType(g);\n  }\n\n  private getMarkerTypeByName(typeName: string): typeof MarkerBase | undefined {\n    let result: typeof MarkerBase | undefined;\n    this.markerTypes.forEach((mType) => {\n      if (mType.typeName === typeName) {\n        result = mType;\n      }\n    });\n    return result;\n  }\n\n  /**\n   * Adds a new marker type to the list of available marker types.\n   * @param markerType - Marker type to register.\n   */\n  public registerMarkerType(markerType: typeof MarkerBase) {\n    if (this.markerTypes.indexOf(markerType) < 0) {\n      this.markerTypes.push(markerType);\n    }\n  }\n\n  /**\n   * Restores the annotation state.\n   * @param state - Annotation state to restore.\n   */\n  public restoreState(state: AnnotationState): void {\n    const stateCopy: AnnotationState = JSON.parse(JSON.stringify(state));\n    this.markers.splice(0);\n\n    while (this._mainCanvas?.lastChild) {\n      this._mainCanvas.removeChild(this._mainCanvas.lastChild);\n    }\n\n    // re-add defs\n    this.addDefsToMainCanvas();\n\n    if (this.defaultFilter === undefined && stateCopy.defaultFilter) {\n      this.defaultFilter = stateCopy.defaultFilter;\n    }\n\n    stateCopy.markers.forEach((markerState) => {\n      const markerType = this.getMarkerTypeByName(markerState.typeName);\n      if (markerType !== undefined) {\n        const marker = this.addNewMarker(markerType);\n        marker.restoreState(markerState);\n        this.markers.push(marker);\n      }\n    });\n\n    if (\n      stateCopy.width &&\n      stateCopy.height &&\n      (stateCopy.width !== this.targetWidth ||\n        stateCopy.height !== this.targetHeight)\n    ) {\n      this.scaleMarkers(\n        this.targetWidth / stateCopy.width,\n        this.targetHeight / stateCopy.height,\n      );\n    }\n  }\n\n  private scaleMarkers(scaleX: number, scaleY: number) {\n    this.markers.forEach((marker) => {\n      marker.scale(scaleX, scaleY);\n    });\n  }\n\n  /**\n   * Rasterizes the annotation.\n   * @param state - annotation state to render.\n   * @param targetCanvas - optional target canvas to render the annotation on.\n   * @returns\n   */\n  public async rasterize(\n    state: AnnotationState,\n    targetCanvas?: HTMLCanvasElement,\n  ): Promise<string> {\n    if (!this.naturalSize && this.targetWidth <= 0 && this.targetHeight <= 0) {\n      this._targetWidth = state.width;\n      this._targetHeight = state.height;\n    }\n\n    this.init();\n\n    if (this._mainCanvas === undefined || this.targetImage === undefined) {\n      throw new Error('Not properly initialized.');\n    }\n\n    let counter = 0;\n    while (!this._targetImageLoaded && counter++ < 100) {\n      // wait for the target image to load\n      await new Promise((r) => setTimeout(r, 100));\n    }\n\n    this.restoreState(state);\n\n    const canvas =\n      targetCanvas !== undefined\n        ? targetCanvas\n        : document.createElement('canvas');\n\n    if (this.targetImage === null) {\n      this.markersOnly = true;\n      this.naturalSize = false;\n    }\n\n    const markerImageCopy = document.createElementNS(\n      'http://www.w3.org/2000/svg',\n      'svg',\n    );\n    markerImageCopy.setAttribute('xmlns', 'http://www.w3.org/2000/svg');\n    markerImageCopy.setAttribute(\n      'width',\n      this._mainCanvas.width.baseVal.valueAsString,\n    );\n    markerImageCopy.setAttribute(\n      'height',\n      this._mainCanvas.height.baseVal.valueAsString,\n    );\n    markerImageCopy.setAttribute(\n      'viewBox',\n      '0 0 ' +\n        this._mainCanvas.viewBox.baseVal.width.toString() +\n        ' ' +\n        this._mainCanvas.viewBox.baseVal.height.toString(),\n    );\n\n    // workaround for text positioning delay\n    await new Promise((r) => setTimeout(r, 200));\n\n    markerImageCopy.innerHTML = this._mainCanvas.innerHTML;\n\n    if (this.naturalSize === true) {\n      // scale to full image size\n      markerImageCopy.width.baseVal.value = this.targetImage.naturalWidth;\n      markerImageCopy.height.baseVal.value = this.targetImage.naturalHeight;\n    } else if (this.width !== undefined && this.height !== undefined) {\n      // scale to specific dimensions\n      markerImageCopy.width.baseVal.value = this.width;\n      markerImageCopy.height.baseVal.value = this.height;\n    }\n\n    canvas.width = markerImageCopy.width.baseVal.value;\n    canvas.height = markerImageCopy.height.baseVal.value;\n\n    const data = markerImageCopy.outerHTML;\n\n    const ctx = canvas.getContext('2d');\n    if (ctx === null) {\n      throw new Error('Canvas 2D context is not available.');\n    }\n\n    if (this.markersOnly !== true) {\n      ctx.drawImage(this.targetImage, 0, 0, canvas.width, canvas.height);\n    }\n\n    const DOMURL = window.URL; // || window.webkitURL || window;\n\n    const img = new Image(canvas.width, canvas.height);\n    img.setAttribute('crossOrigin', 'anonymous');\n\n    const blob = new Blob([data], { type: 'image/svg+xml' });\n\n    const url = DOMURL.createObjectURL(blob);\n\n    let result = '';\n    img.onload = () => {\n      ctx.drawImage(img, 0, 0);\n      DOMURL.revokeObjectURL(url);\n\n      result = canvas.toDataURL(this.imageType, this.imageQuality);\n    };\n\n    img.src = url;\n\n    counter = 0;\n    while (!result && counter++ < 100) {\n      // wait for the image to load\n      await new Promise((r) => setTimeout(r, 100));\n    }\n\n    if (this._editingTarget) {\n      this._renderHelperContainer?.removeChild(this._editingTarget);\n    }\n\n    // remove the helper main canvas from the page\n    this._renderHelperContainer?.removeChild(this._mainCanvas);\n    document.body.removeChild(this._renderHelperContainer!);\n\n    return result;\n  }\n\n  /**\n   * Adds \"defs\" to main canvas SVG.\n   * Useful for filters, custom fonts and potentially other scenarios.\n   * @since 3.3.0\n   */\n  public addDefs(...nodes: (string | Node)[]): void {\n    this._defs.push(...nodes);\n\n    if (this._defsElement) {\n      this._defsElement.append(...nodes);\n    }\n  }\n}\n"],"names":["SvgHelper","createDefs","document","createElementNS","setAttributes","el","attributes","attr","value","setAttribute","createRect","width","height","rect","toString","createLine","x1","y1","x2","y2","line","createPolygon","points","polygon","createCircle","radius","circle","createEllipse","rx","ry","ellipse","createGroup","g","createTransform","createSVGTransform","createMarker","id","orient","markerWidth","markerHeight","refX","refY","markerElement","marker","appendChild","createText","text","createTSpan","tspan","textContent","createImage","image","createPoint","x","y","svgPoint","createSVGPoint","createPath","d","path","createForeignObject","obj","clientToLocalCoordinates","localRoot","zoomLevel","clientRect","getBoundingClientRect","left","top","createSvgFromString","stringSvg","svg","innerHTML","createFilter","filter","Activator","addKey","product","key","keys","set","keyAddListeners","forEach","listener","addKeyAddListener","push","removeKeyAddListener","li","indexOf","splice","isLicensed","has","keyRegex","RegExp","get","undefined","test","Map","Array","MarkerBase","typeName","Object","getPrototypeOf","this","constructor","container","_container","strokeColor","_strokeColor","color","applyStrokeColor","fillColor","_fillColor","applyFillColor","strokeWidth","_strokeWidth","applyStrokeWidth","strokeDasharray","_strokeDasharray","applyStrokeDasharray","opacity","_opacity","applyOpacity","defaultSize","stage","bind","getBBox","ownsTarget","dispose","addMarkerVisualToContainer","element","childNodes","length","insertBefore","getOutline","getState","notes","restoreState","state","_a","_b","_c","_d","scale","scaleX","scaleY","applyDefaultFilter","TransformMatrix","toITransformMatrix","matrix","a","b","c","e","f","toSVGMatrix","currentMatrix","newMatrix","RectangularBoxMarkerBase","centerX","centerY","visual","_visual","translate","transform","baseVal","appendItem","super","rotationAngle","rotatePoint","unrotatePoint","moveVisual","point","style","setSize","rotate","Math","abs","sign","atan","PI","applyRotation","getItem","setRotate","replaceItem","getCTM","matrixTransform","inverse","assign","visualTransformMatrix","containerTransformMatrix","rbmState","setMatrix","rPoint","rotatedTL","rotatedTR","rotatedBL","rotatedBR","absTL","min","absBR","max","DOMRect","ShapeOutlineMarkerBase","createVisual","getPath","adjustVisual","title","ShapeMarkerBase","rectState","FrameMarker","LinearMarkerBase","lineVisual","startTerminatorVisual","endTerminatorVisual","selectorVisual","visibleVisual","getStartTerminatorPath","getEndTerminatorPath","lmbState","LineMarker","ArrowMarker","arrowType","_arrowType","getArrowProperties","arrowHeight","arrowWidth","dx","dy","arrowDipFactor","angle","atan2","startArrowBasePoint","cos","sin","startArrowTipBasePoint","startArrowSide1","startArrowSide2","endArrowBasePoint","endArrowTipBasePoint","endArrowSide1","endArrowSide2","result","arrowState","MeasurementMarker","tipLength","getTerminatorProperties","PolygonMarker","selectorVisualLines","some","l","map","p","i","join","createSelectorVisual","addSelectorLine","adjustSelectorVisual","missingLines","removeChild","pop","pmState","FreehandMarker","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","rejected","done","then","apply","SuppressedError","TextBlock","_text","renderText","boundingBox","_boundingBox","labelBackground","_labelBackground","textElement","_textElement","_color","fontFamily","_fontFamily","positionText","fontSize","_fontSize","units","offsetX","offsetY","wordWrap","prevWrappedText","setupTextElement","show","hide","showControlBox","hideControlBox","applyFontStyles","wrapText","found","span","textAnchor","userSelect","stroke","strokeOpacity","getTextAspectRatio","textLines","longestLineChars","lines","split","boxAspectRatio","processedLines","textAspectRatio","maxLineLength","Number","MAX_VALUE","longestLine","lastIndexOf","reminderLine","maxEnd","substring","trim","processedText","lastChild","lineno","requestAnimationFrame","ts","textSize","_textSize","textBlock","self","noOfLines","lineHeight","autoOffset","bgPadding","onTextSizeChanged","display","TextMarker","getDefaultText","DEFAULT_TEXT","padding","setColor","setFont","setFontSize","textSizeChanged","setSizeFromTextSize","textBoundingBox","setTextBoundingBox","prevWidth","prevHeight","onSizeChanged","font","hideVisual","visibility","showVisual","textState","newFontSize","CoverMarker","HighlightMarker","CalloutMarker","tipPosition","_tipPosition","tipBase1Position","tipBase2Position","_calloutVisual","setTipPoints","offset","baseWidth","cornerAngle","calloutState","EllipseFrameMarker","EllipseMarker","ImageMarkerBase","svgString","_svgString","SVGImage","imageType","outerHTML","imageSrc","_imageSrc","naturalWidth","naturalHeight","adjustImage","DOMParser","parseFromString","documentElement","SVGSVGElement","Error","svgElement","ownerDocument","importNode","isDescendant","parent","target","children","imgState","CustomImageMarker","CheckImageMarker","XImageMarker","CaptionFrameMarker","_outerFrameVisual","_captionFrameVisual","_frameVisual","adjustFrameVisual","getPaths","adjustTextPosition","frame","caption","paths","captionState","CurveMarker","curveX","curveY","HighlighterMarker","SvgFilters","getDefaultFilterSet","MarkerBaseEditor","creationStyle","_creationStyle","is","cls","_marker","overlayContainer","_overlayContainer","_state","isSelected","_isSelected","continuousCreation","_continuousCreation","adjustControlBox","stateChanged","dashes","properties","_controlBox","isMultiSelected","_markerType","markerType","select","deselect","pointerDown","pointerUp","manipulate","dblClick","multi","cursor","manipulationStartState","JSON","stringify","ev","onStateChanged","currentState","Grip","gripSize","fill","child","ResizeGrip","PolygonMarkerEditor","defaultLength","manipulationStartX","manipulationStartY","controlBox","manipulationBox","grips","setupControlBox","adjustControlGrips","createGrip","positionGrip","positionGrips","resize","grip","startCreation","finishCreation","addNewPointWhileCreating","activeGrip","find","at","pointerEvents","onMarkerCreated","activeGripIndex","selectorLineIndex","findIndex","gripIndex","noOfMissingGrips","setTranslate","LinearMarkerEditor","manipulationStartX1","manipulationStartY1","manipulationStartX2","manipulationStartY2","addControlGrips","grip1","grip2","inState","RectangularBoxMarkerGrips","findGripByVisual","gripVisual","values","getGrip","location","RotateGrip","oldFill","RectangularBoxMarkerBaseEditor","manipulationStartLeft","manipulationStartTop","manipulationStartWidth","manipulationStartHeight","CB_DISTANCE","controlGrips","disabledResizeGrips","disableRotation","_suppressMarkerCreateEvent","rotatorGrip","rotatedPoint","rotatedCenter","shiftKey","preserveAspectRatio","newX","newWidth","newY","newHeight","deltaX","deltaY","aspectRatio","controlRect","rotatorGripLine","createRotateGrip","cx","cy","bottom","right","rotatorGripSize","rtop","rcx","adjustGripVisibility","ShapeOutlineMarkerEditor","UndoRedoManager","undoStack","redoStack","isUndoPossible","isRedoPossible","undoStepCount","redoStepCount","addUndoStep","stepData","parse","lastRedoStep","replaceLastUndoStep","getLastUndoStep","undo","lastStep","redo","FreehandMarkerEditor","TextBlockEditor","_width","textEditor","_height","_left","_top","textColor","_textColor","bgColor","_bgColor","backgroundColor","isInFocus","isSetupCompleted","createElement","getEditorUi","focus","setup","flexDirection","alignItems","justifyContent","overflow","textAlign","innerText","contentEditable","outline","whiteSpace","addEventListener","stopPropagation","preventDefault","blur","cancelBubble","onTextChanged","onBlur","clipboardData","content","getData","selection","window","getSelection","rangeCount","deleteFromDocument","getRangeAt","insertNode","createTextNode","range","createRange","selectNodeContents","collapse","removeAllRanges","addRange","TextMarkerEditor","size","textBlockEditorContainer","_pointerDownTime","_pointerDownPoint","markerSizeChanged","textBlockEditor","showEditor","hideEditor","Date","now","ShapeMarkerEditor","ArrowMarkerEditor","CalloutMarkerEditor","manipulationStartTipPositionX","manipulationStartTipPositionY","tipGrip","createTipGrip","tipGripSize","ImageMarkerEditor","CaptionFrameMarkerEditor","CurveMarkerEditor","manipulationStartCurveX","manipulationStartCurveY","curveGrip","curveControlLine1","curveControlLine2","firstChild","MarkerArea","HTMLElement","targetWidth","_targetWidth","setMainCanvasSize","targetHeight","_targetHeight","currentMarkerEditor","_currentMarkerEditor","selectedMarkerEditors","_selectedMarkerEditors","targetImage","_targetImage","_targetImageLoaded","addTargetImage","_zoomLevel","_canvasContainer","_contentContainer","_mainCanvas","setEditingTargetSize","scrollMultiplier","scrollTo","clientWidth","clientHeight","panTo","scrollBy","prevPanPoint","defaultFilter","_defaultFilter","mode","_isInitialized","_newMarkerOutline","markerEditors","editors","undoRedoManager","_defs","touchPoints","isDragging","isSelecting","isPanning","_marqueeSelectOutline","_marqueeSelectRect","_manipulationStartX","_manipulationStartY","connectedCallback","disconnectedCallback","createLayout","addMainCanvas","initOverlay","attachEvents","attachWindowEvents","detachEvents","detachWindowEvents","onCanvasPointerDown","onCanvasDblClick","onKeyUp","onPointerMove","onPointerOut","onPointerUp","addNewMarker","markerCreated","markerStateChanged","deleteMarker","deleteSelectedMarkers","switchToSelectMode","showOutline","hideOutline","undoStep","redoStep","toggleLogo","addLogo","removeLogo","adjustMarqueeSelectOutline","hideMarqueeSelectOutline","addDefs","addDefaultFilterDefs","attachShadow","dispatchEvent","CustomEvent","detail","markerArea","position","flexGrow","flexShrink","touchAction","className","gridTemplateColumns","justifyItems","shadowRoot","gridColumnStart","gridRowStart","margin","addDefsToMainCanvas","_groupLayer","_defsElement","append","_editingTarget","_overlayContentContainer","img","calculatedWidth","calculatedHeight","_stateToRestore","src","registerMarkerType","editorType","mType","getMarkerTypeByName","markerEditor","setCurrentEditor","deselectEditor","markerEditorType","editor","newMarkerEditor","m","selectEditor","selectedCountOnEntry","eventEditor","index","clientX","clientY","leadPointerId","pointerId","pointerType","button","altKey","localPoint","hitMarker","initializeMarqueeSelection","contains","localManipulationStart","finishMarqueeSelection","onlySelected","markerRect","hasAttribute","version","markers","stateCopy","markerState","scaleMarkers","preScaleSelectedMarker","_logoUI","logoUI","link","href","Logo","positionLogo","forceAdd","lastUndoState","nodes","type","options","removeEventListener","customElements","define","MarkerView","markerTypes","attachMarkerEvents","markerView","newMarker","Renderer","naturalSize","markersOnly","init","_renderHelperContainer","body","rasterize","targetCanvas","counter","r","setTimeout","canvas","markerImageCopy","valueAsString","viewBox","data","ctx","getContext","drawImage","DOMURL","URL","Image","blob","Blob","url","createObjectURL","onload","revokeObjectURL","toDataURL","imageQuality"],"mappings":"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","x_google_ignoreList":[14]}